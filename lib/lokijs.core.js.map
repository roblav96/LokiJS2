{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 65d0cac4fd685b578218","webpack:///./src/core/index.js","webpack:///./src/core/lokicore.js","webpack:///./src/core/event_emitter.js","webpack:///./src/core/fs_adapter.js","webpack:///./src/core/local_storage_adapter.js","webpack:///./src/core/collection.js","webpack:///./src/core/unique_index.js","webpack:///./src/core/exact_index.js","webpack:///./src/core/resultset.js","webpack:///./src/core/clone.js","webpack:///./src/core/utils.js","webpack:///./src/core/helper.js","webpack:///./src/core/dynamic_view.js","webpack:///./src/core/loki-indexed-adapter.js"],"names":["module","exports","Loki","constructor","filename","options","collections","databaseVersion","engineVersion","autosave","autosaveInterval","autosaveHandle","serializationMethod","hasOwnProperty","destructureDelimiter","persistenceMethod","persistenceAdapter","verbose","events","getENV","window","global","document","URL","indexOf","ENV","env","on","clearChanges","getIndexedAdapter","adapter","require","initializePersistence","self","defaultPersistence","persistenceMethods","parseInt","autosaveDisable","loaded","autoload","loadDatabase","inflate","Promise","resolve","then","autosaveEnable","copy","databaseCopy","clen","idx","loadJSONObject","retainDirtyFlags","removeNonSerializable","length","constraints","ttl","anonym","docs","collection","insert","console","addCollection","name","push","loadCollection","Error","getCollection","collectionName","i","len","emit","listCollections","colls","type","objType","count","data","removeCollection","tmpcol","curcol","prop","splice","getName","serializeReplacer","key","value","serialize","JSON","stringify","serializeDestructured","toJson","sidx","result","resultlen","reconstruct","dbcopy","partitioned","delimited","delimiter","partition","serializeCollection","collectionIndex","Array","isArray","join","delim","doccount","docidx","resultlines","deserializeDestructured","destructuredSource","workarray","cdb","collIndex","collCount","lineIndex","done","currLine","currObject","parse","deserializeCollection","split","pop","loadJSON","serializedDb","dbObject","coll","copyColl","j","loader","collObj","makeLoader","collOptions","inflater","proto","copyProperties","adaptiveBinaryIndices","transactional","asyncListeners","disableChangesApi","cloneObjects","cloneMethod","autoupdate","changes","dirty","addAutoUpdateObserver","maxId","idIndex","binaryIndices","transforms","ensureId","uniqueNames","ensureUniqueIndex","DynamicViews","colldv","dv","addDynamicView","resultdata","resultsdirty","filterPipeline","sortCriteria","sortFunction","sortDirty","resultset","filteredrows","searchIsChained","filterInitialized","rematerialize","removeWhereFilters","close","saved","autosaveDirty","saveDatabase","generateChangesNotification","arrayOfCollectionNames","getCollName","selectedCollections","map","forEach","concat","getChanges","serializeChanges","collectionNamesArray","flushChanges","reject","loadDatabaseCallback","dbString","TypeError","mode","exportDatabase","autosaveClearFlags","save","deleteDatabase","running","undefined","setTimeout","LokiEventEmitter","eventName","listener","event","currentEventName","addListener","removeListener","listen","listeners","LokiFsAdapter","fs","dbname","stat","err","stats","isFile","readFile","encoding","readFileCallback","dbstring","tmpdbname","writeFile","rename","unlink","deleteDatabaseCallback","localStorageAvailable","localStorage","e","LokiLocalStorageAdapter","getItem","setItem","removeItem","isDeepProperty","field","parseBase10","num","parseFloat","add","a","b","sub","average","array","reduce","standardDeviation","values","avg","squareDiffs","diff","sqrDiff","avgSquareDiff","stdDev","Math","sqrt","deepProperty","obj","property","isDeep","pieces","root","shift","Collection","unique","exact","cachedIndex","cachedBinaryIndex","cachedData","clone","age","ttlInterval","daemon","setTTL","indices","Object","prototype","toString","call","ensureIndex","observerCallback","changedObjects","Set","object","change","removeAutoUpdateObserver","update","createChange","op","operation","insertMeta","meta","created","Date","getTime","revision","updateMeta","updated","createInsertChange","createUpdateChange","insertMetaWithChange","updateMetaWithChange","insertHandler","updateHandler","setHandlers","setChangesApi","enabled","insertCallback","updateCallback","deleteCallback","warning","warn","log","error","stages","commitLog","observe","unobserve","addTransform","transform","setTransform","removeTransform","byExample","template","k","query","findObject","findOne","findObjects","find","ttlDaemonFuncGen","ttlDaemon","now","toRemove","chain","where","daemonFilter","member","timestamp","remove","interval","clearInterval","setInterval","prepareFullDocIndex","indexes","configureOptions","ensureAllIndexes","force","index","wrappedComparer","p","objAp","objBp","sort","getSequencedIndexValues","idxvals","set","bIndices","flagBinaryIndexesDirty","flagBinaryIndexDirty","$loki","removeDynamicView","getDynamicView","findAndUpdate","filterObject","updateFunction","updateWhere","findAndRemove","doc","insertOne","results","bulkInsert","returnObj","clear","removeIndices","keys","biname","uiname","startTransaction","arr","get","oldInternal","newInternal","position","evaluateDocument","adaptiveBinaryIndexUpdate","commit","rollback","message","isNaN","version","constrUnique","addedPos","dvlen","adaptiveBinaryIndexInsert","filterFunction","removeWhere","list","filter","removeDataOnly","slice","removeDocument","adaptiveBinaryIndexRemove","id","returnPosition","retpos","max","min","mid","getBinaryIndexPosition","dataPosition","binaryIndexName","val","range","calculateRange","idxPos","calculateRangeStart","removedFromIndexOnly","rcd","minVal","maxVal","lbound","calculateRangeEnd","ubound","idxset","segResult","seg","lval","uval","by","queryObj","firstOnly","parameters","rs","findOneUnindexed","fun","queryFunc","mapReduce","mapFunction","reduceFunction","eqJoin","joinData","leftJoinProp","rightJoinProp","mapFun","getStage","stage","stageName","commitStage","no_op","extract","isDotNotation","apply","maxRecord","deep","minRecord","extractNumerical","Number","n","dict","median","half","floor","UniqueIndex","uniqueField","keyMap","lokiMap","fieldValue","byId","old","ExactIndex","exactField","idxSet","containsCheckFn","doQueryOp","LokiOps","$eq","$aeq","$ne","$dteq","$gt","$gte","$lt","$lte","$between","vals","$in","$nin","$keyin","$nkeyin","$definedin","$undefinedin","$regex","test","$containsString","$containsNone","$containsAny","checkFn","some","$contains","every","$type","$size","$len","$where","$not","$and","$or","indexedOpsList","sortHelper","prop1","prop2","desc","compoundeval","properties","obj1","obj2","res","dotSubScan","paths","poffset","pathOffset","path","valueFound","element","Resultset","reset","toJSON","limit","qty","rscopy","offset","pos","branch","step","resolveTransformParams","simplesort","compoundsort","leftJoinKey","rightJoinKey","instance","collectionOptions","instanceCollection","comparefun","userComparer","propname","isdesc","props","findOr","expressionArray","fr","fri","frlen","docset","origCount","ei","elen","arguments","findAnd","queryObject","queryObjectOp","operator","searchByIndex","RegExp","usingDotNotation","doIndexCheck","t","rowIdx","segm","viewFunction","method","forceClones","forceCloneMethod","leftData","leftDataLength","rightData","rightDataLength","leftKeyisFunction","rightKeyisFunction","joinMap","left","right","cloneObjectArray","cloned","jQuery","extend","create","objarray","Utils","src","dest","resolveTransformObject","subObj","params","depth","pname","substring","clonedStep","resolvedTransform","ltHelper","gtHelper","equal","cv1","cv2","DynamicView","rebuildPending","persistent","sortPriority","minRebuildInterval","cachedresultset","fpl","fpi","ofp","applyFind","branchResultset","removeFilters","queueSortPhase","applySort","applySimpleSort","applySortCriteria","criteria","_indexOfFilterWithId","uid","_addFilter","reapplyFilters","filters","queueRebuildEvent","applyFilter","applyWhere","removeFilter","performSortPhase","suppressRebuildEvent","objIndex","isNew","ofr","oldPos","oldlen","evalResultset","newPos","LokiIndexedAdapter","appname","app","catalog","checkAvailability","indexedDB","appName","db","LokiCatalog","cat","getAppKey","loadKey","rej","saveCallback","success","setAppKey","saveKey","deleteAppKey","deleteKey","deleteDatabasePartitions","getDatabaseList","str","startsWith","callback","getAppKeys","names","getKeyList","getCatalogSummary","getAllKeys","entries","size","oapp","okey","oval","initializeLokiCatalog","openRequest","open","onupgradeneeded","thisDB","target","objectStoreNames","contains","deleteObjectStore","objectStore","createObjectStore","keyPath","autoIncrement","createIndex","onsuccess","onerror","transaction","store","appkey","request","usercallback","lres","getAppKeyById","requestPut","put","delete","evt","singleKeyRange","IDBKeyRange","only","cursor","openCursor","localdata","continue"],"mappings":"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","file":"lokijs.core.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"core\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"core\"] = factory();\n\telse\n\t\troot[\"lokijs\"] = root[\"lokijs\"] || {}, root[\"lokijs\"][\"core\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 65d0cac4fd685b578218","import {Loki} from './lokicore'\n\nmodule.exports = Loki;\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/index.js","\nimport {LokiEventEmitter} from './event_emitter'\n\nimport {LokiFsAdapter} from './fs_adapter'\nimport {LokiLocalStorageAdapter} from './local_storage_adapter'\nimport {Collection} from './collection'\nimport {Utils} from './utils'\n\n/*\n'LokiFsAdapter' is not defined                 no-undef\tx\n'LokiLocalStorageAdapter' is not defined       no-undef\tx\n'Collection' is not defined                    no-undef\tx\n'delim' is not defined                         no-undef\tx\n'Utils' is not defined                         no-undef\tx\n */\n\n/**\n * Loki: The main database class\n * @constructor Loki\n * @implements LokiEventEmitter\n * @param {string} filename - name of the file to be saved to\n * @param {object=} options - (Optional) config options object\n * @param {string} options.env - override environment detection as 'NODEJS', 'BROWSER', 'CORDOVA'\n * @param {boolean} options.verbose - enable console output (default is 'false')\n */\nexport class Loki extends LokiEventEmitter {\n\n\tconstructor(filename, options) {\n\t\tsuper();\n\t\tthis.filename = filename || 'loki.db';\n\t\tthis.collections = [];\n\n\t\t// persist version of code which created the database to the database.\n\t\t// could use for upgrade scenarios\n\t\tthis.databaseVersion = 1.1;\n\t\tthis.engineVersion = 1.1;\n\n\t\t// autosave support (disabled by default)\n\t\t// pass autosave: true, autosaveInterval: 6000 in options to set 6 second autosave\n\t\tthis.autosave = false;\n\t\tthis.autosaveInterval = 5000;\n\t\tthis.autosaveHandle = null;\n\n\t\tthis.options = {\n\t\t\tserializationMethod: options && options.hasOwnProperty('serializationMethod') ? options.serializationMethod : 'normal',\n\t\t\tdestructureDelimiter: options && options.hasOwnProperty('destructureDelimiter') ? options.destructureDelimiter : '$<\\n'\n\t\t};\n\n\t\t// currently keeping persistenceMethod and persistenceAdapter as loki level properties that\n\t\t// will not or cannot be deserialized.  You are required to configure persistence every time\n\t\t// you instantiate a loki object (or use default environment detection) in order to load the database anyways.\n\n\t\t// persistenceMethod could be 'fs', 'localStorage', or 'adapter'\n\t\t// this is optional option param, otherwise environment detection will be used\n\t\t// if user passes their own adapter we will force this method to 'adapter' later, so no need to pass method option.\n\t\tthis.persistenceMethod = null;\n\n\t\t// retain reference to optional (non-serializable) persistenceAdapter 'instance'\n\t\tthis.persistenceAdapter = null;\n\n\t\t// enable console output if verbose flag is set (disabled by default)\n\t\tthis.verbose = options && options.hasOwnProperty('verbose') ? options.verbose : false;\n\n\t\tthis.events = {\n\t\t\t'init': [],\n\t\t\t'loaded': [],\n\t\t\t'flushChanges': [],\n\t\t\t'close': [],\n\t\t\t'changes': [],\n\t\t\t'warning': []\n\t\t};\n\n\t\tvar getENV = function() {\n\t\t\tif (typeof window === 'undefined') {\n\t\t\t\treturn 'NODEJS';\n\t\t\t}\n\n\t\t\tif (typeof global !== 'undefined' && global.window) {\n\t\t\t\treturn 'NODEJS'; //node-webkit\n\t\t\t}\n\n\t\t\tif (typeof document !== 'undefined') {\n\t\t\t\tif (document.URL.indexOf('http://') === -1 && document.URL.indexOf('https://') === -1) {\n\t\t\t\t\treturn 'CORDOVA';\n\t\t\t\t}\n\t\t\t\treturn 'BROWSER';\n\t\t\t}\n\t\t\treturn 'CORDOVA';\n\t\t};\n\n\t\t// refactored environment detection due to invalid detection for browser environments.\n\t\t// if they do not specify an options.env we want to detect env rather than default to nodejs.\n\t\t// currently keeping two properties for similar thing (options.env and options.persistenceMethod)\n\t\t//   might want to review whether we can consolidate.\n\t\tif (options && options.hasOwnProperty('env')) {\n\t\t\tthis.ENV = options.env;\n\t\t} else {\n\t\t\tthis.ENV = getENV();\n\t\t}\n\n\t\tthis.on('init', this.clearChanges);\n\t}\n\n\t// experimental support for browserify's abstract syntax scan to pick up dependency of indexed adapter.\n\t// Hopefully, once this hits npm a browserify require of lokijs should scan the main file and detect this indexed adapter reference.\n\tgetIndexedAdapter() {\n\t\tvar adapter;\n\n\t\tif (typeof require === 'function') {\n\t\t\tadapter = require(\"./loki-indexed-adapter.js\");\n\t\t}\n\n\t\treturn adapter;\n\t};\n\n\n\t/**\n\t * configures options related to database persistence.\n\t *\n\t * @param {object} options - configuration options to apply to loki db object\n\t * @param {adapter} options.adapter - an instance of a loki persistence adapter\n\t * @param {boolean} options.autosave - enables autosave\n\t * @param {int} options.autosaveInterval - time interval (in milliseconds) between saves (if dirty)\n\t * @param {boolean} options.autoload - enables autoload on loki instantiation\n\t * @param {object} options.inflate - options that are passed to loadDatabase if autoload enabled\n\t * @param {string} options.serializationMethod - ['normal', 'pretty', 'destructured']\n\t * @param {string} options.destructureDelimiter - string delimiter used for destructured serialization\n\t * @returns {Promise} a Promise that resolves after initialization and (if enabled) autoloading the database\n\t * @memberof Loki\n\t */\n\tinitializePersistence(options) {\n\t\tvar self = this;\n\t\tvar defaultPersistence = {\n\t\t\t\t'NODEJS': 'fs',\n\t\t\t\t'BROWSER': 'localStorage',\n\t\t\t\t'CORDOVA': 'localStorage'\n\t\t\t},\n\t\t\tpersistenceMethods = {\n\t\t\t\t'fs': LokiFsAdapter,\n\t\t\t\t'localStorage': LokiLocalStorageAdapter\n\t\t\t};\n\n\t\tthis.options = options || {};\n\n\t\tthis.persistenceMethod = null;\n\t\t// retain reference to optional persistence adapter 'instance'\n\t\t// currently keeping outside options because it can't be serialized\n\t\tthis.persistenceAdapter = null;\n\n\t\t// process the options\n\t\tif (this.options.hasOwnProperty('persistenceMethod')) {\n\t\t\t// check if the specified persistence method is known\n\t\t\tif (typeof(persistenceMethods[this.options.persistenceMethod]) === 'function') {\n\t\t\t\tthis.persistenceMethod = this.options.persistenceMethod;\n\t\t\t\tthis.persistenceAdapter = new persistenceMethods[this.options.persistenceMethod]();\n\t\t\t}\n\t\t\t// should be throw an error here, or just fall back to defaults ??\n\t\t}\n\n\t\t// ensure defaults exists for options which were not set\n\t\tif (!this.options.hasOwnProperty('serializationMethod')) {\n\t\t\tthis.options.serializationMethod = 'normal';\n\t\t}\n\n\t\t// ensure passed or default option exists\n\t\tif (!this.options.hasOwnProperty('destructureDelimiter')) {\n\t\t\tthis.options.destructureDelimiter = '$<\\n';\n\t\t}\n\n\t\t// if by now there is no adapter specified by user nor derived from persistenceMethod: use sensible defaults\n\t\tif (this.persistenceAdapter === null) {\n\t\t\tthis.persistenceMethod = defaultPersistence[this.ENV];\n\t\t\tif (this.persistenceMethod) {\n\t\t\t\tthis.persistenceAdapter = new persistenceMethods[this.persistenceMethod]();\n\t\t\t}\n\t\t}\n\n\t\t// if user passes adapter, set persistence mode to adapter and retain persistence adapter instance\n\t\tif (this.options.hasOwnProperty('adapter')) {\n\t\t\tthis.persistenceMethod = 'adapter';\n\t\t\tthis.persistenceAdapter = this.options.adapter;\n\t\t}\n\n\t\tif (this.options.hasOwnProperty('autosaveInterval')) {\n\t\t\tthis.autosaveInterval = parseInt(this.options.autosaveInterval, 10);\n\t\t}\n\n\t\tthis.autosaveDisable();\n\n\t\tvar loaded;\n\n\t\t// if they want to load database on loki instantiation, now is a good time to load... after adapter set and before possible autosave initiation\n\t\tif (this.options.autoload) {\n\t\t\tloaded = this.loadDatabase(this.options.inflate);\n\t\t} else {\n\t\t\tloaded = Promise.resolve();\n\t\t}\n\n\t\treturn loaded.then(function() {\n\t\t\tif (self.options.autosave) {\n\t\t\t\tself.autosaveEnable();\n\t\t\t}\n\t\t});\n\t};\n\n\t/**\n\t * Copies 'this' database into a new Loki instance. Object references are shared to make lightweight.\n\t *\n\t * @param {object} options - apply or override collection level settings\n\t * @param {bool} options.removeNonSerializable - nulls properties not safe for serialization.\n\t * @memberof Loki\n\t */\n\tcopy(options) {\n\t\tvar databaseCopy = new Loki(this.filename);\n\t\tvar clen, idx;\n\n\t\toptions = options || {};\n\n\t\t// currently inverting and letting loadJSONObject do most of the work\n\t\tdatabaseCopy.loadJSONObject(this, {\n\t\t\tretainDirtyFlags: true\n\t\t});\n\n\t\t// since our JSON serializeReplacer is not invoked for reference database adapters, this will let us mimic\n\t\tif (options.hasOwnProperty(\"removeNonSerializable\") && options.removeNonSerializable === true) {\n\t\t\tdatabaseCopy.autosaveHandle = null;\n\t\t\tdatabaseCopy.persistenceAdapter = null;\n\n\t\t\tclen = databaseCopy.collections.length;\n\t\t\tfor (idx = 0; idx < clen; idx++) {\n\t\t\t\tdatabaseCopy.collections[idx].constraints = null;\n\t\t\t\tdatabaseCopy.collections[idx].ttl = null;\n\t\t\t}\n\t\t}\n\n\t\treturn databaseCopy;\n\t};\n\n\t/**\n\t * Shorthand method for quickly creating and populating an anonymous collection.\n\t *    This collection is not referenced internally so upon losing scope it will be garbage collected.\n\t *\n\t * @example\n\t * var results = new loki().anonym(myDocArray).find({'age': {'$gt': 30} });\n\t *\n\t * @param {Array} docs - document array to initialize the anonymous collection with\n\t * @param {object} options - configuration object, see {@link Loki#addCollection} options\n\t * @returns {Collection} New collection which you can query or chain\n\t * @memberof Loki\n\t */\n\tanonym(docs, options) {\n\t\tvar collection = new Collection('anonym', options);\n\t\tcollection.insert(docs);\n\n\t\tif (this.verbose)\n\t\t\tcollection.console = console;\n\n\t\treturn collection;\n\t};\n\n\t/**\n\t * Adds a collection to the database.\n\t * @param {string} name - name of collection to add\n\t * @param {object=} options - (optional) options to configure collection with.\n\t * @param {array} options.unique - array of property names to define unique constraints for\n\t * @param {array} options.exact - array of property names to define exact constraints for\n\t * @param {array} options.indices - array property names to define binary indexes for\n\t * @param {boolean} options.asyncListeners - default is false\n\t * @param {boolean} options.disableChangesApi - default is true\n\t * @param {boolean} options.autoupdate - use Object.observe to update objects automatically (default: false)\n\t * @param {boolean} options.clone - specify whether inserts and queries clone to/from user\n\t * @param {string} options.cloneMethod - 'parse-stringify' (default), 'jquery-extend-deep', 'shallow'\n\t * @param {int} options.ttlInterval - time interval for clearing out 'aged' documents; not set by default.\n\t * @returns {Collection} a reference to the collection which was just added\n\t * @memberof Loki\n\t */\n\taddCollection(name, options) {\n\t\tvar collection = new Collection(name, options);\n\t\tthis.collections.push(collection);\n\n\t\tif (this.verbose)\n\t\t\tcollection.console = console;\n\n\t\treturn collection;\n\t};\n\n\tloadCollection(collection) {\n\t\tif (!collection.name) {\n\t\t\tthrow new Error('Collection must have a name property to be loaded');\n\t\t}\n\t\tthis.collections.push(collection);\n\t};\n\n\t/**\n\t * Retrieves reference to a collection by name.\n\t * @param {string} collectionName - name of collection to look up\n\t * @returns {Collection} Reference to collection in database by that name, or null if not found\n\t * @memberof Loki\n\t */\n\tgetCollection(collectionName) {\n\t\tvar i,\n\t\t\tlen = this.collections.length;\n\n\t\tfor (i = 0; i < len; i += 1) {\n\t\t\tif (this.collections[i].name === collectionName) {\n\t\t\t\treturn this.collections[i];\n\t\t\t}\n\t\t}\n\n\t\t// no such collection\n\t\tthis.emit('warning', 'collection ' + collectionName + ' not found');\n\t\treturn null;\n\t};\n\n\tlistCollections() {\n\n\t\tvar i = this.collections.length,\n\t\t\tcolls = [];\n\n\t\twhile (i--) {\n\t\t\tcolls.push({\n\t\t\t\tname: this.collections[i].name,\n\t\t\t\ttype: this.collections[i].objType,\n\t\t\t\tcount: this.collections[i].data.length\n\t\t\t});\n\t\t}\n\t\treturn colls;\n\t};\n\n\t/**\n\t * Removes a collection from the database.\n\t * @param {string} collectionName - name of collection to remove\n\t * @memberof Loki\n\t */\n\tremoveCollection(collectionName) {\n\t\tvar i,\n\t\t\tlen = this.collections.length;\n\n\t\tfor (i = 0; i < len; i += 1) {\n\t\t\tif (this.collections[i].name === collectionName) {\n\t\t\t\tvar tmpcol = new Collection(collectionName, {});\n\t\t\t\tvar curcol = this.collections[i];\n\t\t\t\tfor (var prop in curcol) {\n\t\t\t\t\tif (curcol.hasOwnProperty(prop) && tmpcol.hasOwnProperty(prop)) {\n\t\t\t\t\t\tcurcol[prop] = tmpcol[prop];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.collections.splice(i, 1);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t};\n\n\tgetName() {\n\t\treturn this.name;\n\t};\n\n\t/**\n\t * serializeReplacer - used to prevent certain properties from being serialized\n\t *\n\t */\n\tserializeReplacer(key, value) {\n\t\tswitch (key) {\n\t\t\tcase 'autosaveHandle':\n\t\t\tcase 'persistenceAdapter':\n\t\t\tcase 'constraints':\n\t\t\tcase 'ttl':\n\t\t\t\treturn null;\n\t\t\tdefault:\n\t\t\t\treturn value;\n\t\t}\n\t};\n\n\t/**\n\t * Serialize database to a string which can be loaded via {@link Loki#loadJSON}\n\t *\n\t * @returns {string} Stringified representation of the loki database.\n\t * @memberof Loki\n\t */\n\tserialize(options) {\n\t\toptions = options || {};\n\n\t\tif (!options.hasOwnProperty(\"serializationMethod\")) {\n\t\t\toptions.serializationMethod = this.options.serializationMethod;\n\t\t}\n\n\t\tswitch (options.serializationMethod) {\n\t\t\tcase \"normal\":\n\t\t\t\treturn JSON.stringify(this, this.serializeReplacer);\n\t\t\tcase \"pretty\":\n\t\t\t\treturn JSON.stringify(this, this.serializeReplacer, 2);\n\t\t\tcase \"destructured\":\n\t\t\t\treturn this.serializeDestructured(); // use default options\n\t\t\tdefault:\n\t\t\t\treturn JSON.stringify(this, this.serializeReplacer);\n\t\t}\n\t};\n\n\t// alias of serialize\n\ttoJson() {\n\t\treturn this.serialize;\n\t}\n\n\t/**\n\t * Destructured JSON serialization routine to allow alternate serialization methods.\n\t * Internally, Loki supports destructuring via loki \"serializationMethod' option and\n\t * the optional LokiPartitioningAdapter class. It is also available if you wish to do\n\t * your own structured persistence or data exchange.\n\t *\n\t * @param {object=} options - output format options for use externally to loki\n\t * @param {bool=} options.partitioned - (default: false) whether db and each collection are separate\n\t * @param {int=} options.partition - can be used to only output an individual collection or db (-1)\n\t * @param {bool=} options.delimited - (default: true) whether subitems are delimited or subarrays\n\t * @param {string=} options.delimiter - override default delimiter\n\t *\n\t * @returns {string|array} A custom, restructured aggregation of independent serializations.\n\t * @memberof Loki\n\t */\n\tserializeDestructured(options) {\n\t\tvar idx, sidx, result, resultlen;\n\t\tvar reconstruct = [];\n\t\tvar dbcopy;\n\n\t\toptions = options || {};\n\n\t\tif (!options.hasOwnProperty(\"partitioned\")) {\n\t\t\toptions.partitioned = false;\n\t\t}\n\n\t\tif (!options.hasOwnProperty(\"delimited\")) {\n\t\t\toptions.delimited = true;\n\t\t}\n\n\t\tif (!options.hasOwnProperty(\"delimiter\")) {\n\t\t\toptions.delimiter = this.options.destructureDelimiter;\n\t\t}\n\n\t\t// 'partitioned' along with 'partition' of 0 or greater is a request for single collection serialization\n\t\tif (options.partitioned === true && options.hasOwnProperty(\"partition\") && options.partition >= 0) {\n\t\t\treturn this.serializeCollection({\n\t\t\t\tdelimited: options.delimited,\n\t\t\t\tdelimiter: options.delimiter,\n\t\t\t\tcollectionIndex: options.partition\n\t\t\t});\n\t\t}\n\n\t\t// not just an individual collection, so we will need to serialize db container via shallow copy\n\t\tdbcopy = new Loki(this.filename);\n\t\tdbcopy.loadJSONObject(this);\n\n\t\tfor (idx = 0; idx < dbcopy.collections.length; idx++) {\n\t\t\tdbcopy.collections[idx].data = [];\n\t\t}\n\n\t\t// if we -only- wanted the db container portion, return it now\n\t\tif (options.partitioned === true && options.partition === -1) {\n\t\t\t// since we are deconstructing, override serializationMethod to normal for here\n\t\t\treturn dbcopy.serialize({\n\t\t\t\tserializationMethod: \"normal\"\n\t\t\t});\n\t\t}\n\n\t\t// at this point we must be deconstructing the entire database\n\t\t// start by pushing db serialization into first array element\n\t\treconstruct.push(dbcopy.serialize({\n\t\t\tserializationMethod: \"normal\"\n\t\t}));\n\n\t\tdbcopy = null;\n\n\t\t// push collection data into subsequent elements\n\t\tfor (idx = 0; idx < this.collections.length; idx++) {\n\t\t\tresult = this.serializeCollection({\n\t\t\t\tdelimited: options.delimited,\n\t\t\t\tdelimiter: options.delimiter,\n\t\t\t\tcollectionIndex: idx\n\t\t\t});\n\n\t\t\t// NDA : Non-Delimited Array : one iterable concatenated array with empty string collection partitions\n\t\t\tif (options.partitioned === false && options.delimited === false) {\n\t\t\t\tif (!Array.isArray(result)) {\n\t\t\t\t\tthrow new Error(\"a nondelimited, non partitioned collection serialization did not return an expected array\");\n\t\t\t\t}\n\n\t\t\t\t// Array.concat would probably duplicate memory overhead for copying strings.\n\t\t\t\t// Instead copy each individually, and clear old value after each copy.\n\t\t\t\t// Hopefully this will allow g.c. to reduce memory pressure, if needed.\n\t\t\t\tresultlen = result.length;\n\n\t\t\t\tfor (sidx = 0; sidx < resultlen; sidx++) {\n\t\t\t\t\treconstruct.push(result[sidx]);\n\t\t\t\t\tresult[sidx] = null;\n\t\t\t\t}\n\n\t\t\t\treconstruct.push(\"\");\n\t\t\t} else {\n\t\t\t\treconstruct.push(result);\n\t\t\t}\n\t\t}\n\n\t\t// Reconstruct / present results according to four combinations : D, DA, NDA, NDAA\n\t\tif (options.partitioned) {\n\t\t\t// DA : Delimited Array of strings [0] db [1] collection [n] collection { partitioned: true, delimited: true }\n\t\t\t// useful for simple future adaptations of existing persistence adapters to save collections separately\n\t\t\tif (options.delimited) {\n\t\t\t\treturn reconstruct;\n\t\t\t}\n\t\t\t// NDAA : Non-Delimited Array with subArrays. db at [0] and collection subarrays at [n] { partitioned: true, delimited : false }\n\t\t\t// This format might be the most versatile for 'rolling your own' partitioned sync or save.\n\t\t\t// Memory overhead can be reduced by specifying a specific partition, but at this code path they did not, so its all.\n\t\t\telse {\n\t\t\t\treturn reconstruct;\n\t\t\t}\n\t\t} else {\n\t\t\t// D : one big Delimited string { partitioned: false, delimited : true }\n\t\t\t// This is the method Loki will use internally if 'destructured'.\n\t\t\t// Little memory overhead improvements but does not require multiple asynchronous adapter call scheduling\n\t\t\tif (options.delimited) {\n\t\t\t\t// indicate no more collections\n\t\t\t\treconstruct.push(\"\");\n\n\t\t\t\treturn reconstruct.join(options.delimiter);\n\t\t\t}\n\t\t\t// NDA : Non-Delimited Array : one iterable array with empty string collection partitions { partitioned: false, delimited: false }\n\t\t\t// This format might be best candidate for custom synchronous syncs or saves\n\t\t\telse {\n\t\t\t\t// indicate no more collections\n\t\t\t\treconstruct.push(\"\");\n\n\t\t\t\treturn reconstruct;\n\t\t\t}\n\t\t}\n\n\t\treconstruct.push(\"\");\n\n\t\treturn reconstruct.join(delim);\n\t};\n\n\t/**\n\t * Utility method to serialize a collection in a 'destructured' format\n\t *\n\t * @param {object} options - used to determine output of method\n\t * @param {int=} options.delimited - whether to return single delimited string or an array\n\t * @param {string=} options.delimiter - (optional) if delimited, this is delimiter to use\n\t * @param {int} options.collectionIndex -  specify which collection to serialize data for\n\t *\n\t * @returns {string|array} A custom, restructured aggregation of independent serializations for a single collection.\n\t * @memberof Loki\n\t */\n\tserializeCollection(options) {\n\t\tvar doccount,\n\t\t\tdocidx,\n\t\t\tresultlines = [];\n\n\t\toptions = options || {};\n\n\t\tif (!options.hasOwnProperty(\"delimited\")) {\n\t\t\toptions.delimited = true;\n\t\t}\n\n\t\tif (!options.hasOwnProperty(\"collectionIndex\")) {\n\t\t\tthrow new Error(\"serializeCollection called without 'collectionIndex' option\");\n\t\t}\n\n\t\tdoccount = this.collections[options.collectionIndex].data.length;\n\n\t\tresultlines = [];\n\n\t\tfor (docidx = 0; docidx < doccount; docidx++) {\n\t\t\tresultlines.push(JSON.stringify(this.collections[options.collectionIndex].data[docidx]));\n\t\t}\n\n\t\t// D and DA\n\t\tif (options.delimited) {\n\t\t\t// indicate no more documents in collection (via empty delimited string)\n\t\t\tresultlines.push(\"\");\n\n\t\t\treturn resultlines.join(options.delimiter);\n\t\t} else {\n\t\t\t// NDAA and NDA\n\t\t\treturn resultlines;\n\t\t}\n\t};\n\n\t/**\n\t * Destructured JSON deserialization routine to minimize memory overhead.\n\t * Internally, Loki supports destructuring via loki \"serializationMethod' option and\n\t * the optional LokiPartitioningAdapter class. It is also available if you wish to do\n\t * your own structured persistence or data exchange.\n\t *\n\t * @param {string|array} destructuredSource - destructured json or array to deserialize from\n\t * @param {object=} options - source format options\n\t * @param {bool=} options.partitioned - (default: false) whether db and each collection are separate\n\t * @param {int=} options.partition - can be used to deserialize only a single partition\n\t * @param {bool=} options.delimited - (default: true) whether subitems are delimited or subarrays\n\t * @param {string=} options.delimiter - override default delimiter\n\t *\n\t * @returns {object|array} An object representation of the deserialized database, not yet applied to 'this' db or document array\n\t * @memberof Loki\n\t */\n\tdeserializeDestructured(destructuredSource, options) {\n\t\tvar workarray = [];\n\t\tvar len, cdb;\n\t\tvar idx, collIndex = 0,\n\t\t\tcollCount, lineIndex = 1,\n\t\t\tdone = false;\n\t\tvar currLine, currObject;\n\n\t\toptions = options || {};\n\n\t\tif (!options.hasOwnProperty(\"partitioned\")) {\n\t\t\toptions.partitioned = false;\n\t\t}\n\n\t\tif (!options.hasOwnProperty(\"delimited\")) {\n\t\t\toptions.delimited = true;\n\t\t}\n\n\t\tif (!options.hasOwnProperty(\"delimiter\")) {\n\t\t\toptions.delimiter = this.options.destructureDelimiter;\n\t\t}\n\n\t\t// Partitioned\n\t\t// DA : Delimited Array of strings [0] db [1] collection [n] collection { partitioned: true, delimited: true }\n\t\t// NDAA : Non-Delimited Array with subArrays. db at [0] and collection subarrays at [n] { partitioned: true, delimited : false }\n\t\t// -or- single partition\n\t\tif (options.partitioned) {\n\t\t\t// handle single partition\n\t\t\tif (options.hasOwnProperty('partition')) {\n\t\t\t\t// db only\n\t\t\t\tif (options.partition === -1) {\n\t\t\t\t\tcdb = JSON.parse(destructuredSource[0]);\n\n\t\t\t\t\treturn cdb;\n\t\t\t\t}\n\n\t\t\t\t// single collection, return doc array\n\t\t\t\treturn this.deserializeCollection(destructuredSource[options.partition + 1], options);\n\t\t\t}\n\n\t\t\t// Otherwise we are restoring an entire partitioned db\n\t\t\tcdb = JSON.parse(destructuredSource[0]);\n\t\t\tcollCount = cdb.collections.length;\n\t\t\tfor (collIndex = 0; collIndex < collCount; collIndex++) {\n\t\t\t\t// attach each collection docarray to container collection data, add 1 to collection array index since db is at 0\n\t\t\t\tcdb.collections[collIndex].data = this.deserializeCollection(destructuredSource[collIndex + 1], options);\n\t\t\t}\n\n\t\t\treturn cdb;\n\t\t}\n\n\t\t// Non-Partitioned\n\t\t// D : one big Delimited string { partitioned: false, delimited : true }\n\t\t// NDA : Non-Delimited Array : one iterable array with empty string collection partitions { partitioned: false, delimited: false }\n\n\t\t// D\n\t\tif (options.delimited) {\n\t\t\tworkarray = destructuredSource.split(options.delimiter);\n\t\t\tdestructuredSource = null; // lower memory pressure\n\t\t\tlen = workarray.length;\n\n\t\t\tif (len === 0) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t\t// NDA\n\t\telse {\n\t\t\tworkarray = destructuredSource;\n\t\t}\n\n\t\t// first line is database and collection shells\n\t\tcdb = JSON.parse(workarray[0]);\n\t\tcollCount = cdb.collections.length;\n\t\tworkarray[0] = null;\n\n\t\twhile (!done) {\n\t\t\tcurrLine = workarray[lineIndex];\n\n\t\t\t// empty string indicates either end of collection or end of file\n\t\t\tif (workarray[lineIndex] === \"\") {\n\t\t\t\t// if no more collections to load into, we are done\n\t\t\t\tif (++collIndex > collCount) {\n\t\t\t\t\tdone = true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tcurrObject = JSON.parse(workarray[lineIndex]);\n\t\t\t\tcdb.collections[collIndex].data.push(currObject);\n\t\t\t}\n\n\t\t\t// lower memory pressure and advance iterator\n\t\t\tworkarray[lineIndex++] = null;\n\t\t}\n\n\t\treturn cdb;\n\t};\n\n\t/**\n\t * Deserializes a destructured collection.\n\t *\n\t * @param {string|array} destructuredSource - destructured representation of collection to inflate\n\t * @param {object} options - used to describe format of destructuredSource input\n\t * @param {int} options.delimited - whether source is delimited string or an array\n\t * @param {string} options.delimiter - (optional) if delimited, this is delimiter to use\n\t *\n\t * @returns {array} an array of documents to attach to collection.data.\n\t * @memberof Loki\n\t */\n\tdeserializeCollection(destructuredSource, options) {\n\t\tvar workarray = [];\n\t\tvar idx, len;\n\n\t\toptions = options || {};\n\n\t\tif (!options.hasOwnProperty(\"partitioned\")) {\n\t\t\toptions.partitioned = false;\n\t\t}\n\n\t\tif (!options.hasOwnProperty(\"delimited\")) {\n\t\t\toptions.delimited = true;\n\t\t}\n\n\t\tif (!options.hasOwnProperty(\"delimiter\")) {\n\t\t\toptions.delimiter = this.options.destructureDelimiter;\n\t\t}\n\n\t\tif (options.delimited) {\n\t\t\tworkarray = destructuredSource.split(options.delimiter);\n\t\t\tworkarray.pop();\n\t\t} else {\n\t\t\tworkarray = destructuredSource;\n\t\t}\n\n\t\tlen = workarray.length;\n\t\tfor (idx = 0; idx < len; idx++) {\n\t\t\tworkarray[idx] = JSON.parse(workarray[idx]);\n\t\t}\n\n\t\treturn workarray;\n\t};\n\n\t/**\n\t * Inflates a loki database from a serialized JSON string\n\t *\n\t * @param {string} serializedDb - a serialized loki database string\n\t * @param {object} options - apply or override collection level settings\n\t * @memberof Loki\n\t */\n\tloadJSON(serializedDb, options) {\n\t\tvar dbObject;\n\t\tif (serializedDb.length === 0) {\n\t\t\tdbObject = {};\n\t\t} else {\n\t\t\t// using option defined in instantiated db not what was in serialized db\n\t\t\tswitch (this.options.serializationMethod) {\n\t\t\t\tcase \"normal\":\n\t\t\t\tcase \"pretty\":\n\t\t\t\t\tdbObject = JSON.parse(serializedDb);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"destructured\":\n\t\t\t\t\tdbObject = this.deserializeDestructured(serializedDb);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tdbObject = JSON.parse(serializedDb);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tthis.loadJSONObject(dbObject, options);\n\t};\n\n\t/**\n\t * Inflates a loki database from a JS object\n\t *\n\t * @param {object} dbObject - a serialized loki database string\n\t * @param {object} options - apply or override collection level settings\n\t * @param {bool?} options.retainDirtyFlags - whether collection dirty flags will be preserved\n\t * @memberof Loki\n\t */\n\tloadJSONObject(dbObject, options) {\n\t\tvar i = 0,\n\t\t\tlen = dbObject.collections ? dbObject.collections.length : 0,\n\t\t\tcoll,\n\t\t\tcopyColl,\n\t\t\tclen,\n\t\t\tj,\n\t\t\tloader,\n\t\t\tcollObj;\n\n\t\tthis.name = dbObject.name;\n\n\t\t// restore database version\n\t\tthis.databaseVersion = 1.0;\n\t\tif (dbObject.hasOwnProperty('databaseVersion')) {\n\t\t\tthis.databaseVersion = dbObject.databaseVersion;\n\t\t}\n\n\t\tthis.collections = [];\n\n\t\tfunction makeLoader(coll) {\n\t\t\tvar collOptions = options[coll.name];\n\t\t\tvar inflater;\n\n\t\t\tif (collOptions.proto) {\n\t\t\t\tinflater = collOptions.inflate || Utils.copyProperties;\n\n\t\t\t\treturn function(data) {\n\t\t\t\t\tvar collObj = new(collOptions.proto)();\n\t\t\t\t\tinflater(data, collObj);\n\t\t\t\t\treturn collObj;\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn collOptions.inflate;\n\t\t}\n\n\t\tfor (i; i < len; i += 1) {\n\t\t\tcoll = dbObject.collections[i];\n\t\t\tcopyColl = this.addCollection(coll.name);\n\n\t\t\tcopyColl.adaptiveBinaryIndices = coll.hasOwnProperty('adaptiveBinaryIndices') ? (coll.adaptiveBinaryIndices === true) : false;\n\t\t\tcopyColl.transactional = coll.transactional;\n\t\t\tcopyColl.asyncListeners = coll.asyncListeners;\n\t\t\tcopyColl.disableChangesApi = coll.disableChangesApi;\n\t\t\tcopyColl.cloneObjects = coll.cloneObjects;\n\t\t\tcopyColl.cloneMethod = coll.cloneMethod || \"parse-stringify\";\n\t\t\tcopyColl.autoupdate = coll.autoupdate;\n\t\t\tcopyColl.changes = coll.changes;\n\n\t\t\tif (options && options.retainDirtyFlags === true) {\n\t\t\t\tcopyColl.dirty = coll.dirty;\n\t\t\t} else {\n\t\t\t\tcopyColl.dirty = false;\n\t\t\t}\n\n\t\t\t// load each element individually\n\t\t\tclen = coll.data.length;\n\t\t\tj = 0;\n\t\t\tif (options && options.hasOwnProperty(coll.name)) {\n\t\t\t\tloader = makeLoader(coll);\n\n\t\t\t\tfor (j; j < clen; j++) {\n\t\t\t\t\tcollObj = loader(coll.data[j]);\n\t\t\t\t\tcopyColl.data[j] = collObj;\n\t\t\t\t\tcopyColl.addAutoUpdateObserver(collObj);\n\t\t\t\t}\n\t\t\t} else {\n\n\t\t\t\tfor (j; j < clen; j++) {\n\t\t\t\t\tcopyColl.data[j] = coll.data[j];\n\t\t\t\t\tcopyColl.addAutoUpdateObserver(copyColl.data[j]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcopyColl.maxId = (coll.data.length === 0) ? 0 : coll.maxId;\n\t\t\tcopyColl.idIndex = coll.idIndex;\n\t\t\tif (typeof(coll.binaryIndices) !== 'undefined') {\n\t\t\t\tcopyColl.binaryIndices = coll.binaryIndices;\n\t\t\t}\n\t\t\tif (typeof coll.transforms !== 'undefined') {\n\t\t\t\tcopyColl.transforms = coll.transforms;\n\t\t\t}\n\n\t\t\tcopyColl.ensureId();\n\n\t\t\t// regenerate unique indexes\n\t\t\tcopyColl.uniqueNames = [];\n\t\t\tif (coll.hasOwnProperty(\"uniqueNames\")) {\n\t\t\t\tcopyColl.uniqueNames = coll.uniqueNames;\n\t\t\t\tfor (j = 0; j < copyColl.uniqueNames.length; j++) {\n\t\t\t\t\tcopyColl.ensureUniqueIndex(copyColl.uniqueNames[j]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// in case they are loading a database created before we added dynamic views, handle undefined\n\t\t\tif (typeof(coll.DynamicViews) === 'undefined') continue;\n\n\t\t\t// reinflate DynamicViews and attached Resultsets\n\t\t\tfor (var idx = 0; idx < coll.DynamicViews.length; idx++) {\n\t\t\t\tvar colldv = coll.DynamicViews[idx];\n\n\t\t\t\tvar dv = copyColl.addDynamicView(colldv.name, colldv.options);\n\t\t\t\tdv.resultdata = colldv.resultdata;\n\t\t\t\tdv.resultsdirty = colldv.resultsdirty;\n\t\t\t\tdv.filterPipeline = colldv.filterPipeline;\n\n\t\t\t\tdv.sortCriteria = colldv.sortCriteria;\n\t\t\t\tdv.sortFunction = null;\n\n\t\t\t\tdv.sortDirty = colldv.sortDirty;\n\t\t\t\tdv.resultset.filteredrows = colldv.resultset.filteredrows;\n\t\t\t\tdv.resultset.searchIsChained = colldv.resultset.searchIsChained;\n\t\t\t\tdv.resultset.filterInitialized = colldv.resultset.filterInitialized;\n\n\t\t\t\tdv.rematerialize({\n\t\t\t\t\tremoveWhereFilters: true\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Emits the close event. In autosave scenarios, if the database is dirty, this will save and disable timer.\n\t * Does not actually destroy the db.\n\t *\n\t * @returns {Promise} a Promise that resolves after closing the database succeeded\n\t * @memberof Loki\n\t */\n\tclose() {\n\t\tvar self = this;\n\t\tvar saved;\n\n\t\t// for autosave scenarios, we will let close perform final save (if dirty)\n\t\t// For web use, you might call from window.onbeforeunload to shutdown database, saving pending changes\n\t\tif (this.autosave) {\n\t\t\tthis.autosaveDisable();\n\t\t\tif (this.autosaveDirty()) {\n\t\t\t\tsaved = this.saveDatabase();\n\t\t\t}\n\t\t}\n\n\t\treturn Promise.resolve(saved).then(function() {\n\t\t\tself.emit('close');\n\t\t});\n\t};\n\n\t/**-------------------------+\n\t | Changes API               |\n\t +--------------------------*/\n\n\t/**\n\t * The Changes API enables the tracking the changes occurred in the collections since the beginning of the session,\n\t * so it's possible to create a differential dataset for synchronization purposes (possibly to a remote db)\n\t */\n\n\t/**\n\t * (Changes API) : takes all the changes stored in each\n\t * collection and creates a single array for the entire database. If an array of names\n\t * of collections is passed then only the included collections will be tracked.\n\t *\n\t * @param {array=} optional array of collection names. No arg means all collections are processed.\n\t * @returns {array} array of changes\n\t * @see private method createChange() in Collection\n\t * @memberof Loki\n\t */\n\tgenerateChangesNotification(arrayOfCollectionNames) {\n\t\tfunction getCollName(coll) {\n\t\t\treturn coll.name;\n\t\t}\n\t\tvar changes = [],\n\t\t\tselectedCollections = arrayOfCollectionNames || this.collections.map(getCollName);\n\n\t\tthis.collections.forEach(function(coll) {\n\t\t\tif (selectedCollections.indexOf(getCollName(coll)) !== -1) {\n\t\t\t\tchanges = changes.concat(coll.getChanges());\n\t\t\t}\n\t\t});\n\t\treturn changes;\n\t};\n\n\t/**\n\t * (Changes API) - stringify changes for network transmission\n\t * @returns {string} string representation of the changes\n\t * @memberof Loki\n\t */\n\tserializeChanges(collectionNamesArray) {\n\t\treturn JSON.stringify(this.generateChangesNotification(collectionNamesArray));\n\t};\n\n\t/**\n\t * (Changes API) : clears all the changes in all collections.\n\t * @memberof Loki\n\t */\n\tclearChanges() {\n\t\tthis.collections.forEach(function(coll) {\n\t\t\tif (coll.flushChanges) {\n\t\t\t\tcoll.flushChanges();\n\t\t\t}\n\t\t});\n\t};\n\n\t/**\n\t * Handles loading from file system, local storage, or adapter (indexeddb).\n\t *\n\t * @param {object} options - an object containing inflation options for each collection\n\t * @returns {Promise} a Promise that resolves after the database is loaded\n\t * @memberof Loki\n\t */\n\tloadDatabase(options) {\n\t\tvar self = this;\n\n\t\t// the persistenceAdapter should be present if all is ok, but check to be sure.\n\t\tif (this.persistenceAdapter === null) {\n\t\t\treturn Promise.reject(new Error('persistenceAdapter not configured'));\n\t\t}\n\n\t\treturn Promise.resolve(this.persistenceAdapter.loadDatabase(this.filename))\n\t\t\t.then(function loadDatabaseCallback(dbString) {\n\t\t\t\tif (typeof(dbString) === 'string') {\n\t\t\t\t\tself.loadJSON(dbString, options || {});\n\t\t\t\t\tself.emit('load', self);\n\t\t\t\t} else {\n\t\t\t\t\t// if adapter has returned an js object (other than null or error) attempt to load from JSON object\n\t\t\t\t\tif (typeof(dbString) === \"object\" && dbString !== null && !(dbString instanceof Error)) {\n\t\t\t\t\t\tself.loadJSONObject(dbString, options || {});\n\t\t\t\t\t\tself.emit('load', self);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (dbString instanceof Error)\n\t\t\t\t\t\t\tthrow dbString;\n\n\t\t\t\t\t\tthrow new TypeError('The persistence adapter did not load a serialized DB string or object.');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t};\n\n\t/**\n\t * Handles saving to file system, local storage, or adapter (indexeddb)\n\t *\n\t * @memberof Loki\n\t * @returns {Promise} a Promise that resolves after the database is persisted\n\t */\n\tsaveDatabase() {\n\t\tvar self = this;\n\n\t\t// the persistenceAdapter should be present if all is ok, but check to be sure.\n\t\tif (this.persistenceAdapter === null) {\n\t\t\treturn Promise.reject(new Error('persistenceAdapter not configured'));\n\t\t}\n\n\t\tvar saved;\n\n\t\t// check if the adapter is requesting (and supports) a 'reference' mode export\n\t\tif (this.persistenceAdapter.mode === \"reference\" && typeof this.persistenceAdapter.exportDatabase === \"function\") {\n\t\t\t// filename may seem redundant but loadDatabase will need to expect this same filename\n\t\t\tsaved = this.persistenceAdapter.exportDatabase(this.filename, this.copy({\n\t\t\t\tremoveNonSerializable: true\n\t\t\t}));\n\t\t}\n\t\t// otherwise just pass the serialized database to adapter\n\t\telse {\n\t\t\tsaved = this.persistenceAdapter.saveDatabase(this.filename, self.serialize());\n\t\t}\n\n\t\treturn Promise.resolve(saved).then(function() {\n\t\t\tself.autosaveClearFlags();\n\t\t\tself.emit(\"save\");\n\t\t});\n\t};\n\n\t// alias\n\tsave() {\n\t\treturn this.saveDatabase();\n\t}\n\n\t/**\n\t * Handles deleting a database from file system, local storage, or adapter (indexeddb)\n\t *\n\t * @returns {Promise} a Promise that resolves after the database is deleted\n\t * @memberof Loki\n\t */\n\tdeleteDatabase() {\n\t\t// the persistenceAdapter should be present if all is ok, but check to be sure.\n\t\tif (this.persistenceAdapter === null) {\n\t\t\treturn Promise.reject(new Error('persistenceAdapter not configured'));\n\t\t}\n\n\t\treturn Promise.resolve(this.persistenceAdapter.deleteDatabase(this.filename));\n\t};\n\n\t/**\n\t * autosaveDirty - check whether any collections are 'dirty' meaning we need to save (entire) database\n\t *\n\t * @returns {boolean} - true if database has changed since last autosave, false if not.\n\t */\n\tautosaveDirty() {\n\t\tfor (var idx = 0; idx < this.collections.length; idx++) {\n\t\t\tif (this.collections[idx].dirty) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\t/**\n\t * autosaveClearFlags - resets dirty flags on all collections.\n\t *    Called from saveDatabase() after db is saved.\n\t *\n\t */\n\tautosaveClearFlags() {\n\t\tfor (var idx = 0; idx < this.collections.length; idx++) {\n\t\t\tthis.collections[idx].dirty = false;\n\t\t}\n\t};\n\n\t/**\n\t * autosaveEnable - begin a javascript interval to periodically save the database.\n\t *\n\t */\n\tautosaveEnable() {\n\t\tif (this.autosaveHandle) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar self = this;\n\t\tvar running = true;\n\n\t\tthis.autosave = true;\n\t\tthis.autosaveHandle = function() {\n\t\t\trunning = false;\n\t\t\tself.autosaveHandle = undefined;\n\t\t};\n\n\t\t(function saveDatabase() {\n\t\t\tsetTimeout(function() {\n\t\t\t\tif (running) {\n\t\t\t\t\tself.saveDatabase().then(saveDatabase, saveDatabase);\n\t\t\t\t}\n\t\t\t}, self.autosaveInterval);\n\t\t})();\n\t};\n\n\t/**\n\t * autosaveDisable - stop the autosave interval timer.\n\t *\n\t */\n\tautosaveDisable() {\n\t\tthis.autosave = false;\n\n\t\tif (this.autosaveHandle) {\n\t\t\tthis.autosaveHandle();\n\t\t}\n\t};\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/lokicore.js","\n/*\n 'listen' is not defined  no-undef\n */\n\n/**\n * LokiEventEmitter is a minimalist version of EventEmitter. It enables any\n * constructor that inherits EventEmitter to emit events and trigger\n * listeners that have been added to the event through the on(event, callback) method\n *\n * @constructor LokiEventEmitter\n */\nexport class LokiEventEmitter {\n\n\tconstructor() {\n\t\t/**\n\t\t * @prop {hashmap} events - a hashmap, with each property being an array of callbacks\n\t\t * @memberof LokiEventEmitter\n\t\t */\n\t\tthis.events = {};\n\n\t\t/**\n\t\t * @prop {boolean} asyncListeners - boolean determines whether or not the callbacks associated with each event\n\t\t * should happen in an async fashion or not\n\t\t * Default is false, which means events are synchronous\n\t\t * @memberof LokiEventEmitter\n\t\t */\n\t\tthis.asyncListeners = false;\n\t}\n\n\t/**\n\t * on(eventName, listener) - adds a listener to the queue of callbacks associated to an event\n\t * @param {string|string[]} eventName - the name(s) of the event(s) to listen to\n\t * @param {function} listener - callback function of listener to attach\n\t * @returns {int} the index of the callback in the array of listeners for a particular event\n\t * @memberof LokiEventEmitter\n\t */\n\ton(eventName, listener) {\n\t\tvar event;\n\t\tvar self = this;\n\n\t\tif (Array.isArray(eventName)) {\n\t\t\teventName.forEach(function(currentEventName) {\n\t\t\t\tself.on(currentEventName, listener);\n\t\t\t});\n\t\t\treturn listener;\n\t\t}\n\n\t\tevent = this.events[eventName];\n\t\tif (!event) {\n\t\t\tevent = this.events[eventName] = [];\n\t\t}\n\t\tevent.push(listener);\n\t\treturn listener;\n\t}\n\n\t/**\n\t * emit(eventName, data) - emits a particular event\n\t * with the option of passing optional parameters which are going to be processed by the callback\n\t * provided signatures match (i.e. if passing emit(event, arg0, arg1) the listener should take two parameters)\n\t * @param {string} eventName - the name of the event\n\t * @param {object=} data - optional object passed with the event\n\t * @memberof LokiEventEmitter\n\t */\n\temit(eventName, data) {\n\t\tvar self = this;\n\t\tif (eventName && this.events[eventName]) {\n\t\t\tthis.events[eventName].forEach(function(listener) {\n\t\t\t\tif (self.asyncListeners) {\n\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\tlistener(data);\n\t\t\t\t\t}, 1);\n\t\t\t\t} else {\n\t\t\t\t\tlistener(data);\n\t\t\t\t}\n\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Alias of LokiEventEmitter.prototype.on\n\t * addListener(eventName, listener) - adds a listener to the queue of callbacks associated to an event\n\t * @param {string|string[]} eventName - the name(s) of the event(s) to listen to\n\t * @param {function} listener - callback function of listener to attach\n\t * @returns {int} the index of the callback in the array of listeners for a particular event\n\t * @memberof LokiEventEmitter\n\t */\n\taddListener(eventName, listener) {\n\t\treturn this.on(eventName, listener);\n\t}\n\n\t/**\n\t * removeListener() - removes the listener at position 'index' from the event 'eventName'\n\t * @param {string|string[]} eventName - the name(s) of the event(s) which the listener is attached to\n\t * @param {function} listener - the listener callback function to remove from emitter\n\t * @memberof LokiEventEmitter\n\t */\n\tremoveListener(eventName, listener) {\n\t\tvar self = this;\n\t\tif (Array.isArray(eventName)) {\n\t\t\teventName.forEach(function(currentEventName) {\n\t\t\t\tself.removeListener(currentEventName, listen);\n\t\t\t});\n\t\t}\n\n\t\tif (this.events[eventName]) {\n\t\t\tvar listeners = this.events[eventName];\n\t\t\tlisteners.splice(listeners.indexOf(listener), 1);\n\t\t}\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/event_emitter.js","\n/**\n * A loki persistence adapter which persists using node fs module\n * @constructor LokiFsAdapter\n */\nexport class LokiFsAdapter {\n\n\tconstructor() {\n\t\tthis.fs = undefined //TODO require('fs');\n\t}\n\n\t/**\n\t * loadDatabase() - Load data from file, will throw an error if the file does not exist\n\t * @param {string} dbname - the filename of the database to load\n\t * @returns {Promise} a Promise that resolves after the database was loaded\n\t * @memberof LokiFsAdapter\n\t */\n\tloadDatabase(dbname) {\n\t\tvar self = this;\n\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tself.fs.stat(dbname, function(err, stats) {\n\t\t\t\tif (!err && stats.isFile()) {\n\t\t\t\t\tself.fs.readFile(dbname, {\n\t\t\t\t\t\tencoding: 'utf8'\n\t\t\t\t\t}, function readFileCallback(err, data) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\treject();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t};\n\n\t/**\n\t * saveDatabase() - save data to file, will throw an error if the file can't be saved\n\t * might want to expand this to avoid dataloss on partial save\n\t * @param {string} dbname - the filename of the database to load\n\t * @returns {Promise} a Promise that resolves after the database was persisted\n\t * @memberof LokiFsAdapter\n\t */\n\tsaveDatabase(dbname, dbstring) {\n\t\tvar self = this;\n\t\tvar tmpdbname = dbname + '~';\n\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tself.fs.writeFile(tmpdbname, dbstring, function(err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treject(err);\n\t\t\t\t} else {\n\t\t\t\t\tself.fs.rename(tmpdbname, dbname, function(err) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t};\n\n\t/**\n\t * deleteDatabase() - delete the database file, will throw an error if the\n\t * file can't be deleted\n\t * @param {string} dbname - the filename of the database to delete\n\t * @returns {Promise} a Promise that resolves after the database was deleted\n\t * @memberof LokiFsAdapter\n\t */\n\tdeleteDatabase(dbname) {\n\t\tvar self = this;\n\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tself.fs.unlink(dbname, function deleteDatabaseCallback(err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treject(err);\n\t\t\t\t} else {\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t};\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/fs_adapter.js","\nfunction localStorageAvailable() {\n\ttry {\n\t\treturn (window && window.localStorage !== undefined && window.localStorage !== null);\n\t} catch (e) {\n\t\treturn false;\n\t}\n}\n/*\n 'localStorageAvailable' is not defined\n */\n\n/**\n * A loki persistence adapter which persists to web browser's local storage object\n * @constructor LokiLocalStorageAdapter\n */\nexport class LokiLocalStorageAdapter {\n\n\t/**\n\t * loadDatabase() - Load data from localstorage\n\t * @param {string} dbname - the name of the database to load\n\t * @returns {Promise} a Promise that resolves after the database was loaded\n\t * @memberof LokiLocalStorageAdapter\n\t */\n\tloadDatabase(dbname) {\n\t\tif (localStorageAvailable()) {\n\t\t\treturn Promise.resolve(localStorage.getItem(dbname));\n\t\t}\n\n\t\treturn Promise.reject(new Error('localStorage is not available'));\n\t};\n\n\t/**\n\t * saveDatabase() - save data to localstorage, will throw an error if the file can't be saved\n\t * might want to expand this to avoid dataloss on partial save\n\t * @param {string} dbname - the filename of the database to load\n\t * @returns {Promise} a Promise that resolves after the database was saved\n\t * @memberof LokiLocalStorageAdapter\n\t */\n\tsaveDatabase(dbname, dbstring) {\n\t\tif (localStorageAvailable()) {\n\t\t\tlocalStorage.setItem(dbname, dbstring);\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn Promise.reject(new Error('localStorage is not available'));\n\t};\n\n\t/**\n\t * deleteDatabase() - delete the database from localstorage, will throw an error if it\n\t * can't be deleted\n\t * @param {string} dbname - the filename of the database to delete\n\t * @returns {Promise} a Promise that resolves after the database was deleted\n\t * @memberof LokiLocalStorageAdapter\n\t */\n\tdeleteDatabase(dbname) {\n\t\tif (localStorageAvailable()) {\n\t\t\tlocalStorage.removeItem(dbname);\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn Promise.reject(new Error('localStorage is not available'));\n\t};\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/local_storage_adapter.js","import {LokiEventEmitter} from './event_emitter';\nimport {UniqueIndex} from './unique_index'\nimport {ExactIndex} from './exact_index'\nimport {Resultset} from './resultset'\nimport {DynamicView} from './dynamic_view'\nimport {clone, cloneObjectArray} from './clone'\nimport {ltHelper, gtHelper} from './helper'\n\n/**\n * General utils, including statistical functions\n */\nfunction isDeepProperty(field) {\n\treturn field.indexOf('.') !== -1;\n}\n\nfunction parseBase10(num) {\n\treturn parseFloat(num, 10);\n}\n\nfunction add(a, b) {\n\treturn a + b;\n}\n\nfunction sub(a, b) {\n\treturn a - b;\n}\n\nfunction average(array) {\n\treturn (array.reduce(add, 0)) / array.length;\n}\n\nfunction standardDeviation(values) {\n\tvar avg = average(values);\n\tvar squareDiffs = values.map(function(value) {\n\t\tvar diff = value - avg;\n\t\tvar sqrDiff = diff * diff;\n\t\treturn sqrDiff;\n\t});\n\n\tvar avgSquareDiff = average(squareDiffs);\n\n\tvar stdDev = Math.sqrt(avgSquareDiff);\n\treturn stdDev;\n}\n\nfunction deepProperty(obj, property, isDeep) {\n\tif (isDeep === false) {\n\t\t// pass without processing\n\t\treturn obj[property];\n\t}\n\tvar pieces = property.split('.'),\n\t\troot = obj;\n\twhile (pieces.length > 0) {\n\t\troot = root[pieces.shift()];\n\t}\n\treturn root;\n}\n\n/*\n'UniqueIndex' is not defined                 no-undef\n'ExactIndex' is not defined                  no-undef\n'ltHelper' is not defined                    no-undef\n'gtHelper' is not defined                    no-undef\n'DynamicView' is not defined                 no-undef\n'clone' is not defined                       no-undef\n'Resultset' is not defined                   no-undef\n'cloneObjectArray' is not defined            no-undef\n\n'isDeepProperty' is not defined              no-undef\n'deepProperty' is not defined                no-undef\n'average' is not defined                     no-undef\n'standardDeviation' is not defined           no-undef\n'sub' is not defined                         no-undef\n */\n\n/**\n * Collection class that handles documents of same type\n * @constructor Collection\n * @implements LokiEventEmitter\n * @param {string} name - collection name\n * @param {(array|object)=} options - (optional) array of property names to be indicized OR a configuration object\n * @param {array} options.unique - array of property names to define unique constraints for\n * @param {array} options.exact - array of property names to define exact constraints for\n * @param {array} options.indices - array property names to define binary indexes for\n * @param {boolean} options.adaptiveBinaryIndices - collection indices will be actively rebuilt rather than lazily (default: true)\n * @param {boolean} options.asyncListeners - default is false\n * @param {boolean} options.disableChangesApi - default is true\n * @param {boolean} options.autoupdate - use Object.observe to update objects automatically (default: false)\n * @param {boolean} options.clone - specify whether inserts and queries clone to/from user\n * @param {string} options.cloneMethod - 'parse-stringify' (default), 'jquery-extend-deep', 'shallow'\n * @param {int} options.ttlInterval - time interval for clearing out 'aged' documents; not set by default.\n * @see {@link Loki#addCollection} for normal creation of collections\n */\nexport class Collection extends LokiEventEmitter {\n\n\tconstructor(name, options) {\n\t\tsuper();\n\t\t// the name of the collection\n\n\t\tthis.name = name;\n\t\t// the data held by the collection\n\t\tthis.data = [];\n\t\tthis.idIndex = []; // index of id\n\t\tthis.binaryIndices = {}; // user defined indexes\n\t\tthis.constraints = {\n\t\t\tunique: {},\n\t\t\texact: {}\n\t\t};\n\n\t\t// unique contraints contain duplicate object references, so they are not persisted.\n\t\t// we will keep track of properties which have unique contraint applied here, and regenerate on load\n\t\tthis.uniqueNames = [];\n\n\t\t// transforms will be used to store frequently used query chains as a series of steps\n\t\t// which itself can be stored along with the database.\n\t\tthis.transforms = {};\n\n\t\t// the object type of the collection\n\t\tthis.objType = name;\n\n\t\t// in autosave scenarios we will use collection level dirty flags to determine whether save is needed.\n\t\t// currently, if any collection is dirty we will autosave the whole database if autosave is configured.\n\t\t// defaulting to true since this is called from addCollection and adding a collection should trigger save\n\t\tthis.dirty = true;\n\n\t\t// private holders for cached data\n\t\tthis.cachedIndex = null;\n\t\tthis.cachedBinaryIndex = null;\n\t\tthis.cachedData = null;\n\t\tvar self = this;\n\n\t\t/* OPTIONS */\n\t\toptions = options || {};\n\n\t\t// exact match and unique constraints\n\t\tif (options.hasOwnProperty('unique')) {\n\t\t\tif (!Array.isArray(options.unique)) {\n\t\t\t\toptions.unique = [options.unique];\n\t\t\t}\n\t\t\toptions.unique.forEach(function (prop) {\n\t\t\t\tself.uniqueNames.push(prop); // used to regenerate on subsequent database loads\n\t\t\t\tself.constraints.unique[prop] = new UniqueIndex(prop);\n\t\t\t});\n\t\t}\n\n\t\tif (options.hasOwnProperty('exact')) {\n\t\t\toptions.exact.forEach(function (prop) {\n\t\t\t\tself.constraints.exact[prop] = new ExactIndex(prop);\n\t\t\t});\n\t\t}\n\n\t\t// if set to true we will optimally keep indices 'fresh' during insert/update/remove ops (never dirty/never needs rebuild)\n\t\t// if you frequently intersperse insert/update/remove ops between find ops this will likely be significantly faster option.\n\t\tthis.adaptiveBinaryIndices = options.hasOwnProperty('adaptiveBinaryIndices') ? options.adaptiveBinaryIndices : true;\n\n\t\t// is collection transactional\n\t\tthis.transactional = options.hasOwnProperty('transactional') ? options.transactional : false;\n\n\t\t// options to clone objects when inserting them\n\t\tthis.cloneObjects = options.hasOwnProperty('clone') ? options.clone : false;\n\n\t\t// default clone method (if enabled) is parse-stringify\n\t\tthis.cloneMethod = options.hasOwnProperty('cloneMethod') ? options.cloneMethod : \"parse-stringify\";\n\n\t\t// option to make event listeners async, default is sync\n\t\tthis.asyncListeners = options.hasOwnProperty('asyncListeners') ? options.asyncListeners : false;\n\n\t\t// disable track changes\n\t\tthis.disableChangesApi = options.hasOwnProperty('disableChangesApi') ? options.disableChangesApi : true;\n\n\t\t// option to observe objects and update them automatically, ignored if Object.observe is not supported\n\t\tthis.autoupdate = options.hasOwnProperty('autoupdate') ? options.autoupdate : false;\n\n\t\t//option to activate a cleaner daemon - clears \"aged\" documents at set intervals.\n\t\tthis.ttl = {\n\t\t\tage: null,\n\t\t\tttlInterval: null,\n\t\t\tdaemon: null\n\t\t};\n\t\tthis.setTTL(options.ttl || -1, options.ttlInterval);\n\n\t\t// currentMaxId - change manually at your own peril!\n\t\tthis.maxId = 0;\n\n\t\tthis.DynamicViews = [];\n\n\t\t// events\n\t\tthis.events = {\n\t\t\t'insert': [],\n\t\t\t'update': [],\n\t\t\t'pre-insert': [],\n\t\t\t'pre-update': [],\n\t\t\t'close': [],\n\t\t\t'flushbuffer': [],\n\t\t\t'error': [],\n\t\t\t'delete': [],\n\t\t\t'warning': []\n\t\t};\n\n\t\t// changes are tracked by collection and aggregated by the db\n\t\tthis.changes = [];\n\n\t\t// initialize the id index\n\t\tthis.ensureId();\n\t\tvar indices = [];\n\t\t// initialize optional user-supplied indices array ['age', 'lname', 'zip']\n\t\tif (options && options.indices) {\n\t\t\tif (Object.prototype.toString.call(options.indices) === '[object Array]') {\n\t\t\t\tindices = options.indices;\n\t\t\t} else if (typeof options.indices === 'string') {\n\t\t\t\tindices = [options.indices];\n\t\t\t} else {\n\t\t\t\tthrow new TypeError('Indices needs to be a string or an array of strings');\n\t\t\t}\n\t\t}\n\n\t\tfor (var idx = 0; idx < indices.length; idx++) {\n\t\t\tthis.ensureIndex(indices[idx]);\n\t\t}\n\n\t\tfunction observerCallback(changes) {\n\n\t\t\tvar changedObjects = typeof Set === 'function' ? new Set() : [];\n\n\t\t\tif (!changedObjects.add)\n\t\t\t\tchangedObjects.add = function (object) {\n\t\t\t\t\tif (this.indexOf(object) === -1)\n\t\t\t\t\t\tthis.push(object);\n\t\t\t\t\treturn this;\n\t\t\t\t};\n\n\t\t\tchanges.forEach(function (change) {\n\t\t\t\tchangedObjects.add(change.object);\n\t\t\t});\n\n\t\t\tchangedObjects.forEach(function (object) {\n\t\t\t\tif (!hasOwnProperty.call(object, '$loki'))\n\t\t\t\t\treturn self.removeAutoUpdateObserver(object);\n\t\t\t\ttry {\n\t\t\t\t\tself.update(object);\n\t\t\t\t} catch (err) {\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.observerCallback = observerCallback;\n\n\t\t/*\n\t\t * This method creates a clone of the current status of an object and associates operation and collection name,\n\t\t * so the parent db can aggregate and generate a changes object for the entire db\n\t\t */\n\t\tfunction createChange(name, op, obj) {\n\t\t\tself.changes.push({\n\t\t\t\tname: name,\n\t\t\t\toperation: op,\n\t\t\t\tobj: JSON.parse(JSON.stringify(obj))\n\t\t\t});\n\t\t}\n\n\t\t// clear all the changes\n\t\tfunction flushChanges() {\n\t\t\tself.changes = [];\n\t\t}\n\n\t\tthis.getChanges = function () {\n\t\t\treturn self.changes;\n\t\t};\n\n\t\tthis.flushChanges = flushChanges;\n\n\t\t/**\n\t\t * If the changes API is disabled make sure only metadata is added without re-evaluating everytime if the changesApi is enabled\n\t\t */\n\t\tfunction insertMeta(obj) {\n\t\t\tif (!obj) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!obj.meta) {\n\t\t\t\tobj.meta = {};\n\t\t\t}\n\n\t\t\tobj.meta.created = (new Date()).getTime();\n\t\t\tobj.meta.revision = 0;\n\t\t}\n\n\t\tfunction updateMeta(obj) {\n\t\t\tif (!obj) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tobj.meta.updated = (new Date()).getTime();\n\t\t\tobj.meta.revision += 1;\n\t\t}\n\n\t\tfunction createInsertChange(obj) {\n\t\t\tcreateChange(self.name, 'I', obj);\n\t\t}\n\n\t\tfunction createUpdateChange(obj) {\n\t\t\tcreateChange(self.name, 'U', obj);\n\t\t}\n\n\t\tfunction insertMetaWithChange(obj) {\n\t\t\tinsertMeta(obj);\n\t\t\tcreateInsertChange(obj);\n\t\t}\n\n\t\tfunction updateMetaWithChange(obj) {\n\t\t\tupdateMeta(obj);\n\t\t\tcreateUpdateChange(obj);\n\t\t}\n\n\n\t\t/* assign correct handler based on ChangesAPI flag */\n\t\tvar insertHandler, updateHandler;\n\n\t\tfunction setHandlers() {\n\t\t\tinsertHandler = self.disableChangesApi ? insertMeta : insertMetaWithChange;\n\t\t\tupdateHandler = self.disableChangesApi ? updateMeta : updateMetaWithChange;\n\t\t}\n\n\t\tsetHandlers();\n\n\t\tthis.setChangesApi = function (enabled) {\n\t\t\tself.disableChangesApi = !enabled;\n\t\t\tsetHandlers();\n\t\t};\n\t\t/**\n\t\t * built-in events\n\t\t */\n\t\tthis.on('insert', function insertCallback(obj) {\n\t\t\tinsertHandler(obj);\n\t\t});\n\n\t\tthis.on('update', function updateCallback(obj) {\n\t\t\tupdateHandler(obj);\n\t\t});\n\n\t\tthis.on('delete', function deleteCallback(obj) {\n\t\t\tif (!self.disableChangesApi) {\n\t\t\t\tcreateChange(self.name, 'R', obj);\n\t\t\t}\n\t\t});\n\n\t\tthis.on('warning', function (warning) {\n\t\t\tself.console.warn(warning);\n\t\t});\n\t\t// for de-serialization purposes\n\t\tflushChanges();\n\n\t\tthis.console = {\n\t\t\tlog: function () {\n\t\t\t},\n\t\t\twarn: function () {\n\t\t\t},\n\t\t\terror: function () {\n\t\t\t},\n\t\t};\n\n\t\t/* ------ STAGING API -------- */\n\t\t/**\n\t\t * stages: a map of uniquely identified 'stages', which hold copies of objects to be\n\t\t * manipulated without affecting the data in the original collection\n\t\t */\n\t\tthis.stages = {};\n\t\tthis.commitLog = [];\n\t}\n\n\taddAutoUpdateObserver(object) {\n\t\tif (!this.autoupdate || typeof Object.observe !== 'function')\n\t\t\treturn;\n\n\t\tObject.observe(object, this.observerCallback, ['add', 'update', 'delete', 'reconfigure', 'setPrototype']);\n\t}\n\n\tremoveAutoUpdateObserver(object) {\n\t\tif (!this.autoupdate || typeof Object.observe !== 'function')\n\t\t\treturn;\n\n\t\tObject.unobserve(object, this.observerCallback);\n\t}\n\n\t/**\n\t * Adds a named collection transform to the collection\n\t * @param {string} name - name to associate with transform\n\t * @param {array} transform - an array of transformation 'step' objects to save into the collection\n\t * @memberof Collection\n\t */\n\taddTransform(name, transform) {\n\t\tif (this.transforms.hasOwnProperty(name)) {\n\t\t\tthrow new Error(\"a transform by that name already exists\");\n\t\t}\n\n\t\tthis.transforms[name] = transform;\n\t}\n\n\t/**\n\t * Updates a named collection transform to the collection\n\t * @param {string} name - name to associate with transform\n\t * @param {object} transform - a transformation object to save into collection\n\t * @memberof Collection\n\t */\n\tsetTransform(name, transform) {\n\t\tthis.transforms[name] = transform;\n\t}\n\n\t/**\n\t * Removes a named collection transform from the collection\n\t * @param {string} name - name of collection transform to remove\n\t * @memberof Collection\n\t */\n\tremoveTransform(name) {\n\t\tdelete this.transforms[name];\n\t}\n\n\tbyExample(template) {\n\t\tvar k, obj, query;\n\t\tquery = [];\n\t\tfor (k in template) {\n\t\t\tif (!template.hasOwnProperty(k)) continue;\n\t\t\tquery.push((\n\t\t\t\tobj = {},\n\t\t\t\t\tobj[k] = template[k],\n\t\t\t\t\tobj\n\t\t\t));\n\t\t}\n\t\treturn {\n\t\t\t'$and': query\n\t\t};\n\t}\n\n\tfindObject(template) {\n\t\treturn this.findOne(this.byExample(template));\n\t}\n\n\tfindObjects(template) {\n\t\treturn this.find(this.byExample(template));\n\t}\n\n\t/*----------------------------+\n\t | TTL daemon                  |\n\t +----------------------------*/\n\tttlDaemonFuncGen() {\n\t\tvar collection = this;\n\t\tvar age = this.ttl.age;\n\t\treturn function ttlDaemon() {\n\t\t\tvar now = Date.now();\n\t\t\tvar toRemove = collection.chain().where(function daemonFilter(member) {\n\t\t\t\tvar timestamp = member.meta.updated || member.meta.created;\n\t\t\t\tvar diff = now - timestamp;\n\t\t\t\treturn age < diff;\n\t\t\t});\n\t\t\ttoRemove.remove();\n\t\t};\n\t}\n\n\tsetTTL(age, interval) {\n\t\tif (age < 0) {\n\t\t\tclearInterval(this.ttl.daemon);\n\t\t} else {\n\t\t\tthis.ttl.age = age;\n\t\t\tthis.ttl.ttlInterval = interval;\n\t\t\tthis.ttl.daemon = setInterval(this.ttlDaemonFuncGen(), interval);\n\t\t}\n\t}\n\n\t/*----------------------------+\n\t | INDEXING                    |\n\t +----------------------------*/\n\n\t/**\n\t * create a row filter that covers all documents in the collection\n\t */\n\tprepareFullDocIndex() {\n\t\tvar len = this.data.length;\n\t\tvar indexes = new Array(len);\n\t\tfor (var i = 0; i < len; i += 1) {\n\t\t\tindexes[i] = i;\n\t\t}\n\t\treturn indexes;\n\t}\n\n\t/**\n\t * Will allow reconfiguring certain collection options.\n\t * @param {boolean} options.adaptiveBinaryIndices - collection indices will be actively rebuilt rather than lazily\n\t * @memberof Collection\n\t */\n\tconfigureOptions(options) {\n\t\toptions = options || {};\n\n\t\tif (options.hasOwnProperty('adaptiveBinaryIndices')) {\n\t\t\tthis.adaptiveBinaryIndices = options.adaptiveBinaryIndices;\n\n\t\t\t// if switching to adaptive binary indices, make sure none are 'dirty'\n\t\t\tif (this.adaptiveBinaryIndices) {\n\t\t\t\tthis.ensureAllIndexes();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Ensure binary index on a certain field\n\t * @param {string} property - name of property to create binary index on\n\t * @param {boolean=} force - (Optional) flag indicating whether to construct index immediately\n\t * @memberof Collection\n\t */\n\tensureIndex(property, force) {\n\t\t// optional parameter to force rebuild whether flagged as dirty or not\n\t\tif (typeof(force) === 'undefined') {\n\t\t\tforce = false;\n\t\t}\n\n\t\tif (property === null || property === undefined) {\n\t\t\tthrow new Error('Attempting to set index without an associated property');\n\t\t}\n\n\t\tif (this.binaryIndices[property] && !force) {\n\t\t\tif (!this.binaryIndices[property].dirty) return;\n\t\t}\n\n\t\t// if the index is already defined and we are using adaptiveBinaryIndices and we are not forcing a rebuild, return.\n\t\tif (this.adaptiveBinaryIndices === true && this.binaryIndices.hasOwnProperty(property) && !force) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar index = {\n\t\t\t'name': property,\n\t\t\t'dirty': true,\n\t\t\t'values': this.prepareFullDocIndex()\n\t\t};\n\t\tthis.binaryIndices[property] = index;\n\n\t\tvar wrappedComparer =\n\t\t\t(function (p, data) {\n\t\t\t\treturn function (a, b) {\n\t\t\t\t\tvar objAp = data[a][p],\n\t\t\t\t\t\tobjBp = data[b][p];\n\t\t\t\t\tif (objAp !== objBp) {\n\t\t\t\t\t\tif (ltHelper(objAp, objBp, false)) return -1;\n\t\t\t\t\t\tif (gtHelper(objAp, objBp, false)) return 1;\n\t\t\t\t\t}\n\t\t\t\t\treturn 0;\n\t\t\t\t};\n\t\t\t})(property, this.data);\n\n\t\tindex.values.sort(wrappedComparer);\n\t\tindex.dirty = false;\n\n\t\tthis.dirty = true; // for autosave scenarios\n\t}\n\n\tgetSequencedIndexValues(property) {\n\t\tvar idx, idxvals = this.binaryIndices[property].values;\n\t\tvar result = \"\";\n\n\t\tfor (idx = 0; idx < idxvals.length; idx++) {\n\t\t\tresult += \" [\" + idx + \"] \" + this.data[idxvals[idx]][property];\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tensureUniqueIndex(field) {\n\t\tvar index = this.constraints.unique[field];\n\t\tif (!index) {\n\t\t\t// keep track of new unique index for regenerate after database (re)load.\n\t\t\tif (this.uniqueNames.indexOf(field) == -1) {\n\t\t\t\tthis.uniqueNames.push(field);\n\t\t\t}\n\t\t}\n\n\t\t// if index already existed, (re)loading it will likely cause collisions, rebuild always\n\t\tthis.constraints.unique[field] = index = new UniqueIndex(field);\n\t\tthis.data.forEach(function (obj) {\n\t\t\tindex.set(obj);\n\t\t});\n\t\treturn index;\n\t}\n\n\t/**\n\t * Ensure all binary indices\n\t */\n\tensureAllIndexes(force) {\n\t\tvar key, bIndices = this.binaryIndices;\n\t\tfor (key in bIndices) {\n\t\t\tif (hasOwnProperty.call(bIndices, key)) {\n\t\t\t\tthis.ensureIndex(key, force);\n\t\t\t}\n\t\t}\n\t}\n\n\tflagBinaryIndexesDirty() {\n\t\tvar key, bIndices = this.binaryIndices;\n\t\tfor (key in bIndices) {\n\t\t\tif (hasOwnProperty.call(bIndices, key)) {\n\t\t\t\tbIndices[key].dirty = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tflagBinaryIndexDirty(index) {\n\t\tif (this.binaryIndices[index])\n\t\t\tthis.binaryIndices[index].dirty = true;\n\t}\n\n\t/**\n\t * Quickly determine number of documents in collection (or query)\n\t * @param {object=} query - (optional) query object to count results of\n\t * @returns {number} number of documents in the collection\n\t * @memberof Collection\n\t */\n\tcount(query) {\n\t\tif (!query) {\n\t\t\treturn this.data.length;\n\t\t}\n\n\t\treturn this.chain().find(query).filteredrows.length;\n\t}\n\n\t/**\n\t * Rebuild idIndex\n\t */\n\tensureId() {\n\t\tvar len = this.data.length,\n\t\t\ti = 0;\n\n\t\tthis.idIndex = [];\n\t\tfor (i; i < len; i += 1) {\n\t\t\tthis.idIndex.push(this.data[i].$loki);\n\t\t}\n\t}\n\n\t/**\n\t * Add a dynamic view to the collection\n\t * @param {string} name - name of dynamic view to add\n\t * @param {object=} options - (optional) options to configure dynamic view with\n\t * @param {boolean} options.persistent - indicates if view is to main internal results array in 'resultdata'\n\t * @param {string} options.sortPriority - 'passive' (sorts performed on call to data) or 'active' (after updates)\n\t * @param {number} options.minRebuildInterval - minimum rebuild interval (need clarification to docs here)\n\t * @returns {DynamicView} reference to the dynamic view added\n\t * @memberof Collection\n\t **/\n\n\taddDynamicView(name, options) {\n\t\tvar dv = new DynamicView(this, name, options);\n\t\tthis.DynamicViews.push(dv);\n\n\t\treturn dv;\n\t}\n\n\t/**\n\t * Remove a dynamic view from the collection\n\t * @param {string} name - name of dynamic view to remove\n\t * @memberof Collection\n\t **/\n\tremoveDynamicView(name) {\n\t\tfor (var idx = 0; idx < this.DynamicViews.length; idx++) {\n\t\t\tif (this.DynamicViews[idx].name === name) {\n\t\t\t\tthis.DynamicViews.splice(idx, 1);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Look up dynamic view reference from within the collection\n\t * @param {string} name - name of dynamic view to retrieve reference of\n\t * @returns {DynamicView} A reference to the dynamic view with that name\n\t * @memberof Collection\n\t **/\n\tgetDynamicView(name) {\n\t\tfor (var idx = 0; idx < this.DynamicViews.length; idx++) {\n\t\t\tif (this.DynamicViews[idx].name === name) {\n\t\t\t\treturn this.DynamicViews[idx];\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Applies a 'mongo-like' find query object and passes all results to an update function.\n\t * For filter function querying you should migrate to [updateWhere()]{@link Collection#updateWhere}.\n\t *\n\t * @param {object|function} filterObject - 'mongo-like' query object (or deprecated filterFunction mode)\n\t * @param {function} updateFunction - update function to run against filtered documents\n\t * @memberof Collection\n\t */\n\tfindAndUpdate(filterObject, updateFunction) {\n\t\tif (typeof(filterObject) === \"function\") {\n\t\t\tthis.updateWhere(filterObject, updateFunction);\n\t\t} else {\n\t\t\tthis.chain().find(filterObject).update(updateFunction);\n\t\t}\n\t}\n\n\t/**\n\t * Applies a 'mongo-like' find query object removes all documents which match that filter.\n\t *\n\t * @param {object} filterObject - 'mongo-like' query object\n\t * @memberof Collection\n\t */\n\tfindAndRemove(filterObject) {\n\t\tthis.chain().find(filterObject).remove();\n\t}\n\n\t/**\n\t * Adds object(s) to collection, ensure object(s) have meta properties, clone it if necessary, etc.\n\t * @param {(object|array)} doc - the document (or array of documents) to be inserted\n\t * @returns {(object|array)} document or documents inserted\n\t * @memberof Collection\n\t */\n\tinsert(doc) {\n\t\tif (!Array.isArray(doc)) {\n\t\t\treturn this.insertOne(doc);\n\t\t}\n\n\t\t// holder to the clone of the object inserted if collections is set to clone objects\n\t\tvar obj;\n\t\tvar results = [];\n\n\t\tthis.emit('pre-insert', doc);\n\t\tfor (var i = 0, len = doc.length; i < len; i++) {\n\t\t\tobj = this.insertOne(doc[i], true);\n\t\t\tif (!obj) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tresults.push(obj);\n\t\t}\n\t\tthis.emit('insert', doc);\n\t\treturn results.length === 1 ? results[0] : results;\n\t}\n\n\t/**\n\t * Adds a single object, ensures it has meta properties, clone it if necessary, etc.\n\t * @param {object} doc - the document to be inserted\n\t * @param {boolean} bulkInsert - quiet pre-insert and insert event emits\n\t * @returns {object} document or 'undefined' if there was a problem inserting it\n\t * @memberof Collection\n\t */\n\tinsertOne(doc, bulkInsert) {\n\t\tvar err = null;\n\t\tvar returnObj;\n\n\t\tif (typeof doc !== 'object') {\n\t\t\terr = new TypeError('Document needs to be an object');\n\t\t} else if (doc === null) {\n\t\t\terr = new TypeError('Object cannot be null');\n\t\t}\n\n\t\tif (err !== null) {\n\t\t\tthis.emit('error', err);\n\t\t\tthrow err;\n\t\t}\n\n\t\t// if configured to clone, do so now... otherwise just use same obj reference\n\t\tvar obj = this.cloneObjects ? clone(doc, this.cloneMethod) : doc;\n\n\t\tif (typeof obj.meta === 'undefined') {\n\t\t\tobj.meta = {\n\t\t\t\trevision: 0,\n\t\t\t\tcreated: 0\n\t\t\t};\n\t\t}\n\n\t\t// allow pre-insert to modify actual collection reference even if cloning\n\t\tif (!bulkInsert) {\n\t\t\tthis.emit('pre-insert', obj);\n\t\t}\n\t\tif (!this.add(obj)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// if cloning, give user back clone of 'cloned' object with $loki and meta\n\t\treturnObj = this.cloneObjects ? clone(obj, this.cloneMethod) : obj;\n\n\t\tthis.addAutoUpdateObserver(returnObj);\n\t\tif (!bulkInsert) {\n\t\t\tthis.emit('insert', returnObj);\n\t\t}\n\t\treturn returnObj;\n\t}\n\n\t/**\n\t * Empties the collection.\n\t * @param {object=} options - configure clear behavior\n\t * @param {bool=} options.removeIndices - (default: false)\n\t * @memberof Collection\n\t */\n\tclear(options) {\n\t\tvar self = this;\n\n\t\toptions = options || {};\n\n\t\tthis.data = [];\n\t\tthis.idIndex = [];\n\t\tthis.cachedIndex = null;\n\t\tthis.cachedBinaryIndex = null;\n\t\tthis.cachedData = null;\n\t\tthis.maxId = 0;\n\t\tthis.DynamicViews = [];\n\t\tthis.dirty = true;\n\n\t\t// if removing indices entirely\n\t\tif (options.removeIndices === true) {\n\t\t\tthis.binaryIndices = {};\n\n\t\t\tthis.constraints = {\n\t\t\t\tunique: {},\n\t\t\t\texact: {}\n\t\t\t};\n\t\t\tthis.uniqueNames = [];\n\t\t}\n\t\t// clear indices but leave definitions in place\n\t\telse {\n\t\t\t// clear binary indices\n\t\t\tvar keys = Object.keys(this.binaryIndices);\n\t\t\tkeys.forEach(function (biname) {\n\t\t\t\tself.binaryIndices[biname].dirty = false;\n\t\t\t\tself.binaryIndices[biname].values = [];\n\t\t\t});\n\n\t\t\t// clear entire unique indices definition\n\t\t\tthis.constraints = {\n\t\t\t\tunique: {},\n\t\t\t\texact: {}\n\t\t\t};\n\n\t\t\t// add definitions back\n\t\t\tthis.uniqueNames.forEach(function (uiname) {\n\t\t\t\tself.ensureUniqueIndex(uiname);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Updates an object and notifies collection that the document has changed.\n\t * @param {object} doc - document to update within the collection\n\t * @memberof Collection\n\t */\n\tupdate(doc) {\n\t\tif (Array.isArray(doc)) {\n\t\t\tvar k = 0,\n\t\t\t\tlen = doc.length;\n\t\t\tfor (k; k < len; k += 1) {\n\t\t\t\tthis.update(doc[k]);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t// verify object is a properly formed document\n\t\tif (!hasOwnProperty.call(doc, '$loki')) {\n\t\t\tthrow new Error('Trying to update unsynced document. Please save the document first by using insert() or addMany()');\n\t\t}\n\t\ttry {\n\t\t\tthis.startTransaction();\n\t\t\tvar arr = this.get(doc.$loki, true),\n\t\t\t\toldInternal, // ref to existing obj\n\t\t\t\tnewInternal, // ref to new internal obj\n\t\t\t\tposition,\n\t\t\t\tself = this;\n\n\t\t\tif (!arr) {\n\t\t\t\tthrow new Error('Trying to update a document not in collection.');\n\t\t\t}\n\n\t\t\toldInternal = arr[0]; // -internal- obj ref\n\t\t\tposition = arr[1]; // position in data array\n\n\t\t\t// if configured to clone, do so now... otherwise just use same obj reference\n\t\t\tnewInternal = this.cloneObjects ? clone(doc, this.cloneMethod) : doc;\n\n\t\t\tthis.emit('pre-update', doc);\n\n\t\t\tObject.keys(this.constraints.unique).forEach(function (key) {\n\t\t\t\tself.constraints.unique[key].update(oldInternal, newInternal);\n\t\t\t});\n\n\t\t\t// operate the update\n\t\t\tthis.data[position] = newInternal;\n\n\t\t\tif (newInternal !== doc) {\n\t\t\t\tthis.addAutoUpdateObserver(doc);\n\t\t\t}\n\n\t\t\t// now that we can efficiently determine the data[] position of newly added document,\n\t\t\t// submit it for all registered DynamicViews to evaluate for inclusion/exclusion\n\t\t\tfor (var idx = 0; idx < this.DynamicViews.length; idx++) {\n\t\t\t\tthis.DynamicViews[idx].evaluateDocument(position, false);\n\t\t\t}\n\n\t\t\tvar key;\n\t\t\tif (this.adaptiveBinaryIndices) {\n\t\t\t\t// for each binary index defined in collection, immediately update rather than flag for lazy rebuild\n\t\t\t\tvar bIndices = this.binaryIndices;\n\t\t\t\tfor (key in bIndices) {\n\t\t\t\t\tthis.adaptiveBinaryIndexUpdate(position, key);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.flagBinaryIndexesDirty();\n\t\t\t}\n\n\t\t\tthis.idIndex[position] = newInternal.$loki;\n\t\t\t//this.flagBinaryIndexesDirty();\n\n\t\t\tthis.commit();\n\t\t\tthis.dirty = true; // for autosave scenarios\n\n\t\t\tthis.emit('update', doc, this.cloneObjects ? clone(oldInternal, this.cloneMethod) : null);\n\t\t\treturn doc;\n\t\t} catch (err) {\n\t\t\tthis.rollback();\n\t\t\tthis.console.error(err.message);\n\t\t\tthis.emit('error', err);\n\t\t\tthrow (err); // re-throw error so user does not think it succeeded\n\t\t}\n\t}\n\n\t/**\n\t * Add object to collection\n\t */\n\tadd(obj) {\n\t\t// if parameter isn't object exit with throw\n\t\tif ('object' !== typeof obj) {\n\t\t\tthrow new TypeError('Object being added needs to be an object');\n\t\t}\n\t\t// if object you are adding already has id column it is either already in the collection\n\t\t// or the object is carrying its own 'id' property.  If it also has a meta property,\n\t\t// then this is already in collection so throw error, otherwise rename to originalId and continue adding.\n\t\tif (typeof(obj.$loki) !== 'undefined') {\n\t\t\tthrow new Error('Document is already in collection, please use update()');\n\t\t}\n\n\t\t/*\n\t\t * try adding object to collection\n\t\t */\n\t\ttry {\n\t\t\tthis.startTransaction();\n\t\t\tthis.maxId++;\n\n\t\t\tif (isNaN(this.maxId)) {\n\t\t\t\tthis.maxId = (this.data[this.data.length - 1].$loki + 1);\n\t\t\t}\n\n\t\t\tobj.$loki = this.maxId;\n\t\t\tobj.meta.version = 0;\n\n\t\t\tvar key, constrUnique = this.constraints.unique;\n\t\t\tfor (key in constrUnique) {\n\t\t\t\tif (hasOwnProperty.call(constrUnique, key)) {\n\t\t\t\t\tconstrUnique[key].set(obj);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// add new obj id to idIndex\n\t\t\tthis.idIndex.push(obj.$loki);\n\n\t\t\t// add the object\n\t\t\tthis.data.push(obj);\n\n\t\t\tvar addedPos = this.data.length - 1;\n\n\t\t\t// now that we can efficiently determine the data[] position of newly added document,\n\t\t\t// submit it for all registered DynamicViews to evaluate for inclusion/exclusion\n\t\t\tvar dvlen = this.DynamicViews.length;\n\t\t\tfor (var i = 0; i < dvlen; i++) {\n\t\t\t\tthis.DynamicViews[i].evaluateDocument(addedPos, true);\n\t\t\t}\n\n\t\t\tif (this.adaptiveBinaryIndices) {\n\t\t\t\t// for each binary index defined in collection, immediately update rather than flag for lazy rebuild\n\t\t\t\tvar bIndices = this.binaryIndices;\n\t\t\t\tfor (key in bIndices) {\n\t\t\t\t\tthis.adaptiveBinaryIndexInsert(addedPos, key);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.flagBinaryIndexesDirty();\n\t\t\t}\n\n\t\t\tthis.commit();\n\t\t\tthis.dirty = true; // for autosave scenarios\n\n\t\t\treturn (this.cloneObjects) ? (clone(obj, this.cloneMethod)) : (obj);\n\t\t} catch (err) {\n\t\t\tthis.rollback();\n\t\t\tthis.console.error(err.message);\n\t\t\tthis.emit('error', err);\n\t\t\tthrow (err); // re-throw error so user does not think it succeeded\n\t\t}\n\t}\n\n\t/**\n\t * Applies a filter function and passes all results to an update function.\n\t *\n\t * @param {function} filterFunction - filter function whose results will execute update\n\t * @param {function} updateFunction - update function to run against filtered documents\n\t * @memberof Collection\n\t */\n\tupdateWhere(filterFunction, updateFunction) {\n\t\tvar results = this.where(filterFunction),\n\t\t\ti = 0,\n\t\t\tobj;\n\t\ttry {\n\t\t\tfor (i; i < results.length; i++) {\n\t\t\t\tobj = updateFunction(results[i]);\n\t\t\t\tthis.update(obj);\n\t\t\t}\n\n\t\t} catch (err) {\n\t\t\tthis.rollback();\n\t\t\tthis.console.error(err.message);\n\t\t}\n\t}\n\n\t/**\n\t * Remove all documents matching supplied filter function.\n\t * For 'mongo-like' querying you should migrate to [findAndRemove()]{@link Collection#findAndRemove}.\n\t * @param {function|object} query - query object to filter on\n\t * @memberof Collection\n\t */\n\tremoveWhere(query) {\n\t\tvar list;\n\t\tif (typeof query === 'function') {\n\t\t\tlist = this.data.filter(query);\n\t\t\tthis.remove(list);\n\t\t} else {\n\t\t\tthis.chain().find(query).remove();\n\t\t}\n\t}\n\n\tremoveDataOnly() {\n\t\tthis.remove(this.data.slice());\n\t}\n\n\t/**\n\t * Remove a document from the collection\n\t * @param {object} doc - document to remove from collection\n\t * @memberof Collection\n\t */\n\tremove(doc) {\n\t\tif (typeof doc === 'number') {\n\t\t\tdoc = this.get(doc);\n\t\t}\n\n\t\tif ('object' !== typeof doc) {\n\t\t\tthrow new Error('Parameter is not an object');\n\t\t}\n\t\tif (Array.isArray(doc)) {\n\t\t\tvar k = 0,\n\t\t\t\tlen = doc.length;\n\t\t\tfor (k; k < len; k += 1) {\n\t\t\t\tthis.remove(doc[k]);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (!hasOwnProperty.call(doc, '$loki')) {\n\t\t\tthrow new Error('Object is not a document stored in the collection');\n\t\t}\n\n\t\ttry {\n\t\t\tthis.startTransaction();\n\t\t\tvar arr = this.get(doc.$loki, true),\n\t\t\t\t// obj = arr[0],\n\t\t\t\tposition = arr[1];\n\t\t\tvar self = this;\n\t\t\tObject.keys(this.constraints.unique).forEach(function (key) {\n\t\t\t\tif (doc[key] !== null && typeof doc[key] !== 'undefined') {\n\t\t\t\t\tself.constraints.unique[key].remove(doc[key]);\n\t\t\t\t}\n\t\t\t});\n\t\t\t// now that we can efficiently determine the data[] position of newly added document,\n\t\t\t// submit it for all registered DynamicViews to remove\n\t\t\tfor (var idx = 0; idx < this.DynamicViews.length; idx++) {\n\t\t\t\tthis.DynamicViews[idx].removeDocument(position);\n\t\t\t}\n\n\t\t\tif (this.adaptiveBinaryIndices) {\n\t\t\t\t// for each binary index defined in collection, immediately update rather than flag for lazy rebuild\n\t\t\t\tvar key, bIndices = this.binaryIndices;\n\t\t\t\tfor (key in bIndices) {\n\t\t\t\t\tthis.adaptiveBinaryIndexRemove(position, key);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.flagBinaryIndexesDirty();\n\t\t\t}\n\n\t\t\tthis.data.splice(position, 1);\n\t\t\tthis.removeAutoUpdateObserver(doc);\n\n\t\t\t// remove id from idIndex\n\t\t\tthis.idIndex.splice(position, 1);\n\n\t\t\tthis.commit();\n\t\t\tthis.dirty = true; // for autosave scenarios\n\t\t\tthis.emit('delete', arr[0]);\n\t\t\tdelete doc.$loki;\n\t\t\tdelete doc.meta;\n\t\t\treturn doc;\n\n\t\t} catch (err) {\n\t\t\tthis.rollback();\n\t\t\tthis.console.error(err.message);\n\t\t\tthis.emit('error', err);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/*---------------------+\n\t | Finding methods     |\n\t +----------------------*/\n\n\t/**\n\t * Get by Id - faster than other methods because of the searching algorithm\n\t * @param {int} id - $loki id of document you want to retrieve\n\t * @param {boolean} returnPosition - if 'true' we will return [object, position]\n\t * @returns {(object|array|null)} Object reference if document was found, null if not,\n\t *     or an array if 'returnPosition' was passed.\n\t * @memberof Collection\n\t */\n\tget(id, returnPosition) {\n\t\tvar retpos = returnPosition || false,\n\t\t\tdata = this.idIndex,\n\t\t\tmax = data.length - 1,\n\t\t\tmin = 0,\n\t\t\tmid = (min + max) >> 1;\n\n\t\tid = typeof id === 'number' ? id : parseInt(id, 10);\n\n\t\tif (isNaN(id)) {\n\t\t\tthrow new TypeError('Passed id is not an integer');\n\t\t}\n\n\t\twhile (data[min] < data[max]) {\n\t\t\tmid = (min + max) >> 1;\n\n\t\t\tif (data[mid] < id) {\n\t\t\t\tmin = mid + 1;\n\t\t\t} else {\n\t\t\t\tmax = mid;\n\t\t\t}\n\t\t}\n\n\t\tif (max === min && data[min] === id) {\n\t\t\tif (retpos) {\n\t\t\t\treturn [this.data[min], min];\n\t\t\t}\n\t\t\treturn this.data[min];\n\t\t}\n\t\treturn null;\n\n\t}\n\n\t/**\n\t * Perform binary range lookup for the data[dataPosition][binaryIndexName] property value\n\t *    Since multiple documents may contain the same value (which the index is sorted on),\n\t *    we hone in on range and then linear scan range to find exact index array position.\n\t * @param {int} dataPosition : coll.data array index/position\n\t * @param {string} binaryIndexName : index to search for dataPosition in\n\t */\n\tgetBinaryIndexPosition(dataPosition, binaryIndexName) {\n\t\tvar val = this.data[dataPosition][binaryIndexName];\n\t\tvar index = this.binaryIndices[binaryIndexName].values;\n\n\t\t// i think calculateRange can probably be moved to collection\n\t\t// as it doesn't seem to need resultset.  need to verify\n\t\t//var rs = new Resultset(this, null, null);\n\t\tvar range = this.calculateRange(\"$eq\", binaryIndexName, val);\n\n\t\tif (range[0] === 0 && range[1] === -1) {\n\t\t\t// uhoh didn't find range\n\t\t\treturn null;\n\t\t}\n\n\t\tvar min = range[0];\n\t\tvar max = range[1];\n\n\t\t// narrow down the sub-segment of index values\n\t\t// where the indexed property value exactly matches our\n\t\t// value and then linear scan to find exact -index- position\n\t\tfor (var idx = min; idx <= max; idx++) {\n\t\t\tif (index[idx] === dataPosition) return idx;\n\t\t}\n\n\t\t// uhoh\n\t\treturn null;\n\t}\n\n\t/**\n\t * Adaptively insert a selected item to the index.\n\t * @param {int} dataPosition : coll.data array index/position\n\t * @param {string} binaryIndexName : index to search for dataPosition in\n\t */\n\tadaptiveBinaryIndexInsert(dataPosition, binaryIndexName) {\n\t\tvar index = this.binaryIndices[binaryIndexName].values;\n\t\tvar val = this.data[dataPosition][binaryIndexName];\n\t\t//var rs = new Resultset(this, null, null);\n\t\tvar idxPos = this.calculateRangeStart(binaryIndexName, val);\n\n\t\t// insert new data index into our binary index at the proper sorted location for relevant property calculated by idxPos.\n\t\t// doing this after adjusting dataPositions so no clash with previous item at that position.\n\t\tthis.binaryIndices[binaryIndexName].values.splice(idxPos, 0, dataPosition);\n\t}\n\n\t/**\n\t * Adaptively update a selected item within an index.\n\t * @param {int} dataPosition : coll.data array index/position\n\t * @param {string} binaryIndexName : index to search for dataPosition in\n\t */\n\tadaptiveBinaryIndexUpdate(dataPosition, binaryIndexName) {\n\t\t// linear scan needed to find old position within index unless we optimize for clone scenarios later\n\t\t// within (my) node 5.6.0, the following for() loop with strict compare is -much- faster than indexOf()\n\t\tvar idxPos,\n\t\t\tindex = this.binaryIndices[binaryIndexName].values,\n\t\t\tlen = index.length;\n\n\t\tfor (idxPos = 0; idxPos < len; idxPos++) {\n\t\t\tif (index[idxPos] === dataPosition) break;\n\t\t}\n\n\t\t//var idxPos = this.binaryIndices[binaryIndexName].values.indexOf(dataPosition);\n\t\tthis.binaryIndices[binaryIndexName].values.splice(idxPos, 1);\n\n\t\t//this.adaptiveBinaryIndexRemove(dataPosition, binaryIndexName, true);\n\t\tthis.adaptiveBinaryIndexInsert(dataPosition, binaryIndexName);\n\t}\n\n\t/**\n\t * Adaptively remove a selected item from the index.\n\t * @param {int} dataPosition : coll.data array index/position\n\t * @param {string} binaryIndexName : index to search for dataPosition in\n\t */\n\tadaptiveBinaryIndexRemove(dataPosition, binaryIndexName, removedFromIndexOnly) {\n\t\tvar idxPos = this.getBinaryIndexPosition(dataPosition, binaryIndexName);\n\t\tvar index = this.binaryIndices[binaryIndexName].values;\n\t\tvar len,\n\t\t\tidx;\n\n\t\tif (idxPos === null) {\n\t\t\t// throw new Error('unable to determine binary index position');\n\t\t\treturn null;\n\t\t}\n\n\t\t// remove document from index\n\t\tthis.binaryIndices[binaryIndexName].values.splice(idxPos, 1);\n\n\t\t// if we passed this optional flag parameter, we are calling from adaptiveBinaryIndexUpdate,\n\t\t// in which case data positions stay the same.\n\t\tif (removedFromIndexOnly === true) {\n\t\t\treturn;\n\t\t}\n\n\t\t// since index stores data array positions, if we remove a document\n\t\t// we need to adjust array positions -1 for all document positions greater than removed position\n\t\tlen = index.length;\n\t\tfor (idx = 0; idx < len; idx++) {\n\t\t\tif (index[idx] > dataPosition) {\n\t\t\t\tindex[idx]--;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Internal method used for index maintenance.  Given a prop (index name), and a value\n\t * (which may or may not yet exist) this will find the proper location where it can be added.\n\t */\n\tcalculateRangeStart(prop, val) {\n\t\tvar rcd = this.data;\n\t\tvar index = this.binaryIndices[prop].values;\n\t\tvar min = 0;\n\t\tvar max = index.length - 1;\n\t\tvar mid = 0;\n\n\t\tif (index.length === 0) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tvar minVal = rcd[index[min]][prop];\n\t\tvar maxVal = rcd[index[max]][prop];\n\n\t\t// hone in on start position of value\n\t\twhile (min < max) {\n\t\t\tmid = (min + max) >> 1;\n\n\t\t\tif (ltHelper(rcd[index[mid]][prop], val, false)) {\n\t\t\t\tmin = mid + 1;\n\t\t\t} else {\n\t\t\t\tmax = mid;\n\t\t\t}\n\t\t}\n\n\t\tvar lbound = min;\n\n\t\tif (ltHelper(rcd[index[lbound]][prop], val, false)) {\n\t\t\treturn lbound + 1;\n\t\t} else {\n\t\t\treturn lbound;\n\t\t}\n\t}\n\n\t/**\n\t * Internal method used for indexed $between.  Given a prop (index name), and a value\n\t * (which may or may not yet exist) this will find the final position of that upper range value.\n\t */\n\tcalculateRangeEnd(prop, val) {\n\t\tvar rcd = this.data;\n\t\tvar index = this.binaryIndices[prop].values;\n\t\tvar min = 0;\n\t\tvar max = index.length - 1;\n\t\tvar mid = 0;\n\n\t\tif (index.length === 0) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tvar minVal = rcd[index[min]][prop];\n\t\tvar maxVal = rcd[index[max]][prop];\n\n\t\t// hone in on start position of value\n\t\twhile (min < max) {\n\t\t\tmid = (min + max) >> 1;\n\n\t\t\tif (ltHelper(val, rcd[index[mid]][prop], false)) {\n\t\t\t\tmax = mid;\n\t\t\t} else {\n\t\t\t\tmin = mid + 1;\n\t\t\t}\n\t\t}\n\n\t\tvar ubound = max;\n\n\t\tif (gtHelper(rcd[index[ubound]][prop], val, false)) {\n\t\t\treturn ubound - 1;\n\t\t} else {\n\t\t\treturn ubound;\n\t\t}\n\t}\n\n\t/**\n\t * calculateRange() - Binary Search utility method to find range/segment of values matching criteria.\n\t *    this is used for collection.find() and first find filter of resultset/dynview\n\t *    slightly different than get() binary search in that get() hones in on 1 value,\n\t *    but we have to hone in on many (range)\n\t * @param {string} op - operation, such as $eq\n\t * @param {string} prop - name of property to calculate range for\n\t * @param {object} val - value to use for range calculation.\n\t * @returns {array} [start, end] index array positions\n\t */\n\tcalculateRange(op, prop, val) {\n\t\tvar rcd = this.data;\n\t\tvar index = this.binaryIndices[prop].values;\n\t\tvar min = 0;\n\t\tvar max = index.length - 1;\n\t\tvar mid = 0;\n\n\t\t// when no documents are in collection, return empty range condition\n\t\tif (rcd.length === 0) {\n\t\t\treturn [0, -1];\n\t\t}\n\n\t\tvar minVal = rcd[index[min]][prop];\n\t\tvar maxVal = rcd[index[max]][prop];\n\n\t\t// if value falls outside of our range return [0, -1] to designate no results\n\t\tswitch (op) {\n\t\t\tcase '$eq':\n\t\t\tcase '$aeq':\n\t\t\t\tif (ltHelper(val, minVal, false) || gtHelper(val, maxVal, false)) {\n\t\t\t\t\treturn [0, -1];\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase '$dteq':\n\t\t\t\tif (ltHelper(val, minVal, false) || gtHelper(val, maxVal, false)) {\n\t\t\t\t\treturn [0, -1];\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase '$gt':\n\t\t\t\tif (gtHelper(val, maxVal, true)) {\n\t\t\t\t\treturn [0, -1];\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase '$gte':\n\t\t\t\tif (gtHelper(val, maxVal, false)) {\n\t\t\t\t\treturn [0, -1];\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase '$lt':\n\t\t\t\tif (ltHelper(val, minVal, true)) {\n\t\t\t\t\treturn [0, -1];\n\t\t\t\t}\n\t\t\t\tif (ltHelper(maxVal, val, false)) {\n\t\t\t\t\treturn [0, rcd.length - 1];\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase '$lte':\n\t\t\t\tif (ltHelper(val, minVal, false)) {\n\t\t\t\t\treturn [0, -1];\n\t\t\t\t}\n\t\t\t\tif (ltHelper(maxVal, val, true)) {\n\t\t\t\t\treturn [0, rcd.length - 1];\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase '$between':\n\t\t\t\treturn ([this.calculateRangeStart(prop, val[0]), this.calculateRangeEnd(prop, val[1])]);\n\t\t\tcase '$in':\n\t\t\t\tvar idxset = [],\n\t\t\t\t\tsegResult = [];\n\t\t\t\t// query each value '$eq' operator and merge the seqment results.\n\t\t\t\tfor (var j = 0, len = val.length; j < len; j++) {\n\t\t\t\t\tvar seg = this.calculateRange('$eq', prop, val[j]);\n\n\t\t\t\t\tfor (var i = seg[0]; i <= seg[1]; i++) {\n\t\t\t\t\t\tif (idxset[i] === undefined) {\n\t\t\t\t\t\t\tidxset[i] = true;\n\t\t\t\t\t\t\tsegResult.push(i);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn segResult;\n\t\t}\n\n\t\t// hone in on start position of value\n\t\twhile (min < max) {\n\t\t\tmid = (min + max) >> 1;\n\n\t\t\tif (ltHelper(rcd[index[mid]][prop], val, false)) {\n\t\t\t\tmin = mid + 1;\n\t\t\t} else {\n\t\t\t\tmax = mid;\n\t\t\t}\n\t\t}\n\n\t\tvar lbound = min;\n\n\t\t// do not reset min, as the upper bound cannot be prior to the found low bound\n\t\tmax = index.length - 1;\n\n\t\t// hone in on end position of value\n\t\twhile (min < max) {\n\t\t\tmid = (min + max) >> 1;\n\n\t\t\tif (ltHelper(val, rcd[index[mid]][prop], false)) {\n\t\t\t\tmax = mid;\n\t\t\t} else {\n\t\t\t\tmin = mid + 1;\n\t\t\t}\n\t\t}\n\n\t\tvar ubound = max;\n\n\t\tvar lval = rcd[index[lbound]][prop];\n\t\tvar uval = rcd[index[ubound]][prop];\n\n\t\tswitch (op) {\n\t\t\tcase '$eq':\n\t\t\t\tif (lval !== val) {\n\t\t\t\t\treturn [0, -1];\n\t\t\t\t}\n\t\t\t\tif (uval !== val) {\n\t\t\t\t\tubound--;\n\t\t\t\t}\n\n\t\t\t\treturn [lbound, ubound];\n\t\t\tcase '$dteq':\n\t\t\t\tif (lval > val || lval < val) {\n\t\t\t\t\treturn [0, -1];\n\t\t\t\t}\n\t\t\t\tif (uval > val || uval < val) {\n\t\t\t\t\tubound--;\n\t\t\t\t}\n\n\t\t\t\treturn [lbound, ubound];\n\n\n\t\t\tcase '$gt':\n\t\t\t\tif (ltHelper(uval, val, true)) {\n\t\t\t\t\treturn [0, -1];\n\t\t\t\t}\n\n\t\t\t\treturn [ubound, rcd.length - 1];\n\n\t\t\tcase '$gte':\n\t\t\t\tif (ltHelper(lval, val, false)) {\n\t\t\t\t\treturn [0, -1];\n\t\t\t\t}\n\n\t\t\t\treturn [lbound, rcd.length - 1];\n\n\t\t\tcase '$lt':\n\t\t\t\tif (lbound === 0 && ltHelper(lval, val, false)) {\n\t\t\t\t\treturn [0, 0];\n\t\t\t\t}\n\t\t\t\treturn [0, lbound - 1];\n\n\t\t\tcase '$lte':\n\t\t\t\tif (uval !== val) {\n\t\t\t\t\tubound--;\n\t\t\t\t}\n\n\t\t\t\tif (ubound === 0 && ltHelper(uval, val, false)) {\n\t\t\t\t\treturn [0, 0];\n\t\t\t\t}\n\t\t\t\treturn [0, ubound];\n\n\t\t\tdefault:\n\t\t\t\treturn [0, rcd.length - 1];\n\t\t}\n\t}\n\n\t/**\n\t * Retrieve doc by Unique index\n\t * @param {string} field - name of uniquely indexed property to use when doing lookup\n\t * @param {value} value - unique value to search for\n\t * @returns {object} document matching the value passed\n\t * @memberof Collection\n\t */\n\tby(field, value) {\n\t\tvar self;\n\t\tif (value === undefined) {\n\t\t\tself = this;\n\t\t\treturn function (value) {\n\t\t\t\treturn self.by(field, value);\n\t\t\t};\n\t\t}\n\n\t\tvar result = this.constraints.unique[field].get(value);\n\t\tif (!this.cloneObjects) {\n\t\t\treturn result;\n\t\t} else {\n\t\t\treturn clone(result, this.cloneMethod);\n\t\t}\n\t}\n\n\t/**\n\t * Find one object by index property, by property equal to value\n\t * @param {object} query - query object used to perform search with\n\t * @returns {(object|null)} First matching document, or null if none\n\t * @memberof Collection\n\t */\n\tfindOne(query) {\n\t\tquery = query || {};\n\n\t\t// Instantiate Resultset and exec find op passing firstOnly = true param\n\t\tvar result = new Resultset(this, {\n\t\t\tqueryObj: query,\n\t\t\tfirstOnly: true\n\t\t});\n\n\t\tif (Array.isArray(result) && result.length === 0) {\n\t\t\treturn null;\n\t\t} else {\n\t\t\tif (!this.cloneObjects) {\n\t\t\t\treturn result;\n\t\t\t} else {\n\t\t\t\treturn clone(result, this.cloneMethod);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Chain method, used for beginning a series of chained find() and/or view() operations\n\t * on a collection.\n\t *\n\t * @param {array} transform - Ordered array of transform step objects similar to chain\n\t * @param {object} parameters - Object containing properties representing parameters to substitute\n\t * @returns {Resultset} (this) resultset, or data array if any map or join functions where called\n\t * @memberof Collection\n\t */\n\tchain(transform, parameters) {\n\t\tvar rs = new Resultset(this);\n\n\t\tif (typeof transform === 'undefined') {\n\t\t\treturn rs;\n\t\t}\n\n\t\treturn rs.transform(transform, parameters);\n\t}\n\n\t/**\n\t * Find method, api is similar to mongodb.\n\t * for more complex queries use [chain()]{@link Collection#chain} or [where()]{@link Collection#where}.\n\t * @example {@tutorial Query Examples}\n\t * @param {object} query - 'mongo-like' query object\n\t * @returns {array} Array of matching documents\n\t * @memberof Collection\n\t */\n\tfind(query) {\n\t\tif (typeof(query) === 'undefined') {\n\t\t\tquery = 'getAll';\n\t\t}\n\n\t\tvar results = new Resultset(this, {\n\t\t\tqueryObj: query\n\t\t});\n\t\tif (!this.cloneObjects) {\n\t\t\treturn results;\n\t\t} else {\n\t\t\treturn cloneObjectArray(results, this.cloneMethod);\n\t\t}\n\t}\n\n\t/**\n\t * Find object by unindexed field by property equal to value,\n\t * simply iterates and returns the first element matching the query\n\t */\n\tfindOneUnindexed(prop, value) {\n\t\tvar i = this.data.length,\n\t\t\tdoc;\n\t\twhile (i--) {\n\t\t\tif (this.data[i][prop] === value) {\n\t\t\t\tdoc = this.data[i];\n\t\t\t\treturn doc;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\t/**\n\t * Transaction methods\n\t */\n\n\t/** start the transation */\n\tstartTransaction() {\n\t\tif (this.transactional) {\n\t\t\tthis.cachedData = clone(this.data, this.cloneMethod);\n\t\t\tthis.cachedIndex = this.idIndex;\n\t\t\tthis.cachedBinaryIndex = this.binaryIndices;\n\n\t\t\t// propagate startTransaction to dynamic views\n\t\t\tfor (var idx = 0; idx < this.DynamicViews.length; idx++) {\n\t\t\t\tthis.DynamicViews[idx].startTransaction();\n\t\t\t}\n\t\t}\n\t}\n\n\t/** commit the transation */\n\tcommit() {\n\t\tif (this.transactional) {\n\t\t\tthis.cachedData = null;\n\t\t\tthis.cachedIndex = null;\n\t\t\tthis.cachedBinaryIndex = null;\n\n\t\t\t// propagate commit to dynamic views\n\t\t\tfor (var idx = 0; idx < this.DynamicViews.length; idx++) {\n\t\t\t\tthis.DynamicViews[idx].commit();\n\t\t\t}\n\t\t}\n\t}\n\n\t/** roll back the transation */\n\trollback() {\n\t\tif (this.transactional) {\n\t\t\tif (this.cachedData !== null && this.cachedIndex !== null) {\n\t\t\t\tthis.data = this.cachedData;\n\t\t\t\tthis.idIndex = this.cachedIndex;\n\t\t\t\tthis.binaryIndices = this.cachedBinaryIndex;\n\t\t\t}\n\n\t\t\t// propagate rollback to dynamic views\n\t\t\tfor (var idx = 0; idx < this.DynamicViews.length; idx++) {\n\t\t\t\tthis.DynamicViews[idx].rollback();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Query the collection by supplying a javascript filter function.\n\t * @example\n\t * var results = coll.where(function(obj) {\n\t *   return obj.legs === 8;\n\t * });\n\t *\n\t * @param {function} fun - filter function to run against all collection docs\n\t * @returns {array} all documents which pass your filter function\n\t * @memberof Collection\n\t */\n\twhere(fun) {\n\t\tvar results = new Resultset(this, {\n\t\t\tqueryFunc: fun\n\t\t});\n\t\tif (!this.cloneObjects) {\n\t\t\treturn results;\n\t\t} else {\n\t\t\treturn cloneObjectArray(results, this.cloneMethod);\n\t\t}\n\t}\n\n\t/**\n\t * Map Reduce operation\n\t *\n\t * @param {function} mapFunction - function to use as map function\n\t * @param {function} reduceFunction - function to use as reduce function\n\t * @returns {data} The result of your mapReduce operation\n\t * @memberof Collection\n\t */\n\tmapReduce(mapFunction, reduceFunction) {\n\t\ttry {\n\t\t\treturn reduceFunction(this.data.map(mapFunction));\n\t\t} catch (err) {\n\t\t\tthrow err;\n\t\t}\n\t}\n\n\t/**\n\t * Join two collections on specified properties\n\t *\n\t * @param {array} joinData - array of documents to 'join' to this collection\n\t * @param {string} leftJoinProp - property name in collection\n\t * @param {string} rightJoinProp - property name in joinData\n\t * @param {function=} mapFun - (Optional) map function to use\n\t * @returns {Resultset} Result of the mapping operation\n\t * @memberof Collection\n\t */\n\teqJoin(joinData, leftJoinProp, rightJoinProp, mapFun) {\n\t\t// logic in Resultset class\n\t\treturn new Resultset(this).eqJoin(joinData, leftJoinProp, rightJoinProp, mapFun);\n\t}\n\n\t/* ------ STAGING API -------- */\n\t/**\n\t * stages: a map of uniquely identified 'stages', which hold copies of objects to be\n\t * manipulated without affecting the data in the original collection\n\t */\n\n\n\t/**\n\t * (Staging API) create a stage and/or retrieve it\n\t * @memberof Collection\n\t */\n\tgetStage(name) {\n\t\tif (!this.stages[name]) {\n\t\t\tthis.stages[name] = {};\n\t\t}\n\t\treturn this.stages[name];\n\t}\n\n\t/**\n\t * a collection of objects recording the changes applied through a commmitStage\n\t */\n\n\t/**\n\t * (Staging API) create a copy of an object and insert it into a stage\n\t * @memberof Collection\n\t */\n\tstage(stageName, obj) {\n\t\tvar copy = JSON.parse(JSON.stringify(obj));\n\t\tthis.getStage(stageName)[obj.$loki] = copy;\n\t\treturn copy;\n\t}\n\n\t/**\n\t * (Staging API) re-attach all objects to the original collection, so indexes and views can be rebuilt\n\t * then create a message to be inserted in the commitlog\n\t * @param {string} stageName - name of stage\n\t * @param {string} message\n\t * @memberof Collection\n\t */\n\tcommitStage(stageName, message) {\n\t\tvar stage = this.getStage(stageName),\n\t\t\tprop,\n\t\t\ttimestamp = new Date().getTime();\n\n\t\tfor (prop in stage) {\n\n\t\t\tthis.update(stage[prop]);\n\t\t\tthis.commitLog.push({\n\t\t\t\ttimestamp: timestamp,\n\t\t\t\tmessage: message,\n\t\t\t\tdata: JSON.parse(JSON.stringify(stage[prop]))\n\t\t\t});\n\t\t}\n\t\tthis.stages[stageName] = {};\n\t}\n\n\tno_op() {\n\t\treturn;\n\t}\n\n\t/**\n\t * @memberof Collection\n\t */\n\textract(field) {\n\t\tvar i = 0,\n\t\t\tlen = this.data.length,\n\t\t\tisDotNotation = isDeepProperty(field),\n\t\t\tresult = [];\n\t\tfor (i; i < len; i += 1) {\n\t\t\tresult.push(deepProperty(this.data[i], field, isDotNotation));\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * @memberof Collection\n\t */\n\tmax(field) {\n\t\treturn Math.max.apply(null, this.extract(field));\n\t}\n\n\t/**\n\t * @memberof Collection\n\t */\n\tmin(field) {\n\t\treturn Math.min.apply(null, this.extract(field));\n\t}\n\n\t/**\n\t * @memberof Collection\n\t */\n\tmaxRecord(field) {\n\t\tvar i = 0,\n\t\t\tlen = this.data.length,\n\t\t\tdeep = isDeepProperty(field),\n\t\t\tresult = {\n\t\t\t\tindex: 0,\n\t\t\t\tvalue: undefined\n\t\t\t},\n\t\t\tmax;\n\n\t\tfor (i; i < len; i += 1) {\n\t\t\tif (max !== undefined) {\n\t\t\t\tif (max < deepProperty(this.data[i], field, deep)) {\n\t\t\t\t\tmax = deepProperty(this.data[i], field, deep);\n\t\t\t\t\tresult.index = this.data[i].$loki;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tmax = deepProperty(this.data[i], field, deep);\n\t\t\t\tresult.index = this.data[i].$loki;\n\t\t\t}\n\t\t}\n\t\tresult.value = max;\n\t\treturn result;\n\t}\n\n\t/**\n\t * @memberof Collection\n\t */\n\tminRecord(field) {\n\t\tvar i = 0,\n\t\t\tlen = this.data.length,\n\t\t\tdeep = isDeepProperty(field),\n\t\t\tresult = {\n\t\t\t\tindex: 0,\n\t\t\t\tvalue: undefined\n\t\t\t},\n\t\t\tmin;\n\n\t\tfor (i; i < len; i += 1) {\n\t\t\tif (min !== undefined) {\n\t\t\t\tif (min > deepProperty(this.data[i], field, deep)) {\n\t\t\t\t\tmin = deepProperty(this.data[i], field, deep);\n\t\t\t\t\tresult.index = this.data[i].$loki;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tmin = deepProperty(this.data[i], field, deep);\n\t\t\t\tresult.index = this.data[i].$loki;\n\t\t\t}\n\t\t}\n\t\tresult.value = min;\n\t\treturn result;\n\t}\n\n\t/**\n\t * @memberof Collection\n\t */\n\textractNumerical(field) {\n\t\treturn this.extract(field).map(parseBase10).filter(Number).filter(function (n) {\n\t\t\treturn !(isNaN(n));\n\t\t});\n\t}\n\n\t/**\n\t * Calculates the average numerical value of a property\n\t *\n\t * @param {string} field - name of property in docs to average\n\t * @returns {number} average of property in all docs in the collection\n\t * @memberof Collection\n\t */\n\tavg(field) {\n\t\treturn average(this.extractNumerical(field));\n\t}\n\n\t/**\n\t * Calculate standard deviation of a field\n\t * @memberof Collection\n\t * @param {string} field\n\t */\n\tstdDev(field) {\n\t\treturn standardDeviation(this.extractNumerical(field));\n\t}\n\n\t/**\n\t * @memberof Collection\n\t * @param {string} field\n\t */\n\tmode(field) {\n\t\tvar dict = {},\n\t\t\tdata = this.extract(field);\n\t\tdata.forEach(function (obj) {\n\t\t\tif (dict[obj]) {\n\t\t\t\tdict[obj] += 1;\n\t\t\t} else {\n\t\t\t\tdict[obj] = 1;\n\t\t\t}\n\t\t});\n\t\tvar max,\n\t\t\tprop, mode;\n\t\tfor (prop in dict) {\n\t\t\tif (max) {\n\t\t\t\tif (max < dict[prop]) {\n\t\t\t\t\tmode = prop;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tmode = prop;\n\t\t\t\tmax = dict[prop];\n\t\t\t}\n\t\t}\n\t\treturn mode;\n\t}\n\n\t/**\n\t * @memberof Collection\n\t * @param {string} field - property name\n\t */\n\tmedian(field) {\n\t\tvar values = this.extractNumerical(field);\n\t\tvalues.sort(sub);\n\n\t\tvar half = Math.floor(values.length / 2);\n\n\t\tif (values.length % 2) {\n\t\t\treturn values[half];\n\t\t} else {\n\t\t\treturn (values[half - 1] + values[half]) / 2.0;\n\t\t}\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/collection.js","export class UniqueIndex {\n\n\tconstructor(uniqueField) {\n\t\tthis.field = uniqueField;\n\t\tthis.keyMap = {};\n\t\tthis.lokiMap = {};\n\t}\n\n\tset(obj) {\n\t\tvar fieldValue = obj[this.field];\n\t\tif (fieldValue !== null && typeof(fieldValue) !== 'undefined') {\n\t\t\tif (this.keyMap[fieldValue]) {\n\t\t\t\tthrow new Error('Duplicate key for property ' + this.field + ': ' + fieldValue);\n\t\t\t} else {\n\t\t\t\tthis.keyMap[fieldValue] = obj;\n\t\t\t\tthis.lokiMap[obj.$loki] = fieldValue;\n\t\t\t}\n\t\t}\n\t};\n\n\tget(key) {\n\t\tconsole.log(key);\n\t\treturn this.keyMap[key];\n\t};\n\n\tbyId(id) {\n\t\tconsole.log(\"byId\", key);\n\t\treturn this.keyMap[this.lokiMap[id]];\n\t};\n\n\t/**\n\t * Updates a document's unique index given an updated object.\n\t * @param  {Object} obj Original document object\n\t * @param  {Object} doc New document object (likely the same as obj)\n\t */\n\tupdate(obj, doc) {\n\t\tif (this.lokiMap[obj.$loki] !== doc[this.field]) {\n\t\t\tvar old = this.lokiMap[obj.$loki];\n\t\t\tthis.set(doc);\n\t\t\t// make the old key fail bool test, while avoiding the use of delete (mem-leak prone)\n\t\t\tthis.keyMap[old] = undefined;\n\t\t} else {\n\t\t\tthis.keyMap[obj[this.field]] = doc;\n\t\t}\n\t};\n\tremove(key) {\n\t\tvar obj = this.keyMap[key];\n\t\tif (obj !== null && typeof obj !== 'undefined') {\n\t\t\tthis.keyMap[key] = undefined;\n\t\t\tthis.lokiMap[obj.$loki] = undefined;\n\t\t} else {\n\t\t\tthrow new Error('Key is not in unique index: ' + this.field);\n\t\t}\n\t};\n\tclear() {\n\t\tthis.keyMap = {};\n\t\tthis.lokiMap = {};\n\t};\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/unique_index.js","export class ExactIndex {\n\n\tconstructor(exactField) {\n\t\tthis.index = {};\n\t\tthis.field = exactField;\n\t}\n\n\t// add the value you want returned to the key in the index\n\tset(key, val) {\n\t\tif (this.index[key]) {\n\t\t\tthis.index[key].push(val);\n\t\t} else {\n\t\t\tthis.index[key] = [val];\n\t\t}\n\t\tconsole.log(\"?\")\n\t}\n\n\t// remove the value from the index, if the value was the last one, remove the key\n\tremove(key, val) {\n\t\tvar idxSet = this.index[key];\n\t\tfor (var i in idxSet) {\n\t\t\tif (idxSet[i] == val) {\n\t\t\t\tidxSet.splice(i, 1);\n\t\t\t}\n\t\t}\n\t\tif (idxSet.length < 1) {\n\t\t\tthis.index[key] = undefined;\n\t\t}\n\t}\n\n\t// get the values related to the key, could be more than one\n\tget(key) {\n\t\tconsole.log(\"!\")\n\t\treturn this.index[key];\n\t}\n\n\t// clear will zap the index\n\tclear(key) {\n\t\tthis.index = {};\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/exact_index.js","import {LokiEventEmitter} from './event_emitter';\nimport {clone} from './clone'\nimport {Collection} from './collection'\nimport {Utils} from './utils'\nimport {ltHelper, gtHelper} from './helper'\n\nfunction containsCheckFn(a) {\n\tif (typeof a === 'string' || Array.isArray(a)) {\n\t\treturn function(b) {\n\t\t\treturn a.indexOf(b) !== -1;\n\t\t};\n\t} else if (typeof a === 'object' && a !== null) {\n\t\treturn function(b) {\n\t\t\treturn hasOwnProperty.call(a, b);\n\t\t};\n\t}\n\treturn null;\n}\n\nfunction doQueryOp(val, op) {\n\tfor (var p in op) {\n\t\tif (hasOwnProperty.call(op, p)) {\n\t\t\treturn LokiOps[p](val, op[p]);\n\t\t}\n\t}\n\treturn false;\n}\n\n\nexport var LokiOps = {\n\t// comparison operators\n\t// a is the value in the collection\n\t// b is the query value\n\t$eq: function(a, b) {\n\t\treturn a === b;\n\t},\n\n\t// abstract/loose equality\n\t$aeq: function(a, b) {\n\t\treturn a == b;\n\t},\n\n\t$ne: function(a, b) {\n\t\t// ecma 5 safe test for NaN\n\t\tif (b !== b) {\n\t\t\t// ecma 5 test value is not NaN\n\t\t\treturn (a === a);\n\t\t}\n\n\t\treturn a !== b;\n\t},\n\n\t$dteq: function(a, b) {\n\t\tif (ltHelper(a, b, false)) {\n\t\t\treturn false;\n\t\t}\n\t\treturn !gtHelper(a, b, false);\n\t},\n\n\t$gt: function(a, b) {\n\t\treturn gtHelper(a, b, false);\n\t},\n\n\t$gte: function(a, b) {\n\t\treturn gtHelper(a, b, true);\n\t},\n\n\t$lt: function(a, b) {\n\t\treturn ltHelper(a, b, false);\n\t},\n\n\t$lte: function(a, b) {\n\t\treturn ltHelper(a, b, true);\n\t},\n\n\t// ex : coll.find({'orderCount': {$between: [10, 50]}});\n\t$between: function(a, vals) {\n\t\tif (a === undefined || a === null) return false;\n\t\treturn (gtHelper(a, vals[0], true) && ltHelper(a, vals[1], true));\n\t},\n\n\t$in: function(a, b) {\n\t\treturn b.indexOf(a) !== -1;\n\t},\n\n\t$nin: function(a, b) {\n\t\treturn b.indexOf(a) === -1;\n\t},\n\n\t$keyin: function(a, b) {\n\t\treturn a in b;\n\t},\n\n\t$nkeyin: function(a, b) {\n\t\treturn !(a in b);\n\t},\n\n\t$definedin: function(a, b) {\n\t\treturn b[a] !== undefined;\n\t},\n\n\t$undefinedin: function(a, b) {\n\t\treturn b[a] === undefined;\n\t},\n\n\t$regex: function(a, b) {\n\t\treturn b.test(a);\n\t},\n\n\t$containsString: function(a, b) {\n\t\treturn (typeof a === 'string') && (a.indexOf(b) !== -1);\n\t},\n\n\t$containsNone: function(a, b) {\n\t\treturn !LokiOps.$containsAny(a, b);\n\t},\n\n\t$containsAny: function(a, b) {\n\t\tvar checkFn = containsCheckFn(a);\n\t\tif (checkFn !== null) {\n\t\t\treturn (Array.isArray(b)) ? (b.some(checkFn)) : (checkFn(b));\n\t\t}\n\t\treturn false;\n\t},\n\n\t$contains: function(a, b) {\n\t\tvar checkFn = containsCheckFn(a);\n\t\tif (checkFn !== null) {\n\t\t\treturn (Array.isArray(b)) ? (b.every(checkFn)) : (checkFn(b));\n\t\t}\n\t\treturn false;\n\t},\n\n\t$type: function(a, b) {\n\t\tvar type = typeof a;\n\t\tif (type === 'object') {\n\t\t\tif (Array.isArray(a)) {\n\t\t\t\ttype = 'array';\n\t\t\t} else if (a instanceof Date) {\n\t\t\t\ttype = 'date';\n\t\t\t}\n\t\t}\n\t\treturn (typeof b !== 'object') ? (type === b) : doQueryOp(type, b);\n\t},\n\n\t$size: function(a, b) {\n\t\tif (Array.isArray(a)) {\n\t\t\treturn (typeof b !== 'object') ? (a.length === b) : doQueryOp(a.length, b);\n\t\t}\n\t\treturn false;\n\t},\n\n\t$len: function(a, b) {\n\t\tif (typeof a === 'string') {\n\t\t\treturn (typeof b !== 'object') ? (a.length === b) : doQueryOp(a.length, b);\n\t\t}\n\t\treturn false;\n\t},\n\n\t$where: function(a, b) {\n\t\treturn b(a) === true;\n\t},\n\n\t// field-level logical operators\n\t// a is the value in the collection\n\t// b is the nested query operation (for '$not')\n\t//   or an array of nested query operations (for '$and' and '$or')\n\t$not: function(a, b) {\n\t\treturn !doQueryOp(a, b);\n\t},\n\n\t$and: function(a, b) {\n\t\tfor (var idx = 0, len = b.length; idx < len; idx += 1) {\n\t\t\tif (!doQueryOp(a, b[idx])) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t},\n\n\t$or: function(a, b) {\n\t\tfor (var idx = 0, len = b.length; idx < len; idx += 1) {\n\t\t\tif (doQueryOp(a, b[idx])) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n};\n\n// making indexing opt-in... our range function knows how to deal with these ops :\nvar indexedOpsList = ['$eq', '$aeq', '$dteq', '$gt', '$gte', '$lt', '$lte', '$in', '$between'];\n\n\nfunction sortHelper(prop1, prop2, desc) {\n\tif (prop1 === prop2) {\n\t\treturn 0;\n\t}\n\n\tif (ltHelper(prop1, prop2, false)) {\n\t\treturn (desc) ? (1) : (-1);\n\t}\n\n\tif (gtHelper(prop1, prop2, false)) {\n\t\treturn (desc) ? (-1) : (1);\n\t}\n\n\t// not lt, not gt so implied equality-- date compatible\n\treturn 0;\n}\n\n/**\n * compoundeval() - helper function for compoundsort(), performing individual object comparisons\n *\n * @param {array} properties - array of property names, in order, by which to evaluate sort order\n * @param {object} obj1 - first object to compare\n * @param {object} obj2 - second object to compare\n * @returns {integer} 0, -1, or 1 to designate if identical (sortwise) or which should be first\n */\nfunction compoundeval(properties, obj1, obj2) {\n\tvar res = 0;\n\tvar prop, field;\n\tfor (var i = 0, len = properties.length; i < len; i++) {\n\t\tprop = properties[i];\n\t\tfield = prop[0];\n\t\tres = sortHelper(obj1[field], obj2[field], prop[1]);\n\t\tif (res !== 0) {\n\t\t\treturn res;\n\t\t}\n\t}\n\treturn 0;\n}\n\n\n/**\n * dotSubScan - helper function used for dot notation queries.\n *\n * @param {object} root - object to traverse\n * @param {array} paths - array of properties to drill into\n * @param {function} fun - evaluation function to test with\n * @param {any} value - comparative value to also pass to (compare) fun\n * @param {number} poffset - index of the item in 'paths' to start the sub-scan from\n */\nfunction dotSubScan(root, paths, fun, value, poffset) {\n\tvar pathOffset = poffset || 0;\n\tvar path = paths[pathOffset];\n\tif (root === undefined || root === null || !hasOwnProperty.call(root, path)) {\n\t\treturn false;\n\t}\n\n\tvar valueFound = false;\n\tvar element = root[path];\n\tif (pathOffset + 1 >= paths.length) {\n\t\t// if we have already expanded out the dot notation,\n\t\t// then just evaluate the test function and value on the element\n\t\tvalueFound = fun(element, value);\n\t} else if (Array.isArray(element)) {\n\t\tfor (var index = 0, len = element.length; index < len; index += 1) {\n\t\t\tvalueFound = dotSubScan(element[index], paths, fun, value, pathOffset + 1);\n\t\t\tif (valueFound === true) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t} else {\n\t\tvalueFound = dotSubScan(element, paths, fun, value, pathOffset + 1);\n\t}\n\n\treturn valueFound;\n}\n\n/*\n'Utils' is not defined                 no-undef\tx\n'sortHelper' is not defined            no-undef\n'compoundeval' is not defined          no-undef\n'indexedOpsList' is not defined        no-undef\n'LokiOps' is not defined               no-undef\n'dotSubScan' is not defined            no-undef\n'clone' is not defined                 no-undef\n */\n\n/**\n * Resultset class allowing chainable queries.  Intended to be instanced internally.\n *    Collection.find(), Collection.where(), and Collection.chain() instantiate this.\n *\n * @example\n *    mycollection.chain()\n *      .find({ 'doors' : 4 })\n *      .where(function(obj) { return obj.name === 'Toyota' })\n *      .data();\n *\n * @constructor Resultset\n * @param {Collection} collection - The collection which this Resultset will query against.\n * @param {Object=} options - Object containing one or more options.\n * @param {string} options.queryObj - Optional mongo-style query object to initialize resultset with.\n * @param {function} options.queryFunc - Optional javascript filter function to initialize resultset with.\n * @param {bool} options.firstOnly - Optional boolean used by collection.findOne().\n */\nexport class Resultset {\n\n\tconstructor(collection, options) {\n\t\toptions = options || {};\n\n\t\toptions.queryObj = options.queryObj || null;\n\t\toptions.queryFunc = options.queryFunc || null;\n\t\toptions.firstOnly = options.firstOnly || false;\n\n\t\t// retain reference to collection we are querying against\n\t\tthis.collection = collection;\n\n\t\t// if chain() instantiates with null queryObj and queryFunc, so we will keep flag for later\n\t\tthis.searchIsChained = (!options.queryObj && !options.queryFunc);\n\t\tthis.filteredrows = [];\n\t\tthis.filterInitialized = false;\n\n\t\t// if user supplied initial queryObj or queryFunc, apply it\n\t\tif (typeof(options.queryObj) !== \"undefined\" && options.queryObj !== null) {\n\t\t\treturn this.find(options.queryObj, options.firstOnly);\n\t\t}\n\t\tif (typeof(options.queryFunc) !== \"undefined\" && options.queryFunc !== null) {\n\t\t\treturn this.where(options.queryFunc);\n\t\t}\n\n\t\t// otherwise return unfiltered Resultset for future filtering\n\t\treturn this;\n\t}\n\n\t/**\n\t * reset() - Reset the resultset to its initial state.\n\t *\n\t * @returns {Resultset} Reference to this resultset, for future chain operations.\n\t */\n\treset() {\n\t\tif (this.filteredrows.length > 0) {\n\t\t\tthis.filteredrows = [];\n\t\t}\n\t\tthis.filterInitialized = false;\n\t\treturn this;\n\t};\n\n\t/**\n\t * toJSON() - Override of toJSON to avoid circular references\n\t *\n\t */\n\ttoJSON() {\n\t\tvar copy = this.copy();\n\t\tcopy.collection = null;\n\t\treturn copy;\n\t};\n\n\t/**\n\t * Allows you to limit the number of documents passed to next chain operation.\n\t *    A resultset copy() is made to avoid altering original resultset.\n\t *\n\t * @param {int} qty - The number of documents to return.\n\t * @returns {Resultset} Returns a copy of the resultset, limited by qty, for subsequent chain ops.\n\t * @memberof Resultset\n\t */\n\tlimit(qty) {\n\t\t// if this is chained resultset with no filters applied, we need to populate filteredrows first\n\t\tif (this.searchIsChained && !this.filterInitialized && this.filteredrows.length === 0) {\n\t\t\tthis.filteredrows = this.collection.prepareFullDocIndex();\n\t\t}\n\n\t\tvar rscopy = new Resultset(this.collection);\n\t\trscopy.filteredrows = this.filteredrows.slice(0, qty);\n\t\trscopy.filterInitialized = true;\n\t\treturn rscopy;\n\t};\n\n\t/**\n\t * Used for skipping 'pos' number of documents in the resultset.\n\t *\n\t * @param {int} pos - Number of documents to skip; all preceding documents are filtered out.\n\t * @returns {Resultset} Returns a copy of the resultset, containing docs starting at 'pos' for subsequent chain ops.\n\t * @memberof Resultset\n\t */\n\toffset(pos) {\n\t\t// if this is chained resultset with no filters applied, we need to populate filteredrows first\n\t\tif (this.searchIsChained && !this.filterInitialized && this.filteredrows.length === 0) {\n\t\t\tthis.filteredrows = this.collection.prepareFullDocIndex();\n\t\t}\n\n\t\tvar rscopy = new Resultset(this.collection);\n\t\trscopy.filteredrows = this.filteredrows.slice(pos);\n\t\trscopy.filterInitialized = true;\n\t\treturn rscopy;\n\t};\n\n\t/**\n\t * copy() - To support reuse of resultset in branched query situations.\n\t *\n\t * @returns {Resultset} Returns a copy of the resultset (set) but the underlying document references will be the same.\n\t * @memberof Resultset\n\t */\n\tcopy() {\n\t\tvar result = new Resultset(this.collection);\n\n\t\tif (this.filteredrows.length > 0) {\n\t\t\tresult.filteredrows = this.filteredrows.slice();\n\t\t}\n\t\tresult.filterInitialized = this.filterInitialized;\n\n\t\treturn result;\n\t};\n\n\t/**\n\t * Alias of copy()\n\t * @memberof Resultset\n\t */\n\tbranch() {\n\t\treturn this.copy();\n\t}\n\n\t/**\n\t * transform() - executes a named collection transform or raw array of transform steps against the resultset.\n\t *\n\t * @param transform {(string|array)} - name of collection transform or raw transform array\n\t * @param parameters {object=} - (Optional) object property hash of parameters, if the transform requires them.\n\t * @returns {Resultset} either (this) resultset or a clone of of this resultset (depending on steps)\n\t * @memberof Resultset\n\t */\n\ttransform(transform, parameters) {\n\t\tvar idx,\n\t\t\tstep,\n\t\t\trs = this;\n\n\t\t// if transform is name, then do lookup first\n\t\tif (typeof transform === 'string') {\n\t\t\tif (this.collection.transforms.hasOwnProperty(transform)) {\n\t\t\t\ttransform = this.collection.transforms[transform];\n\t\t\t}\n\t\t}\n\n\t\t// either they passed in raw transform array or we looked it up, so process\n\t\tif (typeof transform !== 'object' || !Array.isArray(transform)) {\n\t\t\tthrow new Error(\"Invalid transform\");\n\t\t}\n\n\t\tif (typeof parameters !== 'undefined') {\n\t\t\ttransform = Utils.resolveTransformParams(transform, parameters);\n\t\t}\n\n\t\tfor (idx = 0; idx < transform.length; idx++) {\n\t\t\tstep = transform[idx];\n\n\t\t\tswitch (step.type) {\n\t\t\t\tcase \"find\":\n\t\t\t\t\trs.find(step.value);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"where\":\n\t\t\t\t\trs.where(step.value);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"simplesort\":\n\t\t\t\t\trs.simplesort(step.property, step.desc);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"compoundsort\":\n\t\t\t\t\trs.compoundsort(step.value);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"sort\":\n\t\t\t\t\trs.sort(step.value);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"limit\":\n\t\t\t\t\trs = rs.limit(step.value);\n\t\t\t\t\tbreak; // limit makes copy so update reference\n\t\t\t\tcase \"offset\":\n\t\t\t\t\trs = rs.offset(step.value);\n\t\t\t\t\tbreak; // offset makes copy so update reference\n\t\t\t\tcase \"map\":\n\t\t\t\t\trs = rs.map(step.value);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"eqJoin\":\n\t\t\t\t\trs = rs.eqJoin(step.joinData, step.leftJoinKey, step.rightJoinKey, step.mapFun);\n\t\t\t\t\tbreak;\n\t\t\t\t// following cases break chain by returning array data so make any of these last in transform steps\n\t\t\t\tcase \"mapReduce\":\n\t\t\t\t\trs = rs.mapReduce(step.mapFunction, step.reduceFunction);\n\t\t\t\t\tbreak;\n\t\t\t\t// following cases update documents in current filtered resultset (use carefully)\n\t\t\t\tcase \"update\":\n\t\t\t\t\trs.update(step.value);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"remove\":\n\t\t\t\t\trs.remove();\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn rs;\n\t};\n\n\t/**\n\t * Instances a new anonymous collection with the documents contained in the current resultset.\n\t *\n\t * @param {object} collectionOptions - Options to pass to new anonymous collection construction.\n\t * @returns {Collection} A reference to an anonymous collection initialized with resultset data().\n\t * @memberof Resultset\n\t */\n\tinstance(collectionOptions) {\n\t\tvar docs = this.data();\n\t\tvar idx,\n\t\t\tdoc;\n\n\t\tcollectionOptions = collectionOptions || {};\n\n\t\tvar instanceCollection = new Collection(collectionOptions);\n\n\t\tfor (idx = 0; idx < docs.length; idx++) {\n\t\t\tif (this.collection.cloneObjects) {\n\t\t\t\tdoc = docs[idx];\n\t\t\t} else {\n\t\t\t\tdoc = clone(docs[idx], this.collection.cloneMethod);\n\t\t\t}\n\n\t\t\tdelete doc.$loki;\n\t\t\tdelete doc.meta;\n\n\t\t\tinstanceCollection.insert(doc);\n\t\t}\n\n\t\treturn instanceCollection;\n\t};\n\n\t/**\n\t * User supplied compare function is provided two documents to compare. (chainable)\n\t * @example\n\t *    rslt.sort(function(obj1, obj2) {\n\t *      if (obj1.name === obj2.name) return 0;\n\t *      if (obj1.name > obj2.name) return 1;\n\t *      if (obj1.name < obj2.name) return -1;\n\t *    });\n\t *\n\t * @param {function} comparefun - A javascript compare function used for sorting.\n\t * @returns {Resultset} Reference to this resultset, sorted, for future chain operations.\n\t * @memberof Resultset\n\t */\n\tsort(comparefun) {\n\t\t// if this is chained resultset with no filters applied, just we need to populate filteredrows first\n\t\tif (this.searchIsChained && !this.filterInitialized && this.filteredrows.length === 0) {\n\t\t\tthis.filteredrows = this.collection.prepareFullDocIndex();\n\t\t}\n\n\t\tvar wrappedComparer =\n\t\t\t(function(userComparer, data) {\n\t\t\t\treturn function(a, b) {\n\t\t\t\t\treturn userComparer(data[a], data[b]);\n\t\t\t\t};\n\t\t\t})(comparefun, this.collection.data);\n\n\t\tthis.filteredrows.sort(wrappedComparer);\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * Simpler, loose evaluation for user to sort based on a property name. (chainable).\n\t *    Sorting based on the same lt/gt helper functions used for binary indices.\n\t *\n\t * @param {string} propname - name of property to sort by.\n\t * @param {bool=} isdesc - (Optional) If true, the property will be sorted in descending order\n\t * @returns {Resultset} Reference to this resultset, sorted, for future chain operations.\n\t * @memberof Resultset\n\t */\n\tsimplesort(propname, isdesc) {\n\t\t// if this is chained resultset with no filters applied, just we need to populate filteredrows first\n\t\tif (this.searchIsChained && !this.filterInitialized && this.filteredrows.length === 0) {\n\t\t\t// if we have a binary index and no other filters applied, we can use that instead of sorting (again)\n\t\t\tif (this.collection.binaryIndices.hasOwnProperty(propname)) {\n\t\t\t\t// make sure index is up-to-date\n\t\t\t\tthis.collection.ensureIndex(propname);\n\t\t\t\t// copy index values into filteredrows\n\t\t\t\tthis.filteredrows = this.collection.binaryIndices[propname].values.slice(0);\n\t\t\t\t// we are done, return this (resultset) for further chain ops\n\t\t\t\treturn this;\n\t\t\t}\n\t\t\t// otherwise initialize array for sort below\n\t\t\telse {\n\t\t\t\tthis.filteredrows = this.collection.prepareFullDocIndex();\n\t\t\t}\n\t\t}\n\n\t\tif (typeof(isdesc) === 'undefined') {\n\t\t\tisdesc = false;\n\t\t}\n\n\t\tvar wrappedComparer =\n\t\t\t(function(prop, desc, data) {\n\t\t\t\treturn function(a, b) {\n\t\t\t\t\treturn sortHelper(data[a][prop], data[b][prop], desc);\n\t\t\t\t};\n\t\t\t})(propname, isdesc, this.collection.data);\n\n\t\tthis.filteredrows.sort(wrappedComparer);\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * Allows sorting a resultset based on multiple columns.\n\t * @example\n\t * // to sort by age and then name (both ascending)\n\t * rs.compoundsort(['age', 'name']);\n\t * // to sort by age (ascending) and then by name (descending)\n\t * rs.compoundsort(['age', ['name', true]);\n\t *\n\t * @param {array} properties - array of property names or subarray of [propertyname, isdesc] used evaluate sort order\n\t * @returns {Resultset} Reference to this resultset, sorted, for future chain operations.\n\t * @memberof Resultset\n\t */\n\tcompoundsort(properties) {\n\t\tif (properties.length === 0) {\n\t\t\tthrow new Error(\"Invalid call to compoundsort, need at least one property\");\n\t\t}\n\n\t\tvar prop;\n\t\tif (properties.length === 1) {\n\t\t\tprop = properties[0];\n\t\t\tif (Array.isArray(prop)) {\n\t\t\t\treturn this.simplesort(prop[0], prop[1]);\n\t\t\t}\n\t\t\treturn this.simplesort(prop, false);\n\t\t}\n\n\t\t// unify the structure of 'properties' to avoid checking it repeatedly while sorting\n\t\tfor (var i = 0, len = properties.length; i < len; i += 1) {\n\t\t\tprop = properties[i];\n\t\t\tif (!Array.isArray(prop)) {\n\t\t\t\tproperties[i] = [prop, false];\n\t\t\t}\n\t\t}\n\n\t\t// if this is chained resultset with no filters applied, just we need to populate filteredrows first\n\t\tif (this.searchIsChained && !this.filterInitialized && this.filteredrows.length === 0) {\n\t\t\tthis.filteredrows = this.collection.prepareFullDocIndex();\n\t\t}\n\n\t\tvar wrappedComparer =\n\t\t\t(function(props, data) {\n\t\t\t\treturn function(a, b) {\n\t\t\t\t\treturn compoundeval(props, data[a], data[b]);\n\t\t\t\t};\n\t\t\t})(properties, this.collection.data);\n\n\t\tthis.filteredrows.sort(wrappedComparer);\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * findOr() - oversee the operation of OR'ed query expressions.\n\t *    OR'ed expression evaluation runs each expression individually against the full collection,\n\t *    and finally does a set OR on each expression's results.\n\t *    Each evaluation can utilize a binary index to prevent multiple linear array scans.\n\t *\n\t * @param {array} expressionArray - array of expressions\n\t * @returns {Resultset} this resultset for further chain ops.\n\t */\n\tfindOr(expressionArray) {\n\t\tvar fr = null,\n\t\t\tfri = 0,\n\t\t\tfrlen = 0,\n\t\t\tdocset = [],\n\t\t\tidxset = [],\n\t\t\tidx = 0,\n\t\t\torigCount = this.count();\n\n\t\t// If filter is already initialized, then we query against only those items already in filter.\n\t\t// This means no index utilization for fields, so hopefully its filtered to a smallish filteredrows.\n\t\tfor (var ei = 0, elen = expressionArray.length; ei < elen; ei++) {\n\t\t\t// we need to branch existing query to run each filter separately and combine results\n\t\t\tfr = this.branch().find(expressionArray[ei]).filteredrows;\n\t\t\tfrlen = fr.length;\n\t\t\t// if the find operation did not reduce the initial set, then the initial set is the actual result\n\t\t\tif (frlen === origCount) {\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\t// add any document 'hits'\n\t\t\tfor (fri = 0; fri < frlen; fri++) {\n\t\t\t\tidx = fr[fri];\n\t\t\t\tif (idxset[idx] === undefined) {\n\t\t\t\t\tidxset[idx] = true;\n\t\t\t\t\tdocset.push(idx);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.filteredrows = docset;\n\t\tthis.filterInitialized = true;\n\n\t\treturn this;\n\t};\n\t$or() {\n\t\treturn this.findOr(...arguments);\n\t}\n\n\t/**\n\t * findAnd() - oversee the operation of AND'ed query expressions.\n\t *    AND'ed expression evaluation runs each expression progressively against the full collection,\n\t *    internally utilizing existing chained resultset functionality.\n\t *    Only the first filter can utilize a binary index.\n\t *\n\t * @param {array} expressionArray - array of expressions\n\t * @returns {Resultset} this resultset for further chain ops.\n\t */\n\tfindAnd(expressionArray) {\n\t\t// we have already implementing method chaining in this (our Resultset class)\n\t\t// so lets just progressively apply user supplied and filters\n\t\tfor (var i = 0, len = expressionArray.length; i < len; i++) {\n\t\t\tif (this.count() === 0) {\n\t\t\t\treturn this;\n\t\t\t}\n\t\t\tthis.find(expressionArray[i]);\n\t\t}\n\t\treturn this;\n\t};\n\n\t$and() {\n\t\treturn this.findAnd(...arguments);\n\t}\n\n\t/**\n\t * Used for querying via a mongo-style query object.\n\t *\n\t * @param {object} query - A mongo-style query object used for filtering current results.\n\t * @param {boolean=} firstOnly - (Optional) Used by collection.findOne()\n\t * @returns {Resultset} this resultset for further chain ops.\n\t * @memberof Resultset\n\t */\n\tfind(query, firstOnly) {\n\t\tif (this.collection.data.length === 0) {\n\t\t\tif (this.searchIsChained) {\n\t\t\t\tthis.filteredrows = [];\n\t\t\t\tthis.filterInitialized = true;\n\t\t\t\treturn this;\n\t\t\t}\n\t\t\treturn [];\n\t\t}\n\n\t\tvar queryObject = query || 'getAll',\n\t\t\tp,\n\t\t\tproperty,\n\t\t\tqueryObjectOp,\n\t\t\toperator,\n\t\t\tvalue,\n\t\t\tkey,\n\t\t\tsearchByIndex = false,\n\t\t\tresult = [],\n\t\t\tindex = null;\n\n\t\t// if this was note invoked via findOne()\n\t\tfirstOnly = firstOnly || false;\n\n\t\tif (typeof queryObject === 'object') {\n\t\t\tfor (p in queryObject) {\n\t\t\t\tif (hasOwnProperty.call(queryObject, p)) {\n\t\t\t\t\tproperty = p;\n\t\t\t\t\tqueryObjectOp = queryObject[p];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// apply no filters if they want all\n\t\tif (!property || queryObject === 'getAll') {\n\t\t\t// coll.find(), coll.findOne(), coll.chain().find().data() all path here\n\n\t\t\tif (firstOnly) {\n\t\t\t\treturn (this.collection.data.length > 0) ? this.collection.data[0] : null;\n\t\t\t}\n\n\t\t\treturn (this.searchIsChained) ? (this) : (this.collection.data.slice());\n\t\t}\n\n\t\t// injecting $and and $or expression tree evaluation here.\n\t\tif (property === '$and' || property === '$or') {\n\t\t\tif (this.searchIsChained) {\n\t\t\t\tthis[property](queryObjectOp);\n\n\t\t\t\t// for chained find with firstonly,\n\t\t\t\tif (firstOnly && this.filteredrows.length > 1) {\n\t\t\t\t\tthis.filteredrows = this.filteredrows.slice(0, 1);\n\t\t\t\t}\n\n\t\t\t\treturn this;\n\t\t\t} else {\n\t\t\t\t// our $and operation internally chains filters\n\t\t\t\tresult = this.collection.chain()[property](queryObjectOp).data();\n\n\t\t\t\t// if this was coll.findOne() return first object or empty array if null\n\t\t\t\t// since this is invoked from a constructor we can't return null, so we will\n\t\t\t\t// make null in coll.findOne();\n\t\t\t\tif (firstOnly) {\n\t\t\t\t\treturn (result.length === 0) ? ([]) : (result[0]);\n\t\t\t\t}\n\n\t\t\t\t// not first only return all results\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}\n\n\t\t// see if query object is in shorthand mode (assuming eq operator)\n\t\tif (queryObjectOp === null || (typeof queryObjectOp !== 'object' || queryObjectOp instanceof Date)) {\n\t\t\toperator = '$eq';\n\t\t\tvalue = queryObjectOp;\n\t\t} else if (typeof queryObjectOp === 'object') {\n\t\t\tfor (key in queryObjectOp) {\n\t\t\t\tif (hasOwnProperty.call(queryObjectOp, key)) {\n\t\t\t\t\toperator = key;\n\t\t\t\t\tvalue = queryObjectOp[key];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthrow new Error('Do not know what you want to do.');\n\t\t}\n\n\t\t// for regex ops, precompile\n\t\tif (operator === '$regex') {\n\t\t\tif (Array.isArray(value)) {\n\t\t\t\tvalue = new RegExp(value[0], value[1]);\n\t\t\t} else if (!(value instanceof RegExp)) {\n\t\t\t\tvalue = new RegExp(value);\n\t\t\t}\n\t\t}\n\n\t\t// if user is deep querying the object such as find('name.first': 'odin')\n\t\tvar usingDotNotation = (property.indexOf('.') !== -1);\n\n\t\t// if an index exists for the property being queried against, use it\n\t\t// for now only enabling for non-chained query (who's set of docs matches index)\n\t\t// or chained queries where it is the first filter applied and prop is indexed\n\t\tvar doIndexCheck = !usingDotNotation &&\n\t\t\t(!this.searchIsChained || !this.filterInitialized);\n\n\t\tif (doIndexCheck && this.collection.binaryIndices[property] &&\n\t\t\tindexedOpsList.indexOf(operator) !== -1) {\n\t\t\t// this is where our lazy index rebuilding will take place\n\t\t\t// basically we will leave all indexes dirty until we need them\n\t\t\t// so here we will rebuild only the index tied to this property\n\t\t\t// ensureIndex() will only rebuild if flagged as dirty since we are not passing force=true param\n\t\t\tif (this.collection.adaptiveBinaryIndices !== true) {\n\t\t\t\tthis.collection.ensureIndex(property);\n\t\t\t}\n\n\t\t\tsearchByIndex = true;\n\t\t\tindex = this.collection.binaryIndices[property];\n\t\t}\n\n\t\t// the comparison function\n\t\tvar fun = LokiOps[operator];\n\n\t\t// \"shortcut\" for collection data\n\t\tvar t = this.collection.data;\n\t\t// filter data length\n\t\tvar i = 0,\n\t\t\tlen = 0;\n\n\t\t// Query executed differently depending on :\n\t\t//    - whether it is chained or not\n\t\t//    - whether the property being queried has an index defined\n\t\t//    - if chained, we handle first pass differently for initial filteredrows[] population\n\t\t//\n\t\t// For performance reasons, each case has its own if block to minimize in-loop calculations\n\n\t\t// If not a chained query, bypass filteredrows and work directly against data\n\t\tif (!this.searchIsChained) {\n\t\t\tif (!searchByIndex) {\n\t\t\t\ti = t.length;\n\n\t\t\t\tif (firstOnly) {\n\t\t\t\t\tif (usingDotNotation) {\n\t\t\t\t\t\tproperty = property.split('.');\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tif (dotSubScan(t[i], property, fun, value)) {\n\t\t\t\t\t\t\t\treturn (t[i]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tif (fun(t[i][property], value)) {\n\t\t\t\t\t\t\t\treturn (t[i]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\n\t\t\t\t// if using dot notation then treat property as keypath such as 'name.first'.\n\t\t\t\t// currently supporting dot notation for non-indexed conditions only\n\t\t\t\tif (usingDotNotation) {\n\t\t\t\t\tproperty = property.split('.');\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tif (dotSubScan(t[i], property, fun, value)) {\n\t\t\t\t\t\t\tresult.push(t[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tif (fun(t[i][property], value)) {\n\t\t\t\t\t\t\tresult.push(t[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// searching by binary index via calculateRange() utility method\n\t\t\t\tvar seg = this.collection.calculateRange(operator, property, value);\n\n\t\t\t\t// not chained so this 'find' was designated in Resultset constructor\n\t\t\t\t// so return object itself\n\t\t\t\tif (firstOnly) {\n\t\t\t\t\tif (seg[1] !== -1) {\n\t\t\t\t\t\treturn t[index.values[seg[0]]];\n\t\t\t\t\t}\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\n\t\t\t\tif (operator !== '$in') {\n\t\t\t\t\tfor (i = seg[0]; i <= seg[1]; i++) {\n\t\t\t\t\t\tresult.push(t[index.values[i]]);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfor (i = 0, len = seg.length; i < len; i++) {\n\t\t\t\t\t\tresult.push(t[index.values[seg[i]]]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// not a chained query so return result as data[]\n\t\t\treturn result;\n\t\t}\n\n\n\t\t// Otherwise this is a chained query\n\t\t// Chained queries now preserve results ordering at expense on slightly reduced unindexed performance\n\n\t\tvar filter, rowIdx = 0;\n\n\t\t// If the filteredrows[] is already initialized, use it\n\t\tif (this.filterInitialized) {\n\t\t\tfilter = this.filteredrows;\n\t\t\tlen = filter.length;\n\n\t\t\t// currently supporting dot notation for non-indexed conditions only\n\t\t\tif (usingDotNotation) {\n\t\t\t\tproperty = property.split('.');\n\t\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\t\trowIdx = filter[i];\n\t\t\t\t\tif (dotSubScan(t[rowIdx], property, fun, value)) {\n\t\t\t\t\t\tresult.push(rowIdx);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\t\trowIdx = filter[i];\n\t\t\t\t\tif (fun(t[rowIdx][property], value)) {\n\t\t\t\t\t\tresult.push(rowIdx);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// first chained query so work against data[] but put results in filteredrows\n\t\telse {\n\t\t\t// if not searching by index\n\t\t\tif (!searchByIndex) {\n\t\t\t\tlen = t.length;\n\n\t\t\t\tif (usingDotNotation) {\n\t\t\t\t\tproperty = property.split('.');\n\t\t\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\t\t\tif (dotSubScan(t[i], property, fun, value)) {\n\t\t\t\t\t\t\tresult.push(i);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\t\t\tif (fun(t[i][property], value)) {\n\t\t\t\t\t\t\tresult.push(i);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// search by index\n\t\t\t\tvar segm = this.collection.calculateRange(operator, property, value);\n\n\t\t\t\tif (operator !== '$in') {\n\t\t\t\t\tfor (i = segm[0]; i <= segm[1]; i++) {\n\t\t\t\t\t\tresult.push(index.values[i]);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfor (i = 0, len = segm.length; i < len; i++) {\n\t\t\t\t\t\tresult.push(index.values[segm[i]]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.filterInitialized = true; // next time work against filteredrows[]\n\t\t}\n\n\t\tthis.filteredrows = result;\n\t\treturn this;\n\t};\n\n\n\t/**\n\t * where() - Used for filtering via a javascript filter function.\n\t *\n\t * @param {function} fun - A javascript function used for filtering current results by.\n\t * @returns {Resultset} this resultset for further chain ops.\n\t * @memberof Resultset\n\t */\n\twhere(fun) {\n\t\tvar viewFunction,\n\t\t\tresult = [];\n\n\t\tif ('function' === typeof fun) {\n\t\t\tviewFunction = fun;\n\t\t} else {\n\t\t\tthrow new TypeError('Argument is not a stored view or a function');\n\t\t}\n\t\ttry {\n\t\t\t// if not a chained query then run directly against data[] and return object []\n\t\t\tif (!this.searchIsChained) {\n\t\t\t\tvar i = this.collection.data.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tif (viewFunction(this.collection.data[i]) === true) {\n\t\t\t\t\t\tresult.push(this.collection.data[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// not a chained query so returning result as data[]\n\t\t\t\treturn result;\n\t\t\t}\n\t\t\t// else chained query, so run against filteredrows\n\t\t\telse {\n\t\t\t\t// If the filteredrows[] is already initialized, use it\n\t\t\t\tif (this.filterInitialized) {\n\t\t\t\t\tvar j = this.filteredrows.length;\n\n\t\t\t\t\twhile (j--) {\n\t\t\t\t\t\tif (viewFunction(this.collection.data[this.filteredrows[j]]) === true) {\n\t\t\t\t\t\t\tresult.push(this.filteredrows[j]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.filteredrows = result;\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t\t// otherwise this is initial chained op, work against data, push into filteredrows[]\n\t\t\t\telse {\n\t\t\t\t\tvar k = this.collection.data.length;\n\n\t\t\t\t\twhile (k--) {\n\t\t\t\t\t\tif (viewFunction(this.collection.data[k]) === true) {\n\t\t\t\t\t\t\tresult.push(k);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.filteredrows = result;\n\t\t\t\t\tthis.filterInitialized = true;\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tthrow err;\n\t\t}\n\t};\n\n\t/**\n\t * count() - returns the number of documents in the resultset.\n\t *\n\t * @returns {number} The number of documents in the resultset.\n\t * @memberof Resultset\n\t */\n\tcount() {\n\t\tif (this.searchIsChained && this.filterInitialized) {\n\t\t\treturn this.filteredrows.length;\n\t\t}\n\t\treturn this.collection.count();\n\t};\n\n\t/**\n\t * Terminates the chain and returns array of filtered documents\n\t *\n\t * @param {object=} options - allows specifying 'forceClones' and 'forceCloneMethod' options.\n\t * @param {boolean} options.forceClones - Allows forcing the return of cloned objects even when\n\t *        the collection is not configured for clone object.\n\t * @param {string} options.forceCloneMethod - Allows overriding the default or collection specified cloning method.\n\t *        Possible values include 'parse-stringify', 'jquery-extend-deep', and 'shallow'\n\t *\n\t * @returns {array} Array of documents in the resultset\n\t * @memberof Resultset\n\t */\n\tdata(options) {\n\t\tvar result = [],\n\t\t\tdata = this.collection.data,\n\t\t\tlen,\n\t\t\ti,\n\t\t\tmethod;\n\n\t\toptions = options || {};\n\n\t\t// if this is chained resultset with no filters applied, just return collection.data\n\t\tif (this.searchIsChained && !this.filterInitialized) {\n\t\t\tif (this.filteredrows.length === 0) {\n\t\t\t\t// determine whether we need to clone objects or not\n\t\t\t\tif (this.collection.cloneObjects || options.forceClones) {\n\t\t\t\t\tlen = data.length;\n\t\t\t\t\tmethod = options.forceCloneMethod || this.collection.cloneMethod;\n\n\t\t\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\t\t\tresult.push(clone(data[i], method));\n\t\t\t\t\t}\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t\t// otherwise we are not cloning so return sliced array with same object references\n\t\t\t\telse {\n\t\t\t\t\treturn data.slice();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// filteredrows must have been set manually, so use it\n\t\t\t\tthis.filterInitialized = true;\n\t\t\t}\n\t\t}\n\n\t\tvar fr = this.filteredrows;\n\t\tlen = fr.length;\n\n\t\tif (this.collection.cloneObjects || options.forceClones) {\n\t\t\tmethod = options.forceCloneMethod || this.collection.cloneMethod;\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\tresult.push(clone(data[fr[i]], method));\n\t\t\t}\n\t\t} else {\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\tresult.push(data[fr[i]]);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\t/**\n\t * Used to run an update operation on all documents currently in the resultset.\n\t *\n\t * @param {function} updateFunction - User supplied updateFunction(obj) will be executed for each document object.\n\t * @returns {Resultset} this resultset for further chain ops.\n\t * @memberof Resultset\n\t */\n\tupdate(updateFunction) {\n\n\t\tif (typeof(updateFunction) !== \"function\") {\n\t\t\tthrow new TypeError('Argument is not a function');\n\t\t}\n\n\t\t// if this is chained resultset with no filters applied, we need to populate filteredrows first\n\t\tif (this.searchIsChained && !this.filterInitialized && this.filteredrows.length === 0) {\n\t\t\tthis.filteredrows = this.collection.prepareFullDocIndex();\n\t\t}\n\n\t\tvar len = this.filteredrows.length,\n\t\t\trcd = this.collection.data;\n\n\t\tfor (var idx = 0; idx < len; idx++) {\n\t\t\t// pass in each document object currently in resultset to user supplied updateFunction\n\t\t\tupdateFunction(rcd[this.filteredrows[idx]]);\n\n\t\t\t// notify collection we have changed this object so it can update meta and allow DynamicViews to re-evaluate\n\t\t\tthis.collection.update(rcd[this.filteredrows[idx]]);\n\t\t}\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * Removes all document objects which are currently in resultset from collection (as well as resultset)\n\t *\n\t * @returns {Resultset} this (empty) resultset for further chain ops.\n\t * @memberof Resultset\n\t */\n\tremove() {\n\n\t\t// if this is chained resultset with no filters applied, we need to populate filteredrows first\n\t\tif (this.searchIsChained && !this.filterInitialized && this.filteredrows.length === 0) {\n\t\t\tthis.filteredrows = this.collection.prepareFullDocIndex();\n\t\t}\n\n\t\tthis.collection.remove(this.data());\n\n\t\tthis.filteredrows = [];\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * data transformation via user supplied functions\n\t *\n\t * @param {function} mapFunction - this function accepts a single document for you to transform and return\n\t * @param {function} reduceFunction - this function accepts many (array of map outputs) and returns single value\n\t * @returns {value} The output of your reduceFunction\n\t * @memberof Resultset\n\t */\n\tmapReduce(mapFunction, reduceFunction) {\n\t\ttry {\n\t\t\treturn reduceFunction(this.data().map(mapFunction));\n\t\t} catch (err) {\n\t\t\tthrow err;\n\t\t}\n\t};\n\n\t/**\n\t * eqJoin() - Left joining two sets of data. Join keys can be defined or calculated properties\n\t * eqJoin expects the right join key values to be unique.  Otherwise left data will be joined on the last joinData object with that key\n\t * @param {Array} joinData - Data array to join to.\n\t * @param {(string|function)} leftJoinKey - Property name in this result set to join on or a function to produce a value to join on\n\t * @param {(string|function)} rightJoinKey - Property name in the joinData to join on or a function to produce a value to join on\n\t * @param {function=} mapFun - (Optional) A function that receives each matching pair and maps them into output objects - function(left,right){return joinedObject}\n\t * @returns {Resultset} A resultset with data in the format [{left: leftObj, right: rightObj}]\n\t * @memberof Resultset\n\t */\n\teqJoin(joinData, leftJoinKey, rightJoinKey, mapFun) {\n\n\t\tvar leftData = [],\n\t\t\tleftDataLength,\n\t\t\trightData = [],\n\t\t\trightDataLength,\n\t\t\tkey,\n\t\t\tresult = [],\n\t\t\tleftKeyisFunction = typeof leftJoinKey === 'function',\n\t\t\trightKeyisFunction = typeof rightJoinKey === 'function',\n\t\t\tjoinMap = {};\n\n\t\t//get the left data\n\t\tleftData = this.data();\n\t\tleftDataLength = leftData.length;\n\n\t\t//get the right data\n\t\tif (joinData instanceof Resultset) {\n\t\t\trightData = joinData.data();\n\t\t} else if (Array.isArray(joinData)) {\n\t\t\trightData = joinData;\n\t\t} else {\n\t\t\tthrow new TypeError('joinData needs to be an array or result set');\n\t\t}\n\t\trightDataLength = rightData.length;\n\n\t\t//construct a lookup table\n\n\t\tfor (var i = 0; i < rightDataLength; i++) {\n\t\t\tkey = rightKeyisFunction ? rightJoinKey(rightData[i]) : rightData[i][rightJoinKey];\n\t\t\tjoinMap[key] = rightData[i];\n\t\t}\n\n\t\tif (!mapFun) {\n\t\t\tmapFun = function(left, right) {\n\t\t\t\treturn {\n\t\t\t\t\tleft: left,\n\t\t\t\t\tright: right\n\t\t\t\t};\n\t\t\t};\n\t\t}\n\n\t\t//Run map function over each object in the resultset\n\t\tfor (var j = 0; j < leftDataLength; j++) {\n\t\t\tkey = leftKeyisFunction ? leftJoinKey(leftData[j]) : leftData[j][leftJoinKey];\n\t\t\tresult.push(mapFun(leftData[j], joinMap[key] || {}));\n\t\t}\n\n\t\t//return return a new resultset with no filters\n\t\tthis.collection = new Collection('joinData');\n\t\tthis.collection.insert(result);\n\t\tthis.filteredrows = [];\n\t\tthis.filterInitialized = false;\n\n\t\treturn this;\n\t};\n\n\tmap(mapFun) {\n\t\tvar data = this.data().map(mapFun);\n\t\t//return return a new resultset with no filters\n\t\tthis.collection = new Collection('mappedData');\n\t\tthis.collection.insert(data);\n\t\tthis.filteredrows = [];\n\t\tthis.filterInitialized = false;\n\n\t\treturn this;\n\t};\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/resultset.js","export function clone(data, method) {\n\tif (data === null || data === undefined) {\n\t\treturn null;\n\t}\n\n\tvar cloneMethod = method || 'parse-stringify',\n\t\tcloned;\n\n\tswitch (cloneMethod) {\n\t\tcase \"parse-stringify\":\n\t\t\tcloned = JSON.parse(JSON.stringify(data));\n\t\t\tbreak;\n\t\tcase \"jquery-extend-deep\":\n\t\t\tcloned = jQuery.extend(true, {}, data);\n\t\t\tbreak;\n\t\tcase \"shallow\":\n\t\t\tcloned = Object.create(data.prototype || null);\n\t\t\tObject.keys(data).map(function(i) {\n\t\t\t\tcloned[i] = data[i];\n\t\t\t});\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\n\treturn cloned;\n}\n\nexport function cloneObjectArray(objarray, method) {\n\tvar i,\n\t\tresult = [];\n\n\tif (method == \"parse-stringify\") {\n\t\treturn clone(objarray, method);\n\t}\n\n\ti = objarray.length - 1;\n\n\tfor (; i <= 0; i--) {\n\t\tresult.push(clone(objarray[i], method));\n\t}\n\n\treturn result;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/clone.js","/**\n * Created by toni on 1/27/17.\n */\n\n\nexport var Utils = {\n\tcopyProperties: function(src, dest) {\n\t\tvar prop;\n\t\tfor (prop in src) {\n\t\t\tdest[prop] = src[prop];\n\t\t}\n\t},\n\t// used to recursively scan hierarchical transform step object for param substitution\n\tresolveTransformObject: function(subObj, params, depth) {\n\t\tvar prop,\n\t\t\tpname;\n\n\t\tif (typeof depth !== 'number') {\n\t\t\tdepth = 0;\n\t\t}\n\n\t\tif (++depth >= 10) return subObj;\n\n\t\tfor (prop in subObj) {\n\t\t\tif (typeof subObj[prop] === 'string' && subObj[prop].indexOf(\"[%lktxp]\") === 0) {\n\t\t\t\tpname = subObj[prop].substring(8);\n\t\t\t\tif (params.hasOwnProperty(pname)) {\n\t\t\t\t\tsubObj[prop] = params[pname];\n\t\t\t\t}\n\t\t\t} else if (typeof subObj[prop] === \"object\") {\n\t\t\t\tsubObj[prop] = Utils.resolveTransformObject(subObj[prop], params, depth);\n\t\t\t}\n\t\t}\n\n\t\treturn subObj;\n\t},\n\t// top level utility to resolve an entire (single) transform (array of steps) for parameter substitution\n\tresolveTransformParams: function(transform, params) {\n\t\tvar idx,\n\t\t\tclonedStep,\n\t\t\tresolvedTransform = [];\n\n\t\tif (typeof params === 'undefined') return transform;\n\n\t\t// iterate all steps in the transform array\n\t\tfor (idx = 0; idx < transform.length; idx++) {\n\t\t\t// clone transform so our scan and replace can operate directly on cloned transform\n\t\t\tclonedStep = JSON.parse(JSON.stringify(transform[idx]));\n\t\t\tresolvedTransform.push(Utils.resolveTransformObject(clonedStep, params));\n\t\t}\n\n\t\treturn resolvedTransform;\n\t}\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/utils.js","/**\n * Created by toni on 1/27/17.\n */\n\n\n/** Helper function for determining 'less-than' conditions for ops, sorting, and binary indices.\n *     In the future we might want $lt and $gt ops to use their own functionality/helper.\n *     Since binary indices on a property might need to index [12, NaN, new Date(), Infinity], we\n *     need this function (as well as gtHelper) to always ensure one value is LT, GT, or EQ to another.\n */\nexport function ltHelper(prop1, prop2, equal) {\n\tvar cv1, cv2;\n\n\t// 'falsy' and Boolean handling\n\tif (!prop1 || !prop2 || prop1 === true || prop2 === true) {\n\t\tif ((prop1 === true || prop1 === false) && (prop2 === true || prop2 === false)) {\n\t\t\tif (equal) {\n\t\t\t\treturn prop1 === prop2;\n\t\t\t} else {\n\t\t\t\tif (prop1) {\n\t\t\t\t\treturn false;\n\t\t\t\t} else {\n\t\t\t\t\treturn prop2;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (prop2 === undefined || prop2 === null || prop1 === true || prop2 === false) {\n\t\t\treturn equal;\n\t\t}\n\t\tif (prop1 === undefined || prop1 === null || prop1 === false || prop2 === true) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tif (prop1 === prop2) {\n\t\treturn equal;\n\t}\n\n\tif (prop1 < prop2) {\n\t\treturn true;\n\t}\n\n\tif (prop1 > prop2) {\n\t\treturn false;\n\t}\n\n\t// not strict equal nor less than nor gt so must be mixed types, convert to string and use that to compare\n\tcv1 = prop1.toString();\n\tcv2 = prop2.toString();\n\n\tif (cv1 == cv2) {\n\t\treturn equal;\n\t}\n\n\tif (cv1 < cv2) {\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\nexport function gtHelper(prop1, prop2, equal) {\n\tvar cv1, cv2;\n\n\t// 'falsy' and Boolean handling\n\tif (!prop1 || !prop2 || prop1 === true || prop2 === true) {\n\t\tif ((prop1 === true || prop1 === false) && (prop2 === true || prop2 === false)) {\n\t\t\tif (equal) {\n\t\t\t\treturn prop1 === prop2;\n\t\t\t} else {\n\t\t\t\tif (prop1) {\n\t\t\t\t\treturn !prop2;\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (prop1 === undefined || prop1 === null || prop1 === false || prop2 === true) {\n\t\t\treturn equal;\n\t\t}\n\t\tif (prop2 === undefined || prop2 === null || prop1 === true || prop2 === false) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tif (prop1 === prop2) {\n\t\treturn equal;\n\t}\n\n\tif (prop1 > prop2) {\n\t\treturn true;\n\t}\n\n\tif (prop1 < prop2) {\n\t\treturn false;\n\t}\n\n\t// not strict equal nor less than nor gt so must be mixed types, convert to string and use that to compare\n\tcv1 = prop1.toString();\n\tcv2 = prop2.toString();\n\n\tif (cv1 == cv2) {\n\t\treturn equal;\n\t}\n\n\tif (cv1 > cv2) {\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/helper.js","import {LokiEventEmitter} from './event_emitter';\nimport {Resultset} from './resultset'\n\n/*\n'LokiEventEmitter' is not defined        no-undef\n'Resultset' is not defined               no-undef\n */\n\n/**\n * DynamicView class is a versatile 'live' view class which can have filters and sorts applied.\n *    Collection.addDynamicView(name) instantiates this DynamicView object and notifies it\n *    whenever documents are add/updated/removed so it can remain up-to-date. (chainable)\n *\n * @example\n * var mydv = mycollection.addDynamicView('test');  // default is non-persistent\n * mydv.applyFind({ 'doors' : 4 });\n * mydv.applyWhere(function(obj) { return obj.name === 'Toyota'; });\n * var results = mydv.data();\n *\n * @constructor DynamicView\n * @implements LokiEventEmitter\n * @param {Collection} collection - A reference to the collection to work against\n * @param {string} name - The name of this dynamic view\n * @param {object=} options - (Optional) Pass in object with 'persistent' and/or 'sortPriority' options.\n * @param {boolean} options.persistent - indicates if view is to main internal results array in 'resultdata'\n * @param {string} options.sortPriority - 'passive' (sorts performed on call to data) or 'active' (after updates)\n * @param {number} options.minRebuildInterval - minimum rebuild interval (need clarification to docs here)\n * @see {@link Collection#addDynamicView} to construct instances of DynamicView\n */\nexport class DynamicView extends LokiEventEmitter {\n\n\tconstructor(collection, name, options) {\n\t\tsuper();\n\t\tthis.collection = collection;\n\t\tthis.name = name;\n\t\tthis.rebuildPending = false;\n\t\tthis.options = options || {};\n\n\t\tif (!this.options.hasOwnProperty('persistent')) {\n\t\t\tthis.options.persistent = false;\n\t\t}\n\n\t\t// 'persistentSortPriority':\n\t\t// 'passive' will defer the sort phase until they call data(). (most efficient overall)\n\t\t// 'active' will sort async whenever next idle. (prioritizes read speeds)\n\t\tif (!this.options.hasOwnProperty('sortPriority')) {\n\t\t\tthis.options.sortPriority = 'passive';\n\t\t}\n\n\t\tif (!this.options.hasOwnProperty('minRebuildInterval')) {\n\t\t\tthis.options.minRebuildInterval = 1;\n\t\t}\n\n\t\tthis.resultset = new Resultset(collection);\n\t\tthis.resultdata = [];\n\t\tthis.resultsdirty = false;\n\n\t\tthis.cachedresultset = null;\n\n\t\t// keep ordered filter pipeline\n\t\tthis.filterPipeline = [];\n\n\t\t// sorting member variables\n\t\t// we only support one active search, applied using applySort() or applySimpleSort()\n\t\tthis.sortFunction = null;\n\t\tthis.sortCriteria = null;\n\t\tthis.sortDirty = false;\n\n\t\t// for now just have 1 event for when we finally rebuilt lazy view\n\t\t// once we refactor transactions, i will tie in certain transactional events\n\n\t\tthis.events = {\n\t\t\t'rebuild': []\n\t\t};\n\t}\n\n\t/**\n\t * rematerialize() - intended for use immediately after deserialization (loading)\n\t *    This will clear out and reapply filterPipeline ops, recreating the view.\n\t *    Since where filters do not persist correctly, this method allows\n\t *    restoring the view to state where user can re-apply those where filters.\n\t *\n\t * @param {Object=} options - (Optional) allows specification of 'removeWhereFilters' option\n\t * @returns {DynamicView} This dynamic view for further chained ops.\n\t * @memberof DynamicView\n\t * @fires DynamicView.rebuild\n\t */\n\trematerialize(options) {\n\t\tvar fpl,\n\t\t\tfpi,\n\t\t\tidx;\n\n\t\toptions = options || {};\n\n\t\tthis.resultdata = [];\n\t\tthis.resultsdirty = true;\n\t\tthis.resultset = new Resultset(this.collection);\n\n\t\tif (this.sortFunction || this.sortCriteria) {\n\t\t\tthis.sortDirty = true;\n\t\t}\n\n\t\tif (options.hasOwnProperty('removeWhereFilters')) {\n\t\t\t// for each view see if it had any where filters applied... since they don't\n\t\t\t// serialize those functions lets remove those invalid filters\n\t\t\tfpl = this.filterPipeline.length;\n\t\t\tfpi = fpl;\n\t\t\twhile (fpi--) {\n\t\t\t\tif (this.filterPipeline[fpi].type === 'where') {\n\t\t\t\t\tif (fpi !== this.filterPipeline.length - 1) {\n\t\t\t\t\t\tthis.filterPipeline[fpi] = this.filterPipeline[this.filterPipeline.length - 1];\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.filterPipeline.length--;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// back up old filter pipeline, clear filter pipeline, and reapply pipeline ops\n\t\tvar ofp = this.filterPipeline;\n\t\tthis.filterPipeline = [];\n\n\t\t// now re-apply 'find' filterPipeline ops\n\t\tfpl = ofp.length;\n\t\tfor (idx = 0; idx < fpl; idx++) {\n\t\t\tthis.applyFind(ofp[idx].val);\n\t\t}\n\n\t\t// during creation of unit tests, i will remove this forced refresh and leave lazy\n\t\tthis.data();\n\n\t\t// emit rebuild event in case user wants to be notified\n\t\tthis.emit('rebuild', this);\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * branchResultset() - Makes a copy of the internal resultset for branched queries.\n\t *    Unlike this dynamic view, the branched resultset will not be 'live' updated,\n\t *    so your branched query should be immediately resolved and not held for future evaluation.\n\t *\n\t * @param {(string|array=)} transform - Optional name of collection transform, or an array of transform steps\n\t * @param {object=} parameters - optional parameters (if optional transform requires them)\n\t * @returns {Resultset} A copy of the internal resultset for branched queries.\n\t * @memberof DynamicView\n\t */\n\tbranchResultset(transform, parameters) {\n\t\tvar rs = this.resultset.branch();\n\n\t\tif (typeof transform === 'undefined') {\n\t\t\treturn rs;\n\t\t}\n\n\t\treturn rs.transform(transform, parameters);\n\t};\n\n\t/**\n\t * toJSON() - Override of toJSON to avoid circular references\n\t *\n\t */\n\ttoJSON() {\n\t\tvar copy = new DynamicView(this.collection, this.name, this.options);\n\n\t\tcopy.resultset = this.resultset;\n\t\tcopy.resultdata = []; // let's not save data (copy) to minimize size\n\t\tcopy.resultsdirty = true;\n\t\tcopy.filterPipeline = this.filterPipeline;\n\t\tcopy.sortFunction = this.sortFunction;\n\t\tcopy.sortCriteria = this.sortCriteria;\n\t\tcopy.sortDirty = this.sortDirty;\n\n\t\t// avoid circular reference, reapply in db.loadJSON()\n\t\tcopy.collection = null;\n\n\t\treturn copy;\n\t};\n\n\t/**\n\t * removeFilters() - Used to clear pipeline and reset dynamic view to initial state.\n\t *     Existing options should be retained.\n\t * @param {object=} options - configure removeFilter behavior\n\t * @param {boolean=} options.queueSortPhase - (default: false) if true we will async rebuild view (maybe set default to true in future?)\n\t * @memberof DynamicView\n\t */\n\tremoveFilters(options) {\n\t\toptions = options || {};\n\n\t\tthis.rebuildPending = false;\n\t\tthis.resultset.reset();\n\t\tthis.resultdata = [];\n\t\tthis.resultsdirty = true;\n\n\t\tthis.cachedresultset = null;\n\n\t\t// keep ordered filter pipeline\n\t\tthis.filterPipeline = [];\n\n\t\t// sorting member variables\n\t\t// we only support one active search, applied using applySort() or applySimpleSort()\n\t\tthis.sortFunction = null;\n\t\tthis.sortCriteria = null;\n\t\tthis.sortDirty = false;\n\n\t\tif (options.queueSortPhase === true) {\n\t\t\tthis.queueSortPhase();\n\t\t}\n\t};\n\n\t/**\n\t * applySort() - Used to apply a sort to the dynamic view\n\t * @example\n\t * dv.applySort(function(obj1, obj2) {\n\t *   if (obj1.name === obj2.name) return 0;\n\t *   if (obj1.name > obj2.name) return 1;\n\t *   if (obj1.name < obj2.name) return -1;\n\t * });\n\t *\n\t * @param {function} comparefun - a javascript compare function used for sorting\n\t * @returns {DynamicView} this DynamicView object, for further chain ops.\n\t * @memberof DynamicView\n\t */\n\tapplySort(comparefun) {\n\t\tthis.sortFunction = comparefun;\n\t\tthis.sortCriteria = null;\n\n\t\tthis.queueSortPhase();\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * applySimpleSort() - Used to specify a property used for view translation.\n\t * @example\n\t * dv.applySimpleSort(\"name\");\n\t *\n\t * @param {string} propname - Name of property by which to sort.\n\t * @param {boolean=} isdesc - (Optional) If true, the sort will be in descending order.\n\t * @returns {DynamicView} this DynamicView object, for further chain ops.\n\t * @memberof DynamicView\n\t */\n\tapplySimpleSort(propname, isdesc) {\n\t\tthis.sortCriteria = [\n\t\t\t[propname, isdesc || false]\n\t\t];\n\t\tthis.sortFunction = null;\n\n\t\tthis.queueSortPhase();\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * applySortCriteria() - Allows sorting a resultset based on multiple columns.\n\t * @example\n\t * // to sort by age and then name (both ascending)\n\t * dv.applySortCriteria(['age', 'name']);\n\t * // to sort by age (ascending) and then by name (descending)\n\t * dv.applySortCriteria(['age', ['name', true]);\n\t * // to sort by age (descending) and then by name (descending)\n\t * dv.applySortCriteria(['age', true], ['name', true]);\n\t *\n\t * @param {array} properties - array of property names or subarray of [propertyname, isdesc] used evaluate sort order\n\t * @returns {DynamicView} Reference to this DynamicView, sorted, for future chain operations.\n\t * @memberof DynamicView\n\t */\n\tapplySortCriteria(criteria) {\n\t\tthis.sortCriteria = criteria;\n\t\tthis.sortFunction = null;\n\n\t\tthis.queueSortPhase();\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * startTransaction() - marks the beginning of a transaction.\n\t *\n\t * @returns {DynamicView} this DynamicView object, for further chain ops.\n\t */\n\tstartTransaction() {\n\t\tthis.cachedresultset = this.resultset.copy();\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * commit() - commits a transaction.\n\t *\n\t * @returns {DynamicView} this DynamicView object, for further chain ops.\n\t */\n\tcommit() {\n\t\tthis.cachedresultset = null;\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * rollback() - rolls back a transaction.\n\t *\n\t * @returns {DynamicView} this DynamicView object, for further chain ops.\n\t */\n\trollback() {\n\t\tthis.resultset = this.cachedresultset;\n\n\t\tif (this.options.persistent) {\n\t\t\t// for now just rebuild the persistent dynamic view data in this worst case scenario\n\t\t\t// (a persistent view utilizing transactions which get rolled back), we already know the filter so not too bad.\n\t\t\tthis.resultdata = this.resultset.data();\n\n\t\t\tthis.emit('rebuild', this);\n\t\t}\n\n\t\treturn this;\n\t};\n\n\n\t/**\n\t * Implementation detail.\n\t * _indexOfFilterWithId() - Find the index of a filter in the pipeline, by that filter's ID.\n\t *\n\t * @param {(string|number)} uid - The unique ID of the filter.\n\t * @returns {number}: index of the referenced filter in the pipeline; -1 if not found.\n\t */\n\t_indexOfFilterWithId(uid) {\n\t\tif (typeof uid === 'string' || typeof uid === 'number') {\n\t\t\tfor (var idx = 0, len = this.filterPipeline.length; idx < len; idx += 1) {\n\t\t\t\tif (uid === this.filterPipeline[idx].uid) {\n\t\t\t\t\treturn idx;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t};\n\n\t/**\n\t * Implementation detail.\n\t * _addFilter() - Add the filter object to the end of view's filter pipeline and apply the filter to the resultset.\n\t *\n\t * @param {object} filter - The filter object. Refer to applyFilter() for extra details.\n\t */\n\t_addFilter(filter) {\n\t\tthis.filterPipeline.push(filter);\n\t\tthis.resultset[filter.type](filter.val);\n\t};\n\n\t/**\n\t * reapplyFilters() - Reapply all the filters in the current pipeline.\n\t *\n\t * @returns {DynamicView} this DynamicView object, for further chain ops.\n\t */\n\treapplyFilters() {\n\t\tthis.resultset.reset();\n\n\t\tthis.cachedresultset = null;\n\t\tif (this.options.persistent) {\n\t\t\tthis.resultdata = [];\n\t\t\tthis.resultsdirty = true;\n\t\t}\n\n\t\tvar filters = this.filterPipeline;\n\t\tthis.filterPipeline = [];\n\n\t\tfor (var idx = 0, len = filters.length; idx < len; idx += 1) {\n\t\t\tthis._addFilter(filters[idx]);\n\t\t}\n\n\t\tif (this.sortFunction || this.sortCriteria) {\n\t\t\tthis.queueSortPhase();\n\t\t} else {\n\t\t\tthis.queueRebuildEvent();\n\t\t}\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * applyFilter() - Adds or updates a filter in the DynamicView filter pipeline\n\t *\n\t * @param {object} filter - A filter object to add to the pipeline.\n\t *    The object is in the format { 'type': filter_type, 'val', filter_param, 'uid', optional_filter_id }\n\t * @returns {DynamicView} this DynamicView object, for further chain ops.\n\t * @memberof DynamicView\n\t */\n\tapplyFilter(filter) {\n\t\tvar idx = this._indexOfFilterWithId(filter.uid);\n\t\tif (idx >= 0) {\n\t\t\tthis.filterPipeline[idx] = filter;\n\t\t\treturn this.reapplyFilters();\n\t\t}\n\n\t\tthis.cachedresultset = null;\n\t\tif (this.options.persistent) {\n\t\t\tthis.resultdata = [];\n\t\t\tthis.resultsdirty = true;\n\t\t}\n\n\t\tthis._addFilter(filter);\n\n\t\tif (this.sortFunction || this.sortCriteria) {\n\t\t\tthis.queueSortPhase();\n\t\t} else {\n\t\t\tthis.queueRebuildEvent();\n\t\t}\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * applyFind() - Adds or updates a mongo-style query option in the DynamicView filter pipeline\n\t *\n\t * @param {object} query - A mongo-style query object to apply to pipeline\n\t * @param {(string|number)=} uid - Optional: The unique ID of this filter, to reference it in the future.\n\t * @returns {DynamicView} this DynamicView object, for further chain ops.\n\t * @memberof DynamicView\n\t */\n\tapplyFind(query, uid) {\n\t\tthis.applyFilter({\n\t\t\ttype: 'find',\n\t\t\tval: query,\n\t\t\tuid: uid\n\t\t});\n\t\treturn this;\n\t};\n\n\t/**\n\t * applyWhere() - Adds or updates a javascript filter function in the DynamicView filter pipeline\n\t *\n\t * @param {function} fun - A javascript filter function to apply to pipeline\n\t * @param {(string|number)=} uid - Optional: The unique ID of this filter, to reference it in the future.\n\t * @returns {DynamicView} this DynamicView object, for further chain ops.\n\t * @memberof DynamicView\n\t */\n\tapplyWhere(fun, uid) {\n\t\tthis.applyFilter({\n\t\t\ttype: 'where',\n\t\t\tval: fun,\n\t\t\tuid: uid\n\t\t});\n\t\treturn this;\n\t};\n\n\t/**\n\t * removeFilter() - Remove the specified filter from the DynamicView filter pipeline\n\t *\n\t * @param {(string|number)} uid - The unique ID of the filter to be removed.\n\t * @returns {DynamicView} this DynamicView object, for further chain ops.\n\t * @memberof DynamicView\n\t */\n\tremoveFilter(uid) {\n\t\tvar idx = this._indexOfFilterWithId(uid);\n\t\tif (idx < 0) {\n\t\t\tthrow new Error(\"Dynamic view does not contain a filter with ID: \" + uid);\n\t\t}\n\n\t\tthis.filterPipeline.splice(idx, 1);\n\t\tthis.reapplyFilters();\n\t\treturn this;\n\t};\n\n\t/**\n\t * count() - returns the number of documents representing the current DynamicView contents.\n\t *\n\t * @returns {number} The number of documents representing the current DynamicView contents.\n\t * @memberof DynamicView\n\t */\n\tcount() {\n\t\t// in order to be accurate we will pay the minimum cost (and not alter dv state management)\n\t\t// recurring resultset data resolutions should know internally its already up to date.\n\t\t// for persistent data this will not update resultdata nor fire rebuild event.\n\t\tif (this.resultsdirty) {\n\t\t\tthis.resultdata = this.resultset.data();\n\t\t}\n\n\t\treturn this.resultset.count();\n\t};\n\n\t/**\n\t * data() - resolves and pending filtering and sorting, then returns document array as result.\n\t *\n\t * @returns {array} An array of documents representing the current DynamicView contents.\n\t * @memberof DynamicView\n\t */\n\tdata() {\n\t\t// using final sort phase as 'catch all' for a few use cases which require full rebuild\n\t\tif (this.sortDirty || this.resultsdirty) {\n\t\t\tthis.performSortPhase({\n\t\t\t\tsuppressRebuildEvent: true\n\t\t\t});\n\t\t}\n\t\treturn (this.options.persistent) ? (this.resultdata) : (this.resultset.data());\n\t};\n\n\t/**\n\t * queueRebuildEvent() - When the view is not sorted we may still wish to be notified of rebuild events.\n\t *     This event will throttle and queue a single rebuild event when batches of updates affect the view.\n\t */\n\tqueueRebuildEvent() {\n\t\tif (this.rebuildPending) {\n\t\t\treturn;\n\t\t}\n\t\tthis.rebuildPending = true;\n\n\t\tvar self = this;\n\t\tsetTimeout(function() {\n\t\t\tif (self.rebuildPending) {\n\t\t\t\tself.rebuildPending = false;\n\t\t\t\tself.emit('rebuild', self);\n\t\t\t}\n\t\t}, this.options.minRebuildInterval);\n\t};\n\n\t/**\n\t * queueSortPhase : If the view is sorted we will throttle sorting to either :\n\t *    (1) passive - when the user calls data(), or\n\t *    (2) active - once they stop updating and yield js thread control\n\t */\n\tqueueSortPhase() {\n\t\t// already queued? exit without queuing again\n\t\tif (this.sortDirty) {\n\t\t\treturn;\n\t\t}\n\t\tthis.sortDirty = true;\n\n\t\tvar self = this;\n\t\tif (this.options.sortPriority === \"active\") {\n\t\t\t// active sorting... once they are done and yield js thread, run async performSortPhase()\n\t\t\tsetTimeout(function() {\n\t\t\t\tself.performSortPhase();\n\t\t\t}, this.options.minRebuildInterval);\n\t\t} else {\n\t\t\t// must be passive sorting... since not calling performSortPhase (until data call), lets use queueRebuildEvent to\n\t\t\t// potentially notify user that data has changed.\n\t\t\tthis.queueRebuildEvent();\n\t\t}\n\t};\n\n\t/**\n\t * performSortPhase() - invoked synchronously or asynchronously to perform final sort phase (if needed)\n\t *\n\t */\n\tperformSortPhase(options) {\n\t\t// async call to this may have been pre-empted by synchronous call to data before async could fire\n\t\tif (!this.sortDirty && !this.resultsdirty) {\n\t\t\treturn;\n\t\t}\n\n\t\toptions = options || {};\n\n\t\tif (this.sortDirty) {\n\t\t\tif (this.sortFunction) {\n\t\t\t\tthis.resultset.sort(this.sortFunction);\n\t\t\t} else if (this.sortCriteria) {\n\t\t\t\tthis.resultset.compoundsort(this.sortCriteria);\n\t\t\t}\n\n\t\t\tthis.sortDirty = false;\n\t\t}\n\n\t\tif (this.options.persistent) {\n\t\t\t// persistent view, rebuild local resultdata array\n\t\t\tthis.resultdata = this.resultset.data();\n\t\t\tthis.resultsdirty = false;\n\t\t}\n\n\t\tif (!options.suppressRebuildEvent) {\n\t\t\tthis.emit('rebuild', this);\n\t\t}\n\t};\n\n\t/**\n\t * evaluateDocument() - internal method for (re)evaluating document inclusion.\n\t *    Called by : collection.insert() and collection.update().\n\t *\n\t * @param {int} objIndex - index of document to (re)run through filter pipeline.\n\t * @param {bool} isNew - true if the document was just added to the collection.\n\t */\n\tevaluateDocument(objIndex, isNew) {\n\t\t// if no filter applied yet, the result 'set' should remain 'everything'\n\t\tif (!this.resultset.filterInitialized) {\n\t\t\tif (this.options.persistent) {\n\t\t\t\tthis.resultdata = this.resultset.data();\n\t\t\t}\n\t\t\t// need to re-sort to sort new document\n\t\t\tif (this.sortFunction || this.sortCriteria) {\n\t\t\t\tthis.queueSortPhase();\n\t\t\t} else {\n\t\t\t\tthis.queueRebuildEvent();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tvar ofr = this.resultset.filteredrows;\n\t\tvar oldPos = (isNew) ? (-1) : (ofr.indexOf(+objIndex));\n\t\tvar oldlen = ofr.length;\n\n\t\t// creating a 1-element resultset to run filter chain ops on to see if that doc passes filters;\n\t\t// mostly efficient algorithm, slight stack overhead price (this function is called on inserts and updates)\n\t\tvar evalResultset = new Resultset(this.collection);\n\t\tevalResultset.filteredrows = [objIndex];\n\t\tevalResultset.filterInitialized = true;\n\t\tvar filter;\n\t\tfor (var idx = 0, len = this.filterPipeline.length; idx < len; idx++) {\n\t\t\tfilter = this.filterPipeline[idx];\n\t\t\tevalResultset[filter.type](filter.val);\n\t\t}\n\n\t\t// not a true position, but -1 if not pass our filter(s), 0 if passed filter(s)\n\t\tvar newPos = (evalResultset.filteredrows.length === 0) ? -1 : 0;\n\n\t\t// wasn't in old, shouldn't be now... do nothing\n\t\tif (oldPos === -1 && newPos === -1) return;\n\n\t\t// wasn't in resultset, should be now... add\n\t\tif (oldPos === -1 && newPos !== -1) {\n\t\t\tofr.push(objIndex);\n\n\t\t\tif (this.options.persistent) {\n\t\t\t\tthis.resultdata.push(this.collection.data[objIndex]);\n\t\t\t}\n\n\t\t\t// need to re-sort to sort new document\n\t\t\tif (this.sortFunction || this.sortCriteria) {\n\t\t\t\tthis.queueSortPhase();\n\t\t\t} else {\n\t\t\t\tthis.queueRebuildEvent();\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\t// was in resultset, shouldn't be now... delete\n\t\tif (oldPos !== -1 && newPos === -1) {\n\t\t\tif (oldPos < oldlen - 1) {\n\t\t\t\tofr.splice(oldPos, 1);\n\n\t\t\t\tif (this.options.persistent) {\n\t\t\t\t\tthis.resultdata.splice(oldPos, 1);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tofr.length = oldlen - 1;\n\n\t\t\t\tif (this.options.persistent) {\n\t\t\t\t\tthis.resultdata.length = oldlen - 1;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// in case changes to data altered a sort column\n\t\t\tif (this.sortFunction || this.sortCriteria) {\n\t\t\t\tthis.queueSortPhase();\n\t\t\t} else {\n\t\t\t\tthis.queueRebuildEvent();\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\t// was in resultset, should still be now... (update persistent only?)\n\t\tif (oldPos !== -1 && newPos !== -1) {\n\t\t\tif (this.options.persistent) {\n\t\t\t\t// in case document changed, replace persistent view data with the latest collection.data document\n\t\t\t\tthis.resultdata[oldPos] = this.collection.data[objIndex];\n\t\t\t}\n\n\t\t\t// in case changes to data altered a sort column\n\t\t\tif (this.sortFunction || this.sortCriteria) {\n\t\t\t\tthis.queueSortPhase();\n\t\t\t} else {\n\t\t\t\tthis.queueRebuildEvent();\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\t};\n\n\t/**\n\t * removeDocument() - internal function called on collection.delete()\n\t */\n\tremoveDocument(objIndex) {\n\t\t// if no filter applied yet, the result 'set' should remain 'everything'\n\t\tif (!this.resultset.filterInitialized) {\n\t\t\tif (this.options.persistent) {\n\t\t\t\tthis.resultdata = this.resultset.data();\n\t\t\t}\n\t\t\t// in case changes to data altered a sort column\n\t\t\tif (this.sortFunction || this.sortCriteria) {\n\t\t\t\tthis.queueSortPhase();\n\t\t\t} else {\n\t\t\t\tthis.queueRebuildEvent();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tvar ofr = this.resultset.filteredrows;\n\t\tvar oldPos = ofr.indexOf(+objIndex);\n\t\tvar oldlen = ofr.length;\n\t\tvar idx;\n\n\t\tif (oldPos !== -1) {\n\t\t\t// if not last row in resultdata, swap last to hole and truncate last row\n\t\t\tif (oldPos < oldlen - 1) {\n\t\t\t\tofr[oldPos] = ofr[oldlen - 1];\n\t\t\t\tofr.length = oldlen - 1;\n\n\t\t\t\tif (this.options.persistent) {\n\t\t\t\t\tthis.resultdata[oldPos] = this.resultdata[oldlen - 1];\n\t\t\t\t\tthis.resultdata.length = oldlen - 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// last row, so just truncate last row\n\t\t\telse {\n\t\t\t\tofr.length = oldlen - 1;\n\n\t\t\t\tif (this.options.persistent) {\n\t\t\t\t\tthis.resultdata.length = oldlen - 1;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// in case changes to data altered a sort column\n\t\t\tif (this.sortFunction || this.sortCriteria) {\n\t\t\t\tthis.queueSortPhase();\n\t\t\t} else {\n\t\t\t\tthis.queueRebuildEvent();\n\t\t\t}\n\t\t}\n\n\t\t// since we are using filteredrows to store data array positions\n\t\t// if they remove a document (whether in our view or not),\n\t\t// we need to adjust array positions -1 for all document array references after that position\n\t\toldlen = ofr.length;\n\t\tfor (idx = 0; idx < oldlen; idx++) {\n\t\t\tif (ofr[idx] > objIndex) {\n\t\t\t\tofr[idx]--;\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * mapReduce() - data transformation via user supplied functions\n\t *\n\t * @param {function} mapFunction - this function accepts a single document for you to transform and return\n\t * @param {function} reduceFunction - this function accepts many (array of map outputs) and returns single value\n\t * @returns The output of your reduceFunction\n\t * @memberof DynamicView\n\t */\n\tmapReduce(mapFunction, reduceFunction) {\n\t\ttry {\n\t\t\treturn reduceFunction(this.data().map(mapFunction));\n\t\t} catch (err) {\n\t\t\tthrow err;\n\t\t}\n\t};\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/dynamic_view.js","/*\nLoki IndexedDb Adapter (need to include this script to use it)\n\nConsole Usage can be used for management/diagnostic, here are a few examples :\nadapter.getDatabaseList(); // with no callback passed, this method will log results to console\nadapter.saveDatabase(\"UserDatabase\", JSON.stringify(myDb));\nadapter.loadDatabase(\"UserDatabase\"); // will log the serialized db to console\nadapter.deleteDatabase(\"UserDatabase\");\n*/\n\n/**\n * Loki persistence adapter class for indexedDb.\n *     This class fulfills abstract adapter interface which can be applied to other storage methods.\n *     Utilizes the included LokiCatalog app/key/value database for actual database persistence.\n *     IndexedDb storage is provided per-domain, so we implement app/key/value database to\n *     allow separate contexts for separate apps within a domain.\n *\n * @example\n * var idbAdapter = new LokiIndexedAdapter(\"finance\");\n *\n * @constructor LokiIndexedAdapter\n *\n * @param {string} appname - (Optional) Application name context can be used to distinguish subdomains, \"loki\" by default\n */\nexport class LokiIndexedAdapter {\n\n\tconstructor(appname) {\n\t\tthis.app = \"loki\";\n\n\t\tif (typeof(appname) !== \"undefined\") {\n\t\t\tthis.app = appname;\n\t\t}\n\n\t\t// keep reference to catalog class for base AKV operations\n\t\tthis.catalog = null;\n\n\t\tif (!this.checkAvailability()) {\n\t\t\tthrow new Error(\"indexedDB does not seem to be supported for your environment\");\n\t\t}\n\t}\n\n\t/**\n\t * Used to check if adapter is available\n\t *\n\t * @returns {boolean} true if indexeddb is available, false if not.\n\t * @memberof LokiIndexedAdapter\n\t */\n\tcheckAvailability() {\n\t\tif (typeof indexedDB !== \"undefined\" && indexedDB) return true;\n\n\t\treturn false;\n\t};\n\n\t/**\n\t * Retrieves a serialized db string from the catalog.\n\t *\n\t * @example\n\t * // LOAD\n\t * var idbAdapter = new LokiIndexedAdapter(\"finance\");\n\t * var db = new loki(\"test\", { adapter: idbAdapter });\n\t *   db.loadDatabase(function(result) {\n\t *   console.log(\"done\");\n\t * });\n\t *\n\t * @param {string} dbname - the name of the database to retrieve.\n\t * @returns {Promise} a Promise that resolves after the database was loaded\n\t * @memberof LokiIndexedAdapter\n\t */\n\tloadDatabase(dbname) {\n\t\tvar appName = this.app;\n\t\tvar adapter = this;\n\n\t\t// lazy open/create db reference so dont -need- callback in constructor\n\t\tif (this.catalog === null || this.catalog.db === null) {\n\t\t\treturn new Promise(function(resolve) {\n\t\t\t\tadapter.catalog = new LokiCatalog(function(cat) {\n\t\t\t\t\tadapter.catalog = cat;\n\n\t\t\t\t\tresolve(adapter.loadDatabase(dbname));\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\t// lookup up db string in AKV db\n\t\treturn new Promise(function(resolve) {\n\t\t\tthis.catalog.getAppKey(appName, dbname, function(result) {\n\t\t\t\tif (result.id === 0) {\n\t\t\t\t\tresolve();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tresolve(result.val);\n\t\t\t});\n\t\t});\n\t};\n\n\t// alias\n\tloadKey(dbname) {\n\t\treturn this.loadDatabase(dbname);\n\t}\n\n\t/**\n\t * Saves a serialized db to the catalog.\n\t *\n\t * @example\n\t * // SAVE : will save App/Key/Val as \"finance\"/\"test\"/{serializedDb}\n\t * var idbAdapter = new LokiIndexedAdapter(\"finance\");\n\t * var db = new loki(\"test\", { adapter: idbAdapter });\n\t * var coll = db.addCollection(\"testColl\");\n\t * coll.insert({test: \"val\"});\n\t * db.saveDatabase();  // could pass callback if needed for async complete\n\t *\n\t * @param {string} dbname - the name to give the serialized database within the catalog.\n\t * @param {string} dbstring - the serialized db string to save.\n\t * @returns {Promise} a Promise that resolves after the database was persisted\n\t * @memberof LokiIndexedAdapter\n\t */\n\tsaveDatabase(dbname, dbstring) {\n\t\tvar appName = this.app;\n\t\tvar adapter = this;\n\n\t\tvar resolve, reject;\n\t\tvar result = new Promise(function(res, rej) {\n\t\t\tresolve = res;\n\t\t\treject = rej;\n\t\t});\n\n\t\tfunction saveCallback(result) {\n\t\t\tif (result && result.success === true) {\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\treject(new Error(\"Error saving database\"));\n\t\t\t}\n\t\t}\n\n\t\t// lazy open/create db reference so dont -need- callback in constructor\n\t\tif (this.catalog === null || this.catalog.db === null) {\n\t\t\tthis.catalog = new LokiCatalog(function(cat) {\n\t\t\t\tadapter.catalog = cat;\n\n\t\t\t\t// now that catalog has been initialized, set (add/update) the AKV entry\n\t\t\t\tcat.setAppKey(appName, dbname, dbstring, saveCallback);\n\t\t\t});\n\n\t\t\treturn result;\n\t\t}\n\n\t\t// set (add/update) entry to AKV database\n\t\tthis.catalog.setAppKey(appName, dbname, dbstring, saveCallback);\n\n\t\treturn result;\n\t};\n\n\t// alias\n\tsaveKey(dbname, dbstring) {\n\t\treturn this.saveDatabase(dbname, dbstring);\n\t}\n\n\t/**\n\t * Deletes a serialized db from the catalog.\n\t *\n\t * @example\n\t * // DELETE DATABASE\n\t * // delete \"finance\"/\"test\" value from catalog\n\t * idbAdapter.deleteDatabase(\"test\", function {\n\t *   // database deleted\n\t * });\n\t *\n\t * @param {string} dbname - the name of the database to delete from the catalog.\n\t * @returns {Promise} a Promise that resolves after the database was deleted\n\t * @memberof LokiIndexedAdapter\n\t */\n\tdeleteDatabase(dbname) {\n\t\tvar appName = this.app;\n\t\tvar adapter = this;\n\n\t\t// lazy open/create db reference and pass callback ahead\n\t\tif (this.catalog === null || this.catalog.db === null) {\n\t\t\treturn new Promise(function(resolve) {\n\t\t\t\tadapter.catalog = new LokiCatalog(function(cat) {\n\t\t\t\t\tadapter.catalog = cat;\n\n\t\t\t\t\tresolve(adapter.deleteDatabase(dbname));\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\t// catalog was already initialized, so just lookup object and delete by id\n\t\treturn new Promise(function(resolve) {\n\t\t\tthis.catalog.getAppKey(appName, dbname, function(result) {\n\t\t\t\tvar id = result.id;\n\n\t\t\t\tif (id !== 0) {\n\t\t\t\t\tadapter.catalog.deleteAppKey(id);\n\t\t\t\t}\n\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t};\n\n\t// alias\n\tdeleteKey(dbname) {\n\t\treturn this.deleteDatabase(dbname);\n\t}\n\n\t/**\n\t * Removes all database partitions and pages with the base filename passed in.\n\t * This utility method does not (yet) guarantee async deletions will be completed before returning\n\t *\n\t * @param {string} dbname - the base filename which container, partitions, or pages are derived\n\t * @memberof LokiIndexedAdapter\n\t */\n\tdeleteDatabasePartitions(dbname) {\n\t\tvar self = this;\n\t\tthis.getDatabaseList(function(result) {\n\t\t\tresult.forEach(function(str) {\n\t\t\t\tif (str.startsWith(dbname)) {\n\t\t\t\t\tself.deleteDatabase(str);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t};\n\n\t/**\n\t * Retrieves object array of catalog entries for current app.\n\t *\n\t * @example\n\t * idbAdapter.getDatabaseList(function(result) {\n\t *   // result is array of string names for that appcontext (\"finance\")\n\t *   result.forEach(function(str) {\n\t *     console.log(str);\n\t *   });\n\t * });\n\t *\n\t * @param {function} callback - should accept array of database names in the catalog for current app.\n\t * @memberof LokiIndexedAdapter\n\t */\n\tgetDatabaseList(callback) {\n\t\tvar appName = this.app;\n\t\tvar adapter = this;\n\n\t\t// lazy open/create db reference so dont -need- callback in constructor\n\t\tif (this.catalog === null || this.catalog.db === null) {\n\t\t\tthis.catalog = new LokiCatalog(function(cat) {\n\t\t\t\tadapter.catalog = cat;\n\n\t\t\t\tadapter.getDatabaseList(callback);\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\t// catalog already initialized\n\t\t// get all keys for current appName, and transpose results so just string array\n\t\tthis.catalog.getAppKeys(appName, function(results) {\n\t\t\tvar names = [];\n\n\t\t\tfor (var idx = 0; idx < results.length; idx++) {\n\t\t\t\tnames.push(results[idx].key);\n\t\t\t}\n\n\t\t\tif (typeof(callback) === \"function\") {\n\t\t\t\tcallback(names);\n\t\t\t} else {\n\t\t\t\tnames.forEach(function(obj) {\n\t\t\t\t\tconsole.log(obj);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\n\t// alias\n\tgetKeyList(callback) {\n\t\treturn this.getDatabaseList(callback);\n\t}\n\n\t/**\n\t * Allows retrieval of list of all keys in catalog along with size\n\t *\n\t * @param {function} callback - (Optional) callback to accept result array.\n\t * @memberof LokiIndexedAdapter\n\t */\n\tgetCatalogSummary(callback) {\n\t\tvar appName = this.app;\n\t\tvar adapter = this;\n\n\t\t// lazy open/create db reference\n\t\tif (this.catalog === null || this.catalog.db === null) {\n\t\t\tthis.catalog = new LokiCatalog(function(cat) {\n\t\t\t\tadapter.catalog = cat;\n\n\t\t\t\tadapter.getCatalogSummary(callback);\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\t// catalog already initialized\n\t\t// get all keys for current appName, and transpose results so just string array\n\t\tthis.catalog.getAllKeys(function(results) {\n\t\t\tvar entries = [];\n\t\t\tvar obj,\n\t\t\t\tsize,\n\t\t\t\toapp,\n\t\t\t\tokey,\n\t\t\t\toval;\n\n\t\t\tfor (var idx = 0; idx < results.length; idx++) {\n\t\t\t\tobj = results[idx];\n\t\t\t\toapp = obj.app || '';\n\t\t\t\tokey = obj.key || '';\n\t\t\t\toval = obj.val || '';\n\n\t\t\t\t// app and key are composited into an appkey column so we will mult by 2\n\t\t\t\tsize = oapp.length * 2 + okey.length * 2 + oval.length + 1;\n\n\t\t\t\tentries.push({\n\t\t\t\t\t\"app\": obj.app,\n\t\t\t\t\t\"key\": obj.key,\n\t\t\t\t\t\"size\": size\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (typeof(callback) === \"function\") {\n\t\t\t\tcallback(entries);\n\t\t\t} else {\n\t\t\t\tentries.forEach(function(obj) {\n\t\t\t\t\tconsole.log(obj);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n}\n\n/**\n * LokiCatalog - underlying App/Key/Value catalog persistence\n *    This non-interface class implements the actual persistence.\n *    Used by the IndexedAdapter class.\n */\nclass LokiCatalog {\n\tconstructor(callback) {\n\t\tthis.db = null;\n\t\tthis.initializeLokiCatalog(callback);\n\t}\n\n\tinitializeLokiCatalog(callback) {\n\t\tvar openRequest = indexedDB.open(\"LokiCatalog\", 1);\n\t\tvar cat = this;\n\n\t\t// If database doesn't exist yet or its version is lower than our version specified above (2nd param in line above)\n\t\topenRequest.onupgradeneeded = function(e) {\n\t\t\tvar thisDB = e.target.result;\n\t\t\tif (thisDB.objectStoreNames.contains(\"LokiAKV\")) {\n\t\t\t\tthisDB.deleteObjectStore(\"LokiAKV\");\n\t\t\t}\n\n\t\t\tif (!thisDB.objectStoreNames.contains(\"LokiAKV\")) {\n\t\t\t\tvar objectStore = thisDB.createObjectStore(\"LokiAKV\", {\n\t\t\t\t\tkeyPath: \"id\",\n\t\t\t\t\tautoIncrement: true\n\t\t\t\t});\n\t\t\t\tobjectStore.createIndex(\"app\", \"app\", {\n\t\t\t\t\tunique: false\n\t\t\t\t});\n\t\t\t\tobjectStore.createIndex(\"key\", \"key\", {\n\t\t\t\t\tunique: false\n\t\t\t\t});\n\t\t\t\t// hack to simulate composite key since overhead is low (main size should be in val field)\n\t\t\t\t// user (me) required to duplicate the app and key into comma delimited appkey field off object\n\t\t\t\t// This will allow retrieving single record with that composite key as well as\n\t\t\t\t// still supporting opening cursors on app or key alone\n\t\t\t\tobjectStore.createIndex(\"appkey\", \"appkey\", {\n\t\t\t\t\tunique: true\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\topenRequest.onsuccess = function(e) {\n\t\t\tcat.db = e.target.result;\n\n\t\t\tif (typeof(callback) === \"function\") callback(cat);\n\t\t};\n\n\t\topenRequest.onerror = function(e) {\n\t\t\tthrow e;\n\t\t};\n\t};\n\n\tgetAppKey(app, key, callback) {\n\t\tvar transaction = this.db.transaction([\"LokiAKV\"], \"readonly\");\n\t\tvar store = transaction.objectStore(\"LokiAKV\");\n\t\tvar index = store.index(\"appkey\");\n\t\tvar appkey = app + \",\" + key;\n\t\tvar request = index.get(appkey);\n\n\t\trequest.onsuccess = (function(usercallback) {\n\t\t\treturn function(e) {\n\t\t\t\tvar lres = e.target.result;\n\n\t\t\t\tif (lres === null || typeof(lres) === \"undefined\") {\n\t\t\t\t\tlres = {\n\t\t\t\t\t\tid: 0,\n\t\t\t\t\t\tsuccess: false\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (typeof(usercallback) === \"function\") {\n\t\t\t\t\tusercallback(lres);\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log(lres);\n\t\t\t\t}\n\t\t\t};\n\t\t})(callback);\n\n\t\trequest.onerror = (function(usercallback) {\n\t\t\treturn function(e) {\n\t\t\t\tif (typeof(usercallback) === \"function\") {\n\t\t\t\t\tusercallback({\n\t\t\t\t\t\tid: 0,\n\t\t\t\t\t\tsuccess: false\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t};\n\t\t})(callback);\n\t};\n\n\tgetAppKeyById(id, callback, data) {\n\t\tvar transaction = this.db.transaction([\"LokiAKV\"], \"readonly\");\n\t\tvar store = transaction.objectStore(\"LokiAKV\");\n\t\tvar request = store.get(id);\n\n\t\trequest.onsuccess = (function(data, usercallback) {\n\t\t\treturn function(e) {\n\t\t\t\tif (typeof(usercallback) === \"function\") {\n\t\t\t\t\tusercallback(e.target.result, data);\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log(e.target.result);\n\t\t\t\t}\n\t\t\t};\n\t\t})(data, callback);\n\t};\n\n\tsetAppKey(app, key, val, callback) {\n\t\tvar transaction = this.db.transaction([\"LokiAKV\"], \"readwrite\");\n\t\tvar store = transaction.objectStore(\"LokiAKV\");\n\t\tvar index = store.index(\"appkey\");\n\t\tvar appkey = app + \",\" + key;\n\t\tvar request = index.get(appkey);\n\n\t\t// first try to retrieve an existing object by that key\n\t\t// need to do this because to update an object you need to have id in object, otherwise it will append id with new autocounter and clash the unique index appkey\n\t\trequest.onsuccess = function(e) {\n\t\t\tvar res = e.target.result;\n\n\t\t\tif (res === null || res === undefined) {\n\t\t\t\tres = {\n\t\t\t\t\tapp: app,\n\t\t\t\t\tkey: key,\n\t\t\t\t\tappkey: app + \",\" + key,\n\t\t\t\t\tval: val\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tres.val = val;\n\t\t\t}\n\n\t\t\tvar requestPut = store.put(res);\n\n\t\t\trequestPut.onerror = (function(usercallback) {\n\t\t\t\treturn function(e) {\n\t\t\t\t\tif (typeof(usercallback) === \"function\") {\n\t\t\t\t\t\tusercallback({\n\t\t\t\t\t\t\tsuccess: false\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.error(\"LokiCatalog.setAppKey (set) onerror\");\n\t\t\t\t\t\tconsole.error(request.error);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t})(callback);\n\n\t\t\trequestPut.onsuccess = (function(usercallback) {\n\t\t\t\treturn function(e) {\n\t\t\t\t\tif (typeof(usercallback) === \"function\") {\n\t\t\t\t\t\tusercallback({\n\t\t\t\t\t\t\tsuccess: true\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t})(callback);\n\t\t};\n\n\t\trequest.onerror = (function(usercallback) {\n\t\t\treturn function(e) {\n\t\t\t\tif (typeof(usercallback) === \"function\") {\n\t\t\t\t\tusercallback({\n\t\t\t\t\t\tsuccess: false\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error(\"LokiCatalog.setAppKey (get) onerror\");\n\t\t\t\t\tconsole.error(request.error);\n\t\t\t\t}\n\t\t\t};\n\t\t})(callback);\n\t};\n\n\tdeleteAppKey(id, callback) {\n\t\tvar transaction = this.db.transaction([\"LokiAKV\"], \"readwrite\");\n\t\tvar store = transaction.objectStore(\"LokiAKV\");\n\t\tvar request = store.delete(id);\n\n\t\trequest.onsuccess = (function(usercallback) {\n\t\t\treturn function(evt) {\n\t\t\t\tif (typeof(usercallback) === \"function\") usercallback({\n\t\t\t\t\tsuccess: true\n\t\t\t\t});\n\t\t\t};\n\t\t})(callback);\n\n\t\trequest.onerror = (function(usercallback) {\n\t\t\treturn function(evt) {\n\t\t\t\tif (typeof(usercallback) === \"function\") {\n\t\t\t\t\tusercallback(false);\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error(\"LokiCatalog.deleteAppKey raised onerror\");\n\t\t\t\t\tconsole.error(request.error);\n\t\t\t\t}\n\t\t\t};\n\t\t})(callback);\n\t};\n\n\tgetAppKeys(app, callback) {\n\t\tvar transaction = this.db.transaction([\"LokiAKV\"], \"readonly\");\n\t\tvar store = transaction.objectStore(\"LokiAKV\");\n\t\tvar index = store.index(\"app\");\n\n\t\t// We want cursor to all values matching our (single) app param\n\t\tvar singleKeyRange = IDBKeyRange.only(app);\n\n\t\t// To use one of the key ranges, pass it in as the first argument of openCursor()/openKeyCursor()\n\t\tvar cursor = index.openCursor(singleKeyRange);\n\n\t\t// cursor internally, pushing results into this.data[] and return\n\t\t// this.data[] when done (similar to service)\n\t\tvar localdata = [];\n\n\t\tcursor.onsuccess = (function(data, callback) {\n\t\t\treturn function(e) {\n\t\t\t\tvar cursor = e.target.result;\n\t\t\t\tif (cursor) {\n\t\t\t\t\tvar currObject = cursor.value;\n\n\t\t\t\t\tdata.push(currObject);\n\n\t\t\t\t\tcursor.continue();\n\t\t\t\t} else {\n\t\t\t\t\tif (typeof(callback) === \"function\") {\n\t\t\t\t\t\tcallback(data);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log(data);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t})(localdata, callback);\n\n\t\tcursor.onerror = (function(usercallback) {\n\t\t\treturn function(e) {\n\t\t\t\tif (typeof(usercallback) === \"function\") {\n\t\t\t\t\tusercallback(null);\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error(\"LokiCatalog.getAppKeys raised onerror\");\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t}\n\t\t\t};\n\t\t})(callback);\n\n\t};\n\n\t// Hide \"cursoring\" and return array of { id: id, key: key }\n\tgetAllKeys(callback) {\n\t\tvar transaction = this.db.transaction([\"LokiAKV\"], \"readonly\");\n\t\tvar store = transaction.objectStore(\"LokiAKV\");\n\t\tvar cursor = store.openCursor();\n\n\t\tvar localdata = [];\n\n\t\tcursor.onsuccess = (function(data, callback) {\n\t\t\treturn function(e) {\n\t\t\t\tvar cursor = e.target.result;\n\t\t\t\tif (cursor) {\n\t\t\t\t\tvar currObject = cursor.value;\n\n\t\t\t\t\tdata.push(currObject);\n\n\t\t\t\t\tcursor.continue();\n\t\t\t\t} else {\n\t\t\t\t\tif (typeof(callback) === \"function\") {\n\t\t\t\t\t\tcallback(data);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log(data);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t})(localdata, callback);\n\n\t\tcursor.onerror = (function(usercallback) {\n\t\t\treturn function(e) {\n\t\t\t\tif (typeof(usercallback) === \"function\") usercallback(null);\n\t\t\t};\n\t\t})(callback);\n\t};\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/loki-indexed-adapter.js"],"sourceRoot":""}